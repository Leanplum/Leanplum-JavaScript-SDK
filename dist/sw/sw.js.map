{"version":3,"sources":["../../src/PushServiceWorker.js"],"names":["ACTION_NAME_KEY","OPEN_URL_ACTION","ARG_URL","openActions","pushListener","event","jsonString","data","text","console","log","options","JSON","parse","title","tag","openAction","hasOwnProperty","Reflect","deleteProperty","waitUntil","self","registration","showNotification","notificationClickListener","notification","close","notificationId","openActionUrl","clients","openWindow","addEventListener"],"mappings":";;AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAoCA;AAEA,IAAMA,eAAe,GAAG,UAAxB;AACA,IAAMC,eAAe,GAAG,UAAxB;AACA,IAAMC,OAAO,GAAG,KAAhB;AAEA,IAAIC,WAAW,GAAG,EAAlB;AAEA;;;;;AAIA,SAASC,YAAT,CAAsBC,KAAtB,EAA6B;AAC3B,MAAIC,UAAU,GAAGD,KAAK,CAACE,IAAN,IAAcF,KAAK,CAACE,IAAN,CAAWC,IAAX,EAAd,GAAkCH,KAAK,CAACE,IAAN,CAAWC,IAAX,EAAlC,GAAsD,IAAvE;;AAEA,MAAI,CAACF,UAAL,EAAiB;AACfG,IAAAA,OAAO,CAACC,GAAR,CAAY,4DAAZ;AACA;AACD,GAN0B,CAQ3B;;;AACA,MAAIC,OAAO,GAAGC,IAAI,CAACC,KAAL,CAAWP,UAAX,CAAd;AAEA;;AACA;;AACA,MAAI,CAACK,OAAD,IAAY,CAACA,OAAO,CAACG,KAArB,IAA8B,CAACH,OAAO,CAACI,GAA3C,EAAgD;AAC9CN,IAAAA,OAAO,CAACC,GAAR,CAAY,8DACR,UADJ;AAEA;AACD,GAjB0B,CAmB3B;;AACA;;;AACA,MAAIC,OAAO,CAACJ,IAAR,IAAgBI,OAAO,CAACJ,IAAR,CAAaS,UAA7B,IACAL,OAAO,CAACJ,IAAR,CAAaS,UAAb,CAAwBC,cAAxB,CAAuCjB,eAAvC,CADA,IAEAW,OAAO,CAACJ,IAAR,CAAaS,UAAb,CAAwBhB,eAAxB,MAA6CC,eAF7C,IAGAU,OAAO,CAACJ,IAAR,CAAaS,UAAb,CAAwBC,cAAxB,CAAuCf,OAAvC,CAHJ,EAGqD;AACnDC,IAAAA,WAAW,CAACQ,OAAO,CAACI,GAAT,CAAX,GAA2BJ,OAAO,CAACJ,IAAR,CAAaS,UAAb,CAAwBd,OAAxB,CAA3B;AACD,GA1B0B,CA4B3B;;;AACA,MAAIY,KAAK,GAAGH,OAAO,CAACG,KAApB;AACAI,EAAAA,OAAO,CAACC,cAAR,CAAuBR,OAAvB,EAAgC,OAAhC;AACA;;AACA;;AACAN,EAAAA,KAAK,CAACe,SAAN,CAAgBC,IAAI,CAACC,YAAL,CAAkBC,gBAAlB,CAAmCT,KAAnC,EAA0CH,OAA1C,CAAhB;AACD;AAED;;;;;;;;;AAOA,SAASa,yBAAT,CAAmCnB,KAAnC,EAA0C;AACxCI,EAAAA,OAAO,CAACC,GAAR,CAAY,yDAAZ;AAEAL,EAAAA,KAAK,CAACoB,YAAN,CAAmBC,KAAnB;;AAEA,MAAI,CAACrB,KAAK,CAACoB,YAAP,IAAuB,CAACpB,KAAK,CAACoB,YAAN,CAAmBV,GAA/C,EAAoD;AAClDN,IAAAA,OAAO,CAACC,GAAR,CAAY,qEAAZ;AACA;AACD;;AAED,MAAIiB,cAAc,GAAGtB,KAAK,CAACoB,YAAN,CAAmBV,GAAxC;AACA,MAAIa,aAAa,GAAGzB,WAAW,CAACwB,cAAD,CAA/B;;AACA,MAAI,CAACC,aAAL,EAAoB;AAClBnB,IAAAA,OAAO,CAACC,GAAR,CAAY,8DAAZ;AACA;AACD;;AAEDQ,EAAAA,OAAO,CAACC,cAAR,CAAuBhB,WAAvB,EAAoC,gBAApC;AAEA;;AACAE,EAAAA,KAAK,CAACe,SAAN,CAAgBS,OAAO,CAACC,UAAR,CAAmBF,aAAnB,CAAhB;AACD;;AAEDP,IAAI,CAACU,gBAAL,CAAsB,MAAtB,EAA8B3B,YAA9B;AACAiB,IAAI,CAACU,gBAAL,CAAsB,mBAAtB,EAA2CP,yBAA3C","sourcesContent":["/*\n *\n *  Copyright 2017 Leanplum Inc. All rights reserved.\n *\n *  Licensed under the Apache License, Version 2.0 (the \"License\");\n *  you may not use this file except in compliance with the License.\n *  You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n *  Unless required by applicable law or agreed to in writing, software\n *  distributed under the License is distributed on an \"AS IS\" BASIS,\n *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *  See the License for the specific language governing permissions and\n *  limitations under the License\n *\n *\n *  Original File:\n *\n *  Push Notifications CodeLab\n *  Copyright 2015 Google Inc. All rights reserved.\n *\n *  Licensed under the Apache License, Version 2.0 (the \"License\");\n *  you may not use this file except in compliance with the License.\n *  You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n *  Unless required by applicable law or agreed to in writing, software\n *  distributed under the License is distributed on an \"AS IS\" BASIS,\n *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *  See the License for the specific language governing permissions and\n *  limitations under the License\n *\n */\n\n/* global self, clients */\n\nconst ACTION_NAME_KEY = '__name__'\nconst OPEN_URL_ACTION = 'Open URL'\nconst ARG_URL = 'URL'\n\nlet openActions = {}\n\n/**\n * Triggered on push message received.\n * @param {object} event The push payload that the browser received.\n */\nfunction pushListener(event) {\n  let jsonString = event.data && event.data.text() ? event.data.text() : null\n\n  if (!jsonString) {\n    console.log('Leanplum: Push received without payload, skipping display.')\n    return\n  }\n\n  // noinspection JSCheckFunctionSignatures\n  let options = JSON.parse(jsonString)\n\n  /** @namespace options.title The title of the push notification. **/\n  /** @namespace options.tag The id of the push notification **/\n  if (!options || !options.title || !options.tag) {\n    console.log('Leanplum: No options, title or tag/id received, skipping ' +\n        'display.')\n    return\n  }\n\n  // Extract open action url. We only support open url action for now.\n  /** @namespace options.data.openAction The openAction of the push notification. **/\n  if (options.data && options.data.openAction &&\n      options.data.openAction.hasOwnProperty(ACTION_NAME_KEY) &&\n      options.data.openAction[ACTION_NAME_KEY] === OPEN_URL_ACTION &&\n      options.data.openAction.hasOwnProperty(ARG_URL)) {\n    openActions[options.tag] = options.data.openAction[ARG_URL]\n  }\n\n  // Extract title and delete from options.\n  let title = options.title\n  Reflect.deleteProperty(options, 'title')\n  /** @namespace self.registration **/\n  /** @namespace self.registration.showNotification **/\n  event.waitUntil(self.registration.showNotification(title, options))\n}\n\n/**\n * Callback that handles clicks on the notification.\n * @param {object} event The notification event object.\n * @param {object} event.notification The notification object.\n * @param {function} event.waitUntil The browser will keep the service worker running until the\n * promise you passed in has settled.\n */\nfunction notificationClickListener(event) {\n  console.log('Leanplum: [Service Worker] Notification click received.')\n\n  event.notification.close()\n\n  if (!event.notification || !event.notification.tag) {\n    console.log('Leanplum: No notification or tag/id received, skipping open action.')\n    return\n  }\n\n  let notificationId = event.notification.tag\n  let openActionUrl = openActions[notificationId]\n  if (!openActionUrl) {\n    console.log('Leanplum: [Service Worker] No action defined, doing nothing.')\n    return\n  }\n\n  Reflect.deleteProperty(openActions, 'notificationId')\n\n  /** @namespace clients.openWindow **/\n  event.waitUntil(clients.openWindow(openActionUrl))\n}\n\nself.addEventListener('push', pushListener)\nself.addEventListener('notificationclick', notificationClickListener)\n"],"file":"sw.js"}