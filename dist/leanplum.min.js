!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.Leanplum=t():e.Leanplum=t()}(window,function(){return r={},s.m=n=[function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={METHODS:{START:"start",STOP:"stop",ADVANCE:"advance",TRACK:"track",PAUSE_SESSION:"pauseSession",RESUME_SESSION:"resumeSession",PAUSE_STATE:"pauseState",RESUME_STATE:"resumeState",DOWNLOAD_FILE:"downloadFile",MULTI:"multi",SET_VARS:"setVars",GET_VARS:"getVars",SET_USER_ATTRIBUTES:"setUserAttributes",SET_DEVICE_ATTRIBUTES:"setDeviceAttributes",UPLOAD_FILE:"uploadFile",REGISTER_DEVICE:"registerDevice"},SDK_VERSION:"1.8.5",CLIENT:"js",PARAMS:{ACTION:"action",APP_ID:"appId",CLIENT:"client",CLIENT_KEY:"clientKey",CURRENCY_CODE:"currencyCode",DEVICE_ID:"deviceId",SDK_VERSION:"sdkVersion",USER_ID:"userId",NEW_USER_ID:"newUserId",DEV_MODE:"devMode",VERSION_NAME:"versionName",SYSTEM_NAME:"systemName",SYSTEM_VERSION:"systemVersion",BROWSER_NAME:"browserName",BROWSER_VERSION:"browserVersion",DEVICE_NAME:"deviceName",DEVICE_MODEL:"deviceModel",USER_ATTRIBUTES:"userAttributes",LOCALE:"locale",COUNTRY:"country",REGION:"region",CITY:"city",LOCATION:"location",STATE:"state",INFO:"info",EVENT:"event",VALUE:"value",FILENAME:"filename",TIME:"time",DATA:"data",VARS:"vars",FILE:"file",SIZE:"size",VARIATION:"variation",HASH:"hash",EMAIL:"email",VARIABLES:"vars",ACTION_DEFINITIONS:"actionDefinitions",PARAMS:"params",INCLUDE_DEFAULTS:"includeDefaults",INCLUDE_VARIANT_DEBUG_INFO:"includeVariantDebugInfo",NEWSFEED_MESSAGES:"newsfeedMessages",MESSAGE_ID:"messageId",WEB_PUSH_SUBSCRIPTION:"webPushSubscription"},KEYS:{IS_REGISTERED:"isRegistered",LATEST_VERSION:"latestVersion",SYNC_INBOX:"syncNewsfeed",MESSAGES:"messages",VARS:"vars",VARIANTS:"variants",VARIANT_DEBUG_INFO:"variantDebugInfo",ACTION_DEFINITIONS:"actionDefinitions",TOKEN:"token"},DEFAULT_KEYS:{COUNT:"__leanplum_unsynced",ITEM:"__leanplum_unsynced_",VARIABLES:"__leanplum_variables",VARIANTS:"__leanplum_variants",VARIANT_DEBUG_INFO:"__leanplum_variant_debug_info",ACTION_DEFINITIONS:"__leanplum_action_definitions",INBOX_MESSAGES:"__leanplum_inbox_messages",TOKEN:"__leanplum_token",DEVICE_ID:"__leanplum_device_id",USER_ID:"__leanplum_user_id",SESSION:"__leanplum_session",MESSAGE_OCCURRENCES:"__leanplum_message_occurrences",MESSAGE_CACHE:"__leanplum_message_cache",PUSH_SUBSCRIPTION:"__leanplum_push_subscription"},VALUES:{DETECT:"(detect)",DEFAULT_PUSH_ACTION:"Open action"}}},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var s=r(n(0)),i=(o.prototype.add=function(e,t){if(void 0===t)return this;this.argString&&(this.argString+="&");var n="";return n=t instanceof Array?JSON.stringify(t):encodeURIComponent(t),this.argString+=e+"="+n,this.argValues[e]=t,this},o.prototype.body=function(e){return e?(this._body=e,this):this._body},o.prototype.attachApiKeys=function(e,t){return this.add(s.default.PARAMS.APP_ID,e).add(s.default.PARAMS.CLIENT,s.default.CLIENT).add(s.default.PARAMS.CLIENT_KEY,t)},o.prototype.build=function(){return this.argString},o.prototype.buildDict=function(){return this.argValues},o);function o(){this.argString="",this.argValues={}}t.default=i},function(e,t,n){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0});var s={},i=(o.getFromLocalStorage=function(e){return!1===r?s[e]:localStorage[e]},o.saveToLocalStorage=function(t,n){if(!1!==r)try{localStorage[t]=n}catch(e){r=!1,s[t]=n}else s[t]=n},o.removeFromLocalStorage=function(t){if(!1!==r)try{localStorage.removeItem(t)}catch(e){r=!1,delete s[t]}else delete s[t]},o);function o(){}t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(s.prototype.setNetworkTimeout=function(e){this.networkTimeoutSeconds=e},s.prototype.ajax=function(e,t,n,r,s,i,o){var a=this;if(i){if(this.runningRequest)return this.enqueueRequest(arguments);this.runningRequest=!0}if("undefined"!=typeof XDomainRequest)return"http:"===location.protocol&&0===t.indexOf("https:")&&(t="http:"+t.substring(6)),this.ajaxIE8(e,t,n,r,s,i,o);var u=!1,c=new XMLHttpRequest;c.onreadystatechange=function(){if(4===c.readyState){if(u)return;var e,t=!(u=!0);if(o)e=c.responseText;else try{e=JSON.parse(c.responseText)}catch(e){setTimeout(function(){s&&s(null,c)},0),t=!0}t||(200<=c.status&&c.status<300?setTimeout(function(){r&&r(e,c)},0):setTimeout(function(){s&&s(e,c)},0)),i&&(a.runningRequest=!1,a.dequeueRequest())}},c.open(e,t,!0),c.setRequestHeader("Content-Type","text/plain"),c.send(n),setTimeout(function(){u||c.abort()},1e3*this.networkTimeoutSeconds)},s.prototype.ajaxIE8=function(e,t,n,r,s,i,o){var a=this,u=new XDomainRequest;u.onload=function(){var e,t=!1;if(o)e=u.responseText;else try{e=JSON.parse(u.responseText)}catch(e){setTimeout(function(){s&&s(null,u)},0),t=!0}t||setTimeout(function(){r&&r(e,u)},0),i&&(a.runningRequest=!1,a.dequeueRequest())},u.onerror=u.ontimeout=function(){setTimeout(function(){s&&s(null,u)},0),i&&(a.runningRequest=!1,a.dequeueRequest())},u.onprogress=function(){},u.open(e,t),u.timeout=1e3*this.networkTimeoutSeconds,u.send(n)},s.prototype.enqueueRequest=function(e){this.requestQueue.push(e)},s.prototype.dequeueRequest=function(){var e=this.requestQueue.shift();e&&this.ajax.apply(this,e)},s);function s(){this.networkTimeoutSeconds=10,this.requestQueue=[],this.runningRequest=!1}t.default=r},function(e,tt,t){(function(e,t){var r="__lodash_hash_undefined__",b=1,_=2,n=9007199254740991,S="[object Arguments]",y="[object Array]",s="[object AsyncFunction]",m="[object Boolean]",A="[object Date]",E="[object Error]",i="[object Function]",o="[object GeneratorFunction]",I="[object Map]",R="[object Number]",a="[object Null]",T="[object Object]",u="[object Promise]",c="[object Proxy]",M="[object RegExp]",O="[object Set]",D="[object String]",w="[object Symbol]",l="[object Undefined]",d="[object WeakMap]",N="[object ArrayBuffer]",C="[object DataView]",f=/^\[object .+?Constructor\]$/,p=/^(?:0|[1-9]\d*)$/,h={};h["[object Float32Array]"]=h["[object Float64Array]"]=h["[object Int8Array]"]=h["[object Int16Array]"]=h["[object Int32Array]"]=h["[object Uint8Array]"]=h["[object Uint8ClampedArray]"]=h["[object Uint16Array]"]=h["[object Uint32Array]"]=!0,h[S]=h[y]=h[N]=h[m]=h[C]=h[A]=h[E]=h[i]=h[I]=h[R]=h[T]=h[M]=h[O]=h[D]=h[d]=!1;var v="object"==typeof e&&e&&e.Object===Object&&e,g="object"==typeof self&&self&&self.Object===Object&&self,P=v||g||Function("return this")(),U=tt&&!tt.nodeType&&tt,k=U&&"object"==typeof t&&t&&!t.nodeType&&t,L=k&&k.exports===U,V=L&&v.process,F=function(){try{return V&&V.binding&&V.binding("util")}catch(e){}}(),j=F&&F.isTypedArray;function q(e,t){for(var n=-1,r=null==e?0:e.length;++n<r;)if(t(e[n],n,e))return 1}function H(e){var n=-1,r=Array(e.size);return e.forEach(function(e,t){r[++n]=[t,e]}),r}function K(e){var t=-1,n=Array(e.size);return e.forEach(function(e){n[++t]=e}),n}var x,W,Y,B=Array.prototype,G=Function.prototype,z=Object.prototype,J=P["__core-js_shared__"],X=G.toString,$=z.hasOwnProperty,Q=(x=/[^.]+$/.exec(J&&J.keys&&J.keys.IE_PROTO||""))?"Symbol(src)_1."+x:"",Z=z.toString,ee=RegExp("^"+X.call($).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),te=L?P.Buffer:void 0,ne=P.Symbol,re=P.Uint8Array,se=z.propertyIsEnumerable,ie=B.splice,oe=ne?ne.toStringTag:void 0,ae=Object.getOwnPropertySymbols,ue=te?te.isBuffer:void 0,ce=(W=Object.keys,Y=Object,function(e){return W(Y(e))}),le=je(P,"DataView"),de=je(P,"Map"),fe=je(P,"Promise"),pe=je(P,"Set"),he=je(P,"WeakMap"),ve=je(Object,"create"),ge=xe(le),_e=xe(de),Se=xe(fe),ye=xe(pe),be=xe(he),me=ne?ne.prototype:void 0,Ae=me?me.valueOf:void 0;function Ee(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function Ie(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function Re(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function Te(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new Re;++t<n;)this.add(e[t])}function Me(e){var t=this.__data__=new Ie(e);this.size=t.size}function Oe(e,t){var n=Be(e),r=!n&&Ye(e),s=!n&&!r&&Ge(e),i=!n&&!r&&!s&&Ze(e),o=n||r||s||i,a=o?function(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}(e.length,String):[],u=a.length;for(var c in e)!t&&!$.call(e,c)||o&&("length"==c||s&&("offset"==c||"parent"==c)||i&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||Ke(c,u))||a.push(c);return a}function De(e,t){for(var n=e.length;n--;)if(We(e[n][0],t))return n;return-1}function we(e,t,n){var r=t(e);return Be(e)?r:function(e,t){for(var n=-1,r=t.length,s=e.length;++n<r;)e[s+n]=t[n];return e}(r,n(e))}function Ne(e){return null==e?void 0===e?l:a:oe&&oe in Object(e)?function(e){var t=$.call(e,oe),n=e[oe];try{var r=!(e[oe]=void 0)}catch(e){}var s=Z.call(e);r&&(t?e[oe]=n:delete e[oe]);return s}(e):(t=e,Z.call(t));var t}function Ce(e){return $e(e)&&Ne(e)==S}function Pe(e,t,n,r,s){return e===t||(null==e||null==t||!$e(e)&&!$e(t)?e!=e&&t!=t:function(e,t,n,r,s,i){var o=Be(e),a=Be(t),u=o?y:He(e),c=a?y:He(t),l=(u=u==S?T:u)==T,d=(c=c==S?T:c)==T,f=u==c;if(f&&Ge(e)){if(!Ge(t))return!1;l=!(o=!0)}if(f&&!l)return i=i||new Me,o||Ze(e)?Le(e,t,n,r,s,i):function(e,t,n,r,s,i,o){switch(n){case C:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case N:return e.byteLength==t.byteLength&&i(new re(e),new re(t))?!0:!1;case m:case A:case R:return We(+e,+t);case E:return e.name==t.name&&e.message==t.message;case M:case D:return e==t+"";case I:var a=H;case O:var u=r&b;if(a=a||K,e.size!=t.size&&!u)return!1;var c=o.get(e);if(c)return c==t;r|=_,o.set(e,t);var l=Le(a(e),a(t),r,s,i,o);return o.delete(e),l;case w:if(Ae)return Ae.call(e)==Ae.call(t)}return!1}(e,t,u,n,r,s,i);if(!(n&b)){var p=l&&$.call(e,"__wrapped__"),h=d&&$.call(t,"__wrapped__");if(p||h){var v=p?e.value():e,g=h?t.value():t;return i=i||new Me,s(v,g,n,r,i)}}return f&&(i=i||new Me,function(e,t,n,r,s,i){var o=n&b,a=Ve(e),u=a.length,c=Ve(t).length;if(u!=c&&!o)return!1;var l=u;for(;l--;){var d=a[l];if(!(o?d in t:$.call(t,d)))return!1}var f=i.get(e);if(f&&i.get(t))return f==t;var p=!0;i.set(e,t),i.set(t,e);var h=o;for(;++l<u;){d=a[l];var v=e[d],g=t[d];if(r)var _=o?r(g,v,d,t,e,i):r(v,g,d,e,t,i);if(!(void 0===_?v===g||s(v,g,n,r,i):_)){p=!1;break}h=h||"constructor"==d}if(p&&!h){var S=e.constructor,y=t.constructor;S!=y&&"constructor"in e&&"constructor"in t&&!("function"==typeof S&&S instanceof S&&"function"==typeof y&&y instanceof y)&&(p=!1)}return i.delete(e),i.delete(t),p}(e,t,n,r,s,i))}(e,t,n,r,Pe,s))}function Ue(e){return Xe(e)&&!(Q&&Q in e)&&(ze(e)?ee:f).test(xe(e))}function ke(e){if(n=(t=e)&&t.constructor,r="function"==typeof n&&n.prototype||z,t!==r)return ce(e);var t,n,r,s=[];for(var i in Object(e))$.call(e,i)&&"constructor"!=i&&s.push(i);return s}function Le(e,t,r,s,i,o){var n=r&b,a=e.length,u=t.length;if(a!=u&&!(n&&a<u))return!1;var c=o.get(e);if(c&&o.get(t))return c==t;var l=-1,d=!0,f=r&_?new Te:void 0;for(o.set(e,t),o.set(t,e);++l<a;){var p=e[l],h=t[l];if(s)var v=n?s(h,p,l,t,e,o):s(p,h,l,e,t,o);if(void 0!==v){if(v)continue;d=!1;break}if(f){if(!q(t,function(e,t){return n=t,!f.has(n)&&(p===e||i(p,e,r,s,o))&&f.push(t);var n})){d=!1;break}}else if(p!==h&&!i(p,h,r,s,o)){d=!1;break}}return o.delete(e),o.delete(t),d}function Ve(e){return we(e,et,qe)}function Fe(e,t){var n,r,s=e.__data__;return("string"==(r=typeof(n=t))||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==n:null===n)?s["string"==typeof t?"string":"hash"]:s.map}function je(e,t){var n,r,s=(r=t,null==(n=e)?void 0:n[r]);return Ue(s)?s:void 0}Ee.prototype.clear=function(){this.__data__=ve?ve(null):{},this.size=0},Ee.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},Ee.prototype.get=function(e){var t=this.__data__;if(ve){var n=t[e];return n===r?void 0:n}return $.call(t,e)?t[e]:void 0},Ee.prototype.has=function(e){var t=this.__data__;return ve?void 0!==t[e]:$.call(t,e)},Ee.prototype.set=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=ve&&void 0===t?r:t,this},Ie.prototype.clear=function(){this.__data__=[],this.size=0},Ie.prototype.delete=function(e){var t=this.__data__,n=De(t,e);return!(n<0)&&(n==t.length-1?t.pop():ie.call(t,n,1),--this.size,!0)},Ie.prototype.get=function(e){var t=this.__data__,n=De(t,e);return n<0?void 0:t[n][1]},Ie.prototype.has=function(e){return-1<De(this.__data__,e)},Ie.prototype.set=function(e,t){var n=this.__data__,r=De(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this},Re.prototype.clear=function(){this.size=0,this.__data__={hash:new Ee,map:new(de||Ie),string:new Ee}},Re.prototype.delete=function(e){var t=Fe(this,e).delete(e);return this.size-=t?1:0,t},Re.prototype.get=function(e){return Fe(this,e).get(e)},Re.prototype.has=function(e){return Fe(this,e).has(e)},Re.prototype.set=function(e,t){var n=Fe(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this},Te.prototype.add=Te.prototype.push=function(e){return this.__data__.set(e,r),this},Te.prototype.has=function(e){return this.__data__.has(e)},Me.prototype.clear=function(){this.__data__=new Ie,this.size=0},Me.prototype.delete=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n},Me.prototype.get=function(e){return this.__data__.get(e)},Me.prototype.has=function(e){return this.__data__.has(e)},Me.prototype.set=function(e,t){var n=this.__data__;if(n instanceof Ie){var r=n.__data__;if(!de||r.length<199)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new Re(r)}return n.set(e,t),this.size=n.size,this};var qe=ae?function(t){return null==t?[]:(t=Object(t),function(e,t){for(var n=-1,r=null==e?0:e.length,s=0,i=[];++n<r;){var o=e[n];t(o,n,e)&&(i[s++]=o)}return i}(ae(t),function(e){return se.call(t,e)}))}:function(){return[]},He=Ne;function Ke(e,t){return(t=null==t?n:t)&&("number"==typeof e||p.test(e))&&-1<e&&e%1==0&&e<t}function xe(e){if(null!=e){try{return X.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function We(e,t){return e===t||e!=e&&t!=t}(le&&He(new le(new ArrayBuffer(1)))!=C||de&&He(new de)!=I||fe&&He(fe.resolve())!=u||pe&&He(new pe)!=O||he&&He(new he)!=d)&&(He=function(e){var t=Ne(e),n=t==T?e.constructor:void 0,r=n?xe(n):"";if(r)switch(r){case ge:return C;case _e:return I;case Se:return u;case ye:return O;case be:return d}return t});var Ye=Ce(function(){return arguments}())?Ce:function(e){return $e(e)&&$.call(e,"callee")&&!se.call(e,"callee")},Be=Array.isArray;var Ge=ue||function(){return!1};function ze(e){if(Xe(e)){var t=Ne(e);return t==i||t==o||t==s||t==c}}function Je(e){return"number"==typeof e&&-1<e&&e%1==0&&e<=n}function Xe(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function $e(e){return null!=e&&"object"==typeof e}var Qe,Ze=j?(Qe=j,function(e){return Qe(e)}):function(e){return $e(e)&&Je(e.length)&&!!h[Ne(e)]};function et(e){return(null!=(t=e)&&Je(t.length)&&!ze(t)?Oe:ke)(e);var t}t.exports=function(e,t){return Pe(e,t)}}).call(this,t(14),t(15)(e))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(s.decodeColor=function(e){var t=255&e,n=255&(e>>=8);return"rgba("+(255&(e>>=8))+","+n+","+t+","+(255&(e>>=8))/255+")"},s.encodeColor=function(e){if("number"==typeof e)return e;var t=/^rgba\((\d+),(\d+),(\d+),(\d+(\.\d+)?)\)$/.exec(e);if(t)return(255*parseInt(t[4],10)<<24)+((255&parseInt(t[1],10))<<16)+((255&parseInt(t[2],10))<<8)+(255&parseInt(t[3],10));var n=/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})$/i.exec(e);if(n)return(255<<24)+((255&parseInt(n[1],16))<<16)+((255&parseInt(n[2],16))<<8)+(255&parseInt(n[3],16));throw new Error('Could not parse color "'+e+'"')},s);function s(){}t.default=r},function(e,t,n){var r=n(7);e.exports=r.default},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var s=r(n(0)),i=r(n(8)),o=(a.setApiPath=function(e){a._lp.setApiPath(e)},a.setEmail=function(){},a.setNetworkTimeout=function(e){a._lp.setNetworkTimeout(e)},a.setAppIdForDevelopmentMode=function(e,t){a._lp.setAppIdForDevelopmentMode(e,t)},a.setAppIdForProductionMode=function(e,t){a._lp.setAppIdForProductionMode(e,t)},a.setSocketHost=function(e){a._lp.setSocketHost(e)},a.setDeviceId=function(e){a._lp.setDeviceId(e)},a.setAppVersion=function(e){a._lp.setAppVersion(e)},a.setDeviceName=function(e){a._lp.setDeviceName(e)},a.setDeviceModel=function(e){a._lp.setDeviceModel(e)},a.setRequestBatching=function(e,t){a._lp.setRequestBatching(e,t)},a.setSystemName=function(e){a._lp.setSystemName(e)},a.setSystemVersion=function(e){a._lp.setSystemVersion(e)},a.setVariables=function(e){a._lp.setVariables(e)},a.setVariantDebugInfoEnabled=function(e){a._lp.setVariantDebugInfoEnabled(e)},a.enableRichInAppMessages=function(e){a._lp.enableRichInAppMessages(e)},a.processMessageEvent=function(e,t){a._lp.processMessageEvent(e,t)},a.getVariantDebugInfo=function(){return a._lp.getVariantDebugInfo()},a.getVariables=function(){return a._lp.getVariables()},a.getVariable=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return(e=a._lp).getVariable.apply(e,t)},a.getVariants=function(){return a._lp.getVariants()},a.inbox=function(){return a._lp.inbox()},a.addStartResponseHandler=function(e){a._lp.addStartResponseHandler(e)},a.removeStartResponseHandler=function(e){a._lp.removeStartResponseHandler(e)},a.addVariablesChangedHandler=function(e){a._lp.addVariablesChangedHandler(e)},a.removeVariablesChangedHandler=function(e){a._lp.removeVariablesChangedHandler(e)},a.forceContentUpdate=function(e){a._lp.forceContentUpdate(e)},a.useSessionLength=function(e){a._lp.useSessionLength(e)},a.start=function(e,t,n){a._lp.start(e,t,n)},a.startFromCache=function(e,t,n){a._lp.startFromCache(e,t,n)},a.stop=function(){a._lp.stop()},a.pauseSession=function(){a._lp.pauseSession()},a.resumeSession=function(){a._lp.resumeSession()},a.pauseState=function(){a._lp.pauseState()},a.resumeState=function(){a._lp.resumeState()},a.getUserId=function(){return this._lp.getUserId()},a.setUserId=function(e){a.setUserAttributes(e)},a.setUserAttributes=function(e,t){a._lp.setUserAttributes(e,t)},a.track=function(e,t,n,r){a._lp.track(e,t,n,r)},a.trackPurchase=function(e,t,n,r){void 0===r&&(r="Purchase"),a._lp.trackPurchase(e,t,n,r)},a.advanceTo=function(e,t,n){a._lp.advanceTo(e,t,n)},a.isWebPushSupported=function(){return a._lp.isWebPushSupported()},a.isWebPushSubscribed=function(){return a._lp.isWebPushSubscribed()},a.setWebPushOptions=function(e){return a._lp.setWebPushOptions(e)},a.registerForWebPush=function(e){return a._lp.registerForWebPush(e)},a.unregisterFromWebPush=function(){return a._lp.unregisterFromWebPush()},a.clearUserContent=function(){a._lp.clearUserContent()},a.defineAction=function(e){a._lp.defineAction(e)},a.applyQueue=function(e){a._lp.applyQueue(e)},a.on=function(e,t){a._lp.on(e,t)},a.off=function(e,t){a._lp.off(e,t)},a.getFileUrl=function(e){return a._lp.getFileUrl(e)},a.__destroy=function(){this._lp=new i.default(window)},a._lp=new i.default(window),a.VERSION=s.default.SDK_VERSION,a);function a(){}t.default=o},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var s in t=arguments[n])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e}).apply(this,arguments)},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=s(n(1)),i=s(n(9)),a=s(n(0)),u=s(n(10)),c=s(n(11)),l=s(n(12)),d=s(n(13)),f=s(n(2)),p=s(n(17)),h=s(n(18)),v=s(n(19)),g=n(20),_=s(n(21)),S=a.default.DEFAULT_KEYS.SESSION,y=(b.prototype.setApiPath=function(e){this._lpRequest.apiPath&&(this._lpRequest.apiPath=e)},b.prototype.setNetworkTimeout=function(e){this._lpRequest.setNetworkTimeout(e),this._lpSocket.setNetworkTimeout(e)},b.prototype.setAppIdForDevelopmentMode=function(e,t){this._lpRequest.appId=e,this._lpRequest.clientKey=t,this._internalState.devMode=!0},b.prototype.setAppIdForProductionMode=function(e,t){this._lpRequest.appId=e,this._lpRequest.clientKey=t,this._internalState.devMode=!1},b.prototype.setSocketHost=function(e){this._lpSocket.setSocketHost(e)},b.prototype.setDeviceId=function(e){this._lpRequest.deviceId=e},b.prototype.setAppVersion=function(e){this._lpRequest.versionName=e},b.prototype.setDeviceName=function(e){this._deviceName=e},b.prototype.setDeviceModel=function(e){this._deviceModel=e},b.prototype.setRequestBatching=function(e,t){this._lpRequest.batchEnabled=e,this._lpRequest.batchCooldown=t},b.prototype.setSystemName=function(e){this._systemName=e},b.prototype.setSystemVersion=function(e){this._systemVersion=e},b.prototype.setVariables=function(e){this._varCache.setVariables(e)},b.prototype.setVariantDebugInfoEnabled=function(e){this._internalState.variantDebugInfoEnabled=e},b.prototype.enableRichInAppMessages=function(e){this._messages.enableRichInAppMessages(e)},b.prototype.processMessageEvent=function(e,t){this._messages.processMessageEvent(e,t)},b.prototype.getVariantDebugInfo=function(){return this._varCache.getVariantDebugInfo()},b.prototype.getVariables=function(){return this._varCache.getVariables()},b.prototype.getVariable=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return(e=this._varCache).getVariable.apply(e,t)},b.prototype.getVariants=function(){return this._varCache.variants||[]},b.prototype.inbox=function(){return this._lpInbox},b.prototype.on=function(e,t){this._events.on(e,t)},b.prototype.off=function(e,t){this._events.off(e,t)},b.prototype.onInboxAction=function(e,t){var n=this;this._messages.trackMessage(e,{event:"Open"},function(){return t&&n._messages.onAction(t)})},b.prototype.defineAction=function(e){this._varCache.registerActionDefinition(r({kind:g.MessageKind.Template},e))},b.prototype.addStartResponseHandler=function(e){this._internalState.addStartResponseHandler(e)},b.prototype.removeStartResponseHandler=function(e){this._internalState.removeStartResponseHandler(e)},b.prototype.addVariablesChangedHandler=function(e){this._varCache.addVariablesChangedHandler(e)},b.prototype.removeVariablesChangedHandler=function(e){this._varCache.removeVariablesChangedHandler(e)},b.prototype.getFileUrl=function(e){return this._lpRequest.getFileUrl(e)},b.prototype.forceContentUpdate=function(r){var s=this,e=(new o.default).add(a.default.PARAMS.INCLUDE_DEFAULTS,!1).add(a.default.PARAMS.INCLUDE_VARIANT_DEBUG_INFO,this._internalState.variantDebugInfoEnabled);this.createRequest(a.default.METHODS.GET_VARS,e,{queued:!1,sendNow:!0,response:function(e){var t=s._lpRequest.getLastResponse(e),n=s._lpRequest.isResponseSuccess(t);n&&(s._varCache.applyDiffs(t[a.default.KEYS.VARS],t[a.default.KEYS.VARIANTS],t[a.default.KEYS.ACTION_DEFINITIONS]),s._varCache.setVariantDebugInfo(t[a.default.KEYS.VARIANT_DEBUG_INFO]),s._events.emit("messagesReceived",t[a.default.KEYS.MESSAGES])),r&&r(n)}})},b.prototype.useSessionLength=function(e){this._sessionLength=e},b.prototype.start=function(e,t,n){var i=this;if("function"==typeof e?(n=e,t={},e=null):"object"==typeof e&&null!=e?(n=t,t=e,e=null):"function"==typeof t&&(n=t,t={}),this.hasActiveSession())return this.startFromCache(e,t,n);this._lpRequest.userId=e,n&&this.addStartResponseHandler(n),this._varCache.onUpdate=function(){i._varCache.triggerVariablesChangedHandlers()};var r=(new o.default).add(a.default.PARAMS.USER_ATTRIBUTES,JSON.stringify(t)).add(a.default.PARAMS.COUNTRY,a.default.VALUES.DETECT).add(a.default.PARAMS.REGION,a.default.VALUES.DETECT).add(a.default.PARAMS.CITY,a.default.VALUES.DETECT).add(a.default.PARAMS.LOCATION,a.default.VALUES.DETECT).add(a.default.PARAMS.SYSTEM_NAME,this._systemName||this._browserDetector.OS).add(a.default.PARAMS.SYSTEM_VERSION,(this._systemVersion||"").toString()).add(a.default.PARAMS.BROWSER_NAME,this._browserDetector.browser).add(a.default.PARAMS.BROWSER_VERSION,this._browserDetector.version.toString()).add(a.default.PARAMS.LOCALE,a.default.VALUES.DETECT).add(a.default.PARAMS.DEVICE_NAME,this._deviceName||this._browserDetector.browser+" "+this._browserDetector.version).add(a.default.PARAMS.DEVICE_MODEL,this._deviceModel||"Web Browser").add(a.default.PARAMS.NEWSFEED_MESSAGES,this._lpInbox.messageIds()).add(a.default.PARAMS.INCLUDE_DEFAULTS,!1).add(a.default.PARAMS.INCLUDE_VARIANT_DEBUG_INFO,this._internalState.variantDebugInfoEnabled);this.createRequest(a.default.METHODS.START,r,{queued:!0,sendNow:!0,response:function(e){i._internalState.hasStarted=!0;var t=i._lpRequest.getLastResponse(e),n=i._lpRequest.isResponseSuccess(t);if(i._internalState.startSuccessful=n){i.updateSession();var r=t[a.default.KEYS.MESSAGES];if(t.actionDefinitions&&(r.actionDefinitions=t.actionDefinitions),i._events.emit("messagesReceived",r),t[a.default.KEYS.SYNC_INBOX]&&i._lpInbox.downloadMessages(),i._internalState.devMode){var s=t[a.default.KEYS.LATEST_VERSION];s&&console.log("A newer version of the Leanplum SDK, "+s+', is available.\nUse "npm update leanplum-sdk" or go to https://docs.leanplum.com/reference#javascript-setup to download it.'),i.connectSocket()}i._varCache.applyDiffs(t[a.default.KEYS.VARS],t[a.default.KEYS.VARIANTS],t[a.default.KEYS.ACTION_DEFINITIONS]),i._varCache.setVariantDebugInfo(t[a.default.KEYS.VARIANT_DEBUG_INFO]),i._varCache.token=t[a.default.KEYS.TOKEN]}else i._varCache.loadDiffs();i._events.emit("start",{success:n}),i._internalState.triggerStartHandlers()}})},b.prototype.startFromCache=function(e,t,n){"function"==typeof e?(n=e,t={},e=null):"object"==typeof e&&null!=e?(n=t,t=e,e=null):"function"==typeof t&&(n=t,t={}),this.updateSession(),this._lpRequest.userId=e,n&&this.addStartResponseHandler(n),this._internalState.hasStarted=!0,this._internalState.startSuccessful=!0,this._internalState.devMode&&this.connectSocket(),this._varCache.loadDiffs(),this._events.emit("resume"),this._internalState.triggerStartHandlers()},b.prototype.stop=function(){this.createRequest(a.default.METHODS.STOP,void 0,{sendNow:!0,queued:!0,response:function(){f.default.removeFromLocalStorage(S)}})},b.prototype.pauseSession=function(){this.createRequest(a.default.METHODS.PAUSE_SESSION,void 0,{sendNow:!0,queued:!0})},b.prototype.resumeSession=function(){this._events.emit("resume"),this.createRequest(a.default.METHODS.RESUME_SESSION,void 0,{sendNow:!0,queued:!0})},b.prototype.pauseState=function(){this.createRequest(a.default.METHODS.PAUSE_STATE,void 0,{queued:!0})},b.prototype.resumeState=function(){this.createRequest(a.default.METHODS.RESUME_STATE,void 0,{queued:!0})},b.prototype.getUserId=function(){return this._lpRequest.userId},b.prototype.setUserId=function(e){this.setUserAttributes(e)},b.prototype.setUserAttributes=function(e,t){if(void 0===t)if("object"==typeof e)t=e,e=void 0;else if("string"!=typeof e)return void console.log("Leanplum: setUserAttributes expects a string or an object");var n=(new o.default).add(a.default.PARAMS.USER_ATTRIBUTES,t?JSON.stringify(t):void 0).add(a.default.PARAMS.NEW_USER_ID,e);this._events.emit("setUserAttribute",t),this.createRequest(a.default.METHODS.SET_USER_ATTRIBUTES,n,{queued:!0}),e&&(this._lpRequest.userId=e,f.default.saveToLocalStorage(a.default.DEFAULT_KEYS.USER_ID,this._lpRequest.userId))},b.prototype.track=function(e,t,n,r){var s=this;"object"==typeof t&&null!=t?(r=t,t=n=void 0):"string"==typeof t?(r=n,n=t,t=void 0):"object"==typeof n&&null!=n&&(r=n,n=void 0);var i=(new o.default).add(a.default.PARAMS.EVENT,e).add(a.default.PARAMS.VALUE,t||0).add(a.default.PARAMS.INFO,n).add(a.default.PARAMS.PARAMS,JSON.stringify(r));this._events.emit("track",{eventName:e,params:r}),this.createRequest(a.default.METHODS.TRACK,i,{queued:!0,response:function(){return s.updateSession()}})},b.prototype.trackPurchase=function(e,t,n,r){void 0===r&&(r="Purchase");var s=(new o.default).add(a.default.PARAMS.EVENT,r).add(a.default.PARAMS.VALUE,e||0).add(a.default.PARAMS.PARAMS,JSON.stringify(n));t&&s.add(a.default.PARAMS.CURRENCY_CODE,t),this._events.emit("track",{eventName:r}),this.createRequest(a.default.METHODS.TRACK,s,{queued:!0})},b.prototype.advanceTo=function(e,t,n){"object"==typeof t&&null!=t&&(n=t,t=void 0);var r=(new o.default).add(a.default.PARAMS.STATE,e).add(a.default.PARAMS.INFO,t).add(a.default.PARAMS.PARAMS,JSON.stringify(n));this._events.emit("advanceState",{state:e,params:n}),this.createRequest(a.default.METHODS.ADVANCE,r,{queued:!0})},b.prototype.isWebPushSupported=function(){return this._pushManager.isWebPushSupported()},b.prototype.isWebPushSubscribed=function(){return this._pushManager.isWebPushSubscribed()},b.prototype.setWebPushOptions=function(e){this._webPushOptions=r({},e)},b.prototype.registerForWebPush=function(e){var t=this;if(this._pushManager.isWebPushSupported()){var n=this._webPushOptions||{},r=e||n.serviceWorkerUrl,s=n&&n.scope?{scope:n.scope}:null;return this._pushManager.register(r,s,function(e){return e?Promise.resolve(!0):t._pushManager.subscribeUser()})}return Promise.reject("Leanplum: WebPush is not supported.")},b.prototype.unregisterFromWebPush=function(){return this._pushManager.unsubscribeUser()},b.prototype.clearUserContent=function(){this._varCache.clearUserContent()},b.prototype.applyQueue=function(e){var t=this;e.forEach(function(e){return t[e.name].apply(t,e.args)})},b.prototype.createRequest=function(e,t,n){void 0===n&&(n={}),this._lpRequest.request(e,t,r({devMode:this._internalState.devMode},n))},b.prototype.connectSocket=function(){this._lpSocket.connect({appId:this._lpRequest.appId,deviceId:this._lpRequest.deviceId})},b.prototype.hasActiveSession=function(){if(!this._sessionLength)return!1;var e=Date.now(),t=parseInt(f.default.getFromLocalStorage(S));return!isNaN(t)&&e-t<1e3*this._sessionLength},b.prototype.updateSession=function(){f.default.saveToLocalStorage(S,String(Date.now()))},b);function b(e){var n=this;this.wnd=e,this._events=new v.default,this._internalState=new u.default,this._lpInbox=new c.default(this.createRequest.bind(this),this.onInboxAction.bind(this)),this._lpRequest=new l.default,this._varCache=new _.default(this.createRequest.bind(this)),this._lpSocket=new d.default(this._varCache,this.createRequest.bind(this),this._lpRequest.getLastResponse.bind(this._lpRequest),this._events),this._pushManager=new p.default(this.createRequest.bind(this)),this._messages=new h.default(this._events,this.createRequest.bind(this),this.getFileUrl.bind(this)),this._browserDetector=new i.default(e),this._events.on("navigationChange",function(e){var t=!1;n._events.emit("openUrl",{preventDefault:function(){return t=!0},url:e}),t||n.wnd.location.assign(e)}),this._events.on("registerForPush",function(){return n.registerForWebPush()})}t.default=y},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(s.prototype.searchString=function(e){for(var t=0;t<e.length;t++){var n=e[t].string,r=e[t].prop;if(this.versionSearchString=e[t].versionSearch||e[t].identity,n){if(-1!==n.indexOf(e[t].subString))return e[t].identity}else if(r)return e[t].identity}},s.prototype.searchVersion=function(e){if(e){var t=e.indexOf(this.versionSearchString);if(-1!==t)return parseFloat(e.substring(t+this.versionSearchString.length+1))}},s.prototype.getBrowserData=function(e){return[{string:e.navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:e.navigator.userAgent,subString:"OmniWeb",identity:"OmniWeb",versionSearch:"OmniWeb/"},{string:e.navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:e.opera,identity:"Opera",versionSearch:"Version"},{string:e.navigator.vendor,subString:"iCab",identity:"iCab"},{string:e.navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:e.navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:e.navigator.vendor,subString:"Camino",identity:"Camino"},{string:e.navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:e.navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:e.navigator.userAgent,subString:"Android",identity:"Android Browser",versionSearch:"Version"},{string:e.navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:e.navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}]},s.prototype.getOSData=function(e){return[{string:e.navigator.platform,subString:"Win",identity:"Windows"},{string:e.navigator.platform,subString:"Mac",identity:"Mac OS"},{string:e.navigator.userAgent,subString:"iPhone",identity:"iOS"},{string:e.navigator.userAgent,subString:"Android",identity:"Android"},{string:e.navigator.platform,subString:"Linux",identity:"Linux"}]},s);function s(e){this.browser=this.searchString(this.getBrowserData(e))||"Unknown Browser",this.version=this.searchVersion(e.navigator.userAgent)||this.searchVersion(e.navigator.appVersion)||"Unknown Version",this.OS=this.searchString(this.getOSData(e))||"Unknown OS"}t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(s.prototype.addStartResponseHandler=function(e){this.startHandlers.push(e),this.hasStarted&&e(this.startSuccessful)},s.prototype.removeStartResponseHandler=function(e){var t=this.startHandlers.indexOf(e);0<=t&&this.startHandlers.splice(t,1)},s.prototype.triggerStartHandlers=function(){for(var e=0;e<this.startHandlers.length;e++)this.startHandlers[e](this.startSuccessful)},s);function s(){this.startHandlers=[],this.devMode=!1,this.hasStarted=!1,this.startSuccessful=!1,this.variantDebugInfoEnabled=!1}t.default=r},function(e,t,n){"use strict";var v=this&&this.__assign||function(){return(v=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var s in t=arguments[n])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e}).apply(this,arguments)},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});function s(t){return Object.keys(t).map(function(e){return t[e]})}var i=r(n(1)),g=r(n(0)),o=(a.prototype.downloadMessages=function(){var n=this;this.createRequest("getNewsfeedMessages",void 0,{queued:!0,sendNow:!0,response:function(e){var t=e.response[0];t&&t.newsfeedMessages&&(n.messageMap=t.newsfeedMessages,n.triggerChangeHandlers())}})},a.prototype.markAsRead=function(e){var t=this.messageMap[e];if(t&&!t.isRead){t.isRead=!0,this.triggerChangeHandlers();var n=new i.default;n.add("newsfeedMessageId",e),this.createRequest("markNewsfeedMessageAsRead",n,{})}},a.prototype.read=function(e){this.markAsRead(e);var t=this.message(e),n=e.split("##")[0],r=(null==t?void 0:t.openAction())||null;this.onAction(n,r)},a.prototype.remove=function(e){if(this.messageMap[e]){delete this.messageMap[e],this.triggerChangeHandlers();var t=new i.default;t.add("newsfeedMessageId",e),this.createRequest("deleteNewsfeedMessage",t,{})}},a.prototype.onChanged=function(e){this.changeHandlers.push(e)},a.prototype.triggerChangeHandlers=function(){this.changeHandlers.forEach(function(e){return e()}),this.save()},a.prototype.save=function(){sessionStorage.setItem(g.default.DEFAULT_KEYS.INBOX_MESSAGES,JSON.stringify(this.messageMap))},a.prototype.load=function(){var e=sessionStorage.getItem(g.default.DEFAULT_KEYS.INBOX_MESSAGES);this.messageMap=JSON.parse(e)||{}},a.prototype.count=function(){return s(this.messageMap).length},a.prototype.unreadCount=function(){return s(this.messageMap).filter(function(e){return!e.isRead}).length},a.prototype.messages=function(e){var t=[];for(var n in this.messageMap){var r=this.messageMap[n];e(r)&&t.push(u.create(n,r))}return t},a.prototype.allMessages=function(){return this.messages(function(){return!0})},a.prototype.unreadMessages=function(){return this.messages(function(e){return!e.isRead})},a.prototype.messageIds=function(){return Object.keys(this.messageMap)},a.prototype.message=function(e){var t=this.messageMap[e];return t?u.create(e,t):null},a);function a(e,t){this.createRequest=e,this.onAction=t,this.messageMap={},this.changeHandlers=[],this.load()}t.default=o;var u=(_.create=function(e,t){var n,r,s,i,o,a,u,c,l,d,f,p=null===(n=t.messageData)||void 0===n?void 0:n.parentCampaignId,h=v(v({},null===(s=null===(r=t.messageData)||void 0===r?void 0:r.vars)||void 0===s?void 0:s[g.default.VALUES.DEFAULT_PUSH_ACTION]),{parentCampaignId:p});return new _(e,null===(o=null===(i=t.messageData)||void 0===i?void 0:i.vars)||void 0===o?void 0:o.Title,null===(u=null===(a=t.messageData)||void 0===a?void 0:a.vars)||void 0===u?void 0:u.Subtitle,null===(l=null===(c=t.messageData)||void 0===c?void 0:c.vars)||void 0===l?void 0:l.Data,t.deliveryTimestamp,t.isRead,null===(f=null===(d=t.messageData)||void 0===d?void 0:d.vars)||void 0===f?void 0:f.Image,h)},_.prototype.id=function(){return this._id},_.prototype.title=function(){return this._title},_.prototype.subtitle=function(){return this._subtitle},_.prototype.data=function(){return this._data},_.prototype.timestamp=function(){return this._timestamp},_.prototype.isRead=function(){return this._isRead},_.prototype.imageUrl=function(){return this._imageUrl},_.prototype.openAction=function(){return this._openAction},_);function _(e,t,n,r,s,i,o,a){this._id=e,this._title=t,this._subtitle=n,this._data=r,this._timestamp=s,this._isRead=i,this._imageUrl=o,this._openAction=a}t.LeanplumInboxMessage=u},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var h=r(n(1)),v=r(n(0)),s=r(n(2)),i=r(n(3)),o=(Object.defineProperty(a.prototype,"userId",{get:function(){var e,t;return null!==(t=null!==(e=this.userIdValue)&&void 0!==e?e:this.loadLocal(v.default.DEFAULT_KEYS.USER_ID))&&void 0!==t?t:this.deviceId},set:function(e){this.userIdValue=e},enumerable:!0,configurable:!0}),a.prototype.request=function(e,t,r){var s=this;if(void 0===r&&(r={}),r=r||{},t=t||new h.default,this.deviceId||(this.deviceId=this.loadLocal(v.default.DEFAULT_KEYS.DEVICE_ID)),!this.deviceId){for(var n="",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",o=0;o<16;o++)n+=i.charAt(Math.floor(Math.random()*i.length));this.deviceId=n,this.saveLocal(v.default.DEFAULT_KEYS.DEVICE_ID,n)}this.saveLocal(v.default.DEFAULT_KEYS.USER_ID,this.userId);var a=t.attachApiKeys(this.appId,this.clientKey).add(v.default.PARAMS.SDK_VERSION,v.default.SDK_VERSION).add(v.default.PARAMS.DEVICE_ID,this.deviceId).add(v.default.PARAMS.USER_ID,this.userId).add(v.default.PARAMS.ACTION,e).add(v.default.PARAMS.VERSION_NAME,this.versionName).add(v.default.PARAMS.DEV_MODE,r.devMode).add(v.default.PARAMS.TIME,((new Date).getTime()/1e3).toString()),u=r.success||r.response,c=r.error||r.response;if(!this.appId||!this.clientKey){var l="Leanplum App ID and client key are not set. Make sure you are calling setAppIdForDevelopmentMode or setAppIdForProductionMode before issuing API calls.";return console.error(l),void(c&&c(l))}if(t.body())this.network.ajax("POST",this.apiPath+"?"+a.build(),t.body(),u,c,r.queued);else{var d=r.devMode||r.sendNow||!this.batchEnabled,f=function(){var e=s.popUnsentRequests();if(0<e.length){var t=JSON.stringify({data:e}),n=(new h.default).attachApiKeys(s.appId,s.clientKey).add(v.default.PARAMS.SDK_VERSION,v.default.SDK_VERSION).add(v.default.PARAMS.ACTION,v.default.METHODS.MULTI).add(v.default.PARAMS.TIME,((new Date).getTime()/1e3).toString().toString()).build();s.network.ajax("POST",s.apiPath+"?"+n,t,u,c,r.queued)}};if(!d&&this.batchCooldown){var p=(new Date).getTime()/1e3;!this.lastRequestTime||p-this.lastRequestTime>=this.batchCooldown?(d=!0,this.lastRequestTime=p):this.cooldownTimeout||(this.cooldownTimeout=setTimeout(function(){s.cooldownTimeout=null,s.lastRequestTime=(new Date).getTime()/1e3,f()},1e3*(this.batchCooldown-(p-this.lastRequestTime))))}this.saveRequestForLater(a.buildDict()),d&&f()}},a.prototype.getFileUrl=function(e){if(!e)return"";var t=(new h.default).attachApiKeys(this.appId,this.clientKey).add(v.default.PARAMS.SDK_VERSION,v.default.SDK_VERSION).add(v.default.PARAMS.ACTION,"downloadFile").add("filename",e);return this.apiPath+"?"+t.build()},a.prototype.setNetworkTimeout=function(e){this.network.setNetworkTimeout(e)},a.prototype.getLastResponse=function(e){var t,n,r,s=null!==(n=null===(t=null==e?void 0:e.response)||void 0===t?void 0:t.length)&&void 0!==n?n:0;return 0<s?null===(r=null==e?void 0:e.response)||void 0===r?void 0:r[s-1]:null},a.prototype.isResponseSuccess=function(e){return Boolean(null==e?void 0:e.success)},a.prototype.saveRequestForLater=function(e){var t=this.loadLocal(v.default.DEFAULT_KEYS.COUNT)||0,n=v.default.DEFAULT_KEYS.ITEM+t;this.saveLocal(n,JSON.stringify(e)),t++,this.saveLocal(v.default.DEFAULT_KEYS.COUNT,t)},a.prototype.popUnsentRequests=function(){var e=[],t=this.loadLocal(v.default.DEFAULT_KEYS.COUNT)||0;this.removeLocal(v.default.DEFAULT_KEYS.COUNT);for(var n=0;n<t;n++){var r=v.default.DEFAULT_KEYS.ITEM+n;try{e.push(JSON.parse(this.loadLocal(r)))}catch(e){}this.removeLocal(r)}return e},a.prototype.loadLocal=function(e){return s.default.getFromLocalStorage(e)},a.prototype.saveLocal=function(e,t){s.default.saveToLocalStorage(e,t)},a.prototype.removeLocal=function(e){s.default.removeFromLocalStorage(e)},a);function a(e){void 0===e&&(e=new i.default),this.network=e,this.cooldownTimeout=null,this.lastRequestTime=void 0,this.userIdValue=void 0,this.apiPath="https://api.leanplum.com/api",this.batchCooldown=5,this.batchEnabled=!0}t.default=o},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(n(4)),a=r(n(1)),u=r(n(0)),s=r(n(16)),i=(c.prototype.connect=function(t){var n=this;if(WebSocket){var r=!1;this.socketClient=new s.default,this.socketClient.setNetworkTimeout(this.networkTimeoutSeconds),this.socketClient.onopen=function(){var e;r||(console.log("Leanplum: Connected to development server."),n.socketClient.send("auth",((e={})[u.default.PARAMS.APP_ID]=t.appId,e[u.default.PARAMS.DEVICE_ID]=t.deviceId,e)),r=!0)},this.socketClient.onerror=function(e){console.log("Leanplum: Socket error",e)},this.socketClient.onmessage=this.onMessageReceived.bind(this),this.socketClient.onclose=function(){console.log("Leanplum: Disconnected from development server."),r=!1},this.socketClient.connect(this.socketHost),setInterval(function(){n.socketClient.connected||n.socketClient.connecting||n.socketClient.connect(n.socketHost)},5e3)}else console.log("Your browser doesn't support WebSockets.")},c.prototype.setSocketHost=function(e){this.socketHost=e},c.prototype.setNetworkTimeout=function(e){var t;this.networkTimeoutSeconds=e,null!==(t=this.socketClient)&&void 0!==t&&t.setNetworkTimeout(e)},c.prototype.onMessageReceived=function(e,t){var i=this;if("updateVars"===e){var n=(new a.default).add(u.default.PARAMS.INCLUDE_DEFAULTS,!1);this.createRequest(u.default.METHODS.GET_VARS,n,{queued:!1,sendNow:!0,response:function(e){var t=i.getLastResponse(e),n=t[u.default.KEYS.VARS],r=t[u.default.KEYS.VARIANTS],s=t[u.default.KEYS.ACTION_DEFINITIONS];o.default(n,i.cache.diffs)||i.cache.applyDiffs(n,r,s)}})}else if("getVariables"===e)this.cache.sendVariables(),this.socketClient.send("getContentResponse",{updated:!0});else if("getActions"===e){var r=this.cache.sendActions();this.socketClient.send("getContentResponse",{updated:r})}else if("registerDevice"===e){var s=t[0];alert("Your device has been registered to "+s.email+".")}else"trigger"===e&&(s=t[0],this.events.emit("previewRequest",s))},c);function c(e,t,n,r){this.cache=e,this.createRequest=t,this.getLastResponse=n,this.events=r,this.networkTimeoutSeconds=10,this.socketClient=null,this.socketHost="dev.leanplum.com"}t.default=i},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var s=r(n(3)),i=(o.prototype.connect=function(i){var a=this;this.connecting=!0,this.network.ajax("POST","https://"+i+"/socket.io/1","",function(e){var t=e.split(":"),n=t[0],r=parseInt(t[1])/2*1e3;a.socket=new WebSocket("wss://"+i+"/socket.io/1/websocket/"+n);var s=null;a.socket.onopen=function(){a.connected=!0,a.connecting=!1,a.onopen&&a.onopen(),s=setInterval(function(){a.socket.send("2:::")},r)},a.socket.onclose=function(){a.connected=!1,clearInterval(s),a.onclose&&a.onclose()},a.socket.onmessage=function(e){var t=e.data.split(":"),n=parseInt(t[0]);if(2===n)a.socket.send("2::");else if(5===n){var r=t[1],s=JSON.parse(t.slice(3).join(":")),i=s.name,o=s.args;r&&a.socket.send("6:::"+r),a.onmessage&&a.onmessage(i,o)}else 7===n&&console.log("Socket error: "+e.data)},a.socket.onerror=function(e){a.socket.close(),a.onerror&&a.onerror(e)}},null,!1,!0)},o.prototype.send=function(e,t){if(this.connected){var n=JSON.stringify({name:e,args:t});this.socket.send("5:::"+n)}else console.log("Leanplum: Socket is not connected.")},o.prototype.setNetworkTimeout=function(e){this.network.setNetworkTimeout(e)},o);function o(){this.network=new s.default,this.connected=!1,this.connecting=!1,this.connected=!1,this.connecting=!1}t.default=i},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,o,a,u){return new(a=a||Promise)(function(n,t){function r(e){try{i(u.next(e))}catch(e){t(e)}}function s(e){try{i(u.throw(e))}catch(e){t(e)}}function i(e){var t;e.done?n(e.value):((t=e.value)instanceof a?t:new a(function(e){e(t)})).then(r,s)}i((u=u.apply(e,o||[])).next())})},u=this&&this.__generator||function(n,r){var s,i,o,e,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(s)throw new TypeError("Generator is already executing.");for(;a;)try{if(s=1,i&&(o=2&t[0]?i.return:t[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,t[1])).done)return o;switch(i=0,o&&(t=[2&t[0],o.value]),t[0]){case 0:case 1:o=t;break;case 4:return a.label++,{value:t[1],done:!1};case 5:a.label++,i=t[1],t=[0];continue;case 7:t=a.ops.pop(),a.trys.pop();continue;default:if(!(o=0<(o=a.trys).length&&o[o.length-1])&&(6===t[0]||2===t[0])){a=0;continue}if(3===t[0]&&(!o||t[1]>o[0]&&t[1]<o[3])){a.label=t[1];break}if(6===t[0]&&a.label<o[1]){a.label=o[1],o=t;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(t);break}o[2]&&a.ops.pop(),a.trys.pop();continue}t=r.call(n,a)}catch(e){t=[6,e],i=0}finally{s=o=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var i=s(n(1)),o=s(n(0)),a=s(n(2)),c=(Object.defineProperty(l.prototype,"serviceWorker",{get:function(){return window.navigator.serviceWorker},enumerable:!0,configurable:!0}),l.prototype.isWebPushSupported=function(){return Boolean(void 0!==(null===window||void 0===window?void 0:window.navigator)&&"serviceWorker"in window.navigator&&"PushManager"in window)},l.prototype.isWebPushSubscribed=function(){return r(this,void 0,void 0,function(){var t,n,r;return u(this,function(e){switch(e.label){case 0:return this.isWebPushSupported()?[4,this.getServiceWorkerRegistration()]:[2,!1];case 1:return(t=e.sent())?[4,t.pushManager.getSubscription()]:[2,!1];case 2:return n=e.sent(),(r=null!==n)&&this.updateNewSubscriptionOnServer(n),[2,r]}})})},l.prototype.register=function(i,o,a){return r(this,void 0,void 0,function(){var t,n,r,s;return u(this,function(e){switch(e.label){case 0:if(!this.isWebPushSupported())return console.log("Leanplum: Push messaging is not supported."),[2,a(!1)];e.label=1;case 1:return e.trys.push([1,4,,5]),[4,(t=this).serviceWorker.register(i||"/sw.min.js",o)];case 2:return t.serviceWorkerRegistration=e.sent(),[4,this.serviceWorkerRegistration.pushManager.getSubscription()];case 3:return n=e.sent(),(r=null!==n)&&this.updateNewSubscriptionOnServer(n),[2,a(r)];case 4:return s=e.sent(),console.log("Leanplum: Service Worker Error: ",s),[2,a(!1)];case 5:return[2]}})})},l.prototype.subscribeUser=function(){return r(this,void 0,void 0,function(){var t,n,r;return u(this,function(e){switch(e.label){case 0:t=this.urlB64ToUint8Array("BInWPpWntfR39rgXSP04pqdmEdDGa50z6zqbMvxyxJCwzXIuSpSh8C888-CfJ82WELl7Xe8cjAnfCt-3vK0Ci68"),e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this.serviceWorkerRegistration.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:t})];case 2:if(!(n=e.sent()))throw new Error;return this.updateNewSubscriptionOnServer(n),[3,4];case 3:throw r=e.sent(),new Error("Leanplum: Failed to subscribe the user: "+r);case 4:return[2,!0]}})})},l.prototype.unsubscribeUser=function(){return r(this,void 0,void 0,function(){var t,n;return u(this,function(e){switch(e.label){case 0:return[4,this.isWebPushSubscribed()];case 1:if(!e.sent())return[3,6];e.label=2;case 2:return e.trys.push([2,5,,6]),[4,this.serviceWorkerRegistration.pushManager.getSubscription()];case 3:if(!(t=e.sent()))throw new Error;return[4,t.unsubscribe()];case 4:return e.sent(),[3,6];case 5:throw n=e.sent(),new Error("Leanplum: Error unsubscribing: "+n);case 6:return[2]}})})},l.prototype.getServiceWorkerRegistration=function(){return r(this,void 0,void 0,function(){var t;return u(this,function(e){switch(e.label){case 0:return this.serviceWorkerRegistration?[3,2]:[4,(t=this).serviceWorker.getRegistration()];case 1:t.serviceWorkerRegistration=e.sent(),e.label=2;case 2:return[2,this.serviceWorkerRegistration]}})})},l.prototype.urlB64ToUint8Array=function(e){for(var t=(e+"=".repeat((4-e.length%4)%4)).replace(/-/g,"+").replace(/_/g,"/"),n=this.decodeData(t),r=new Uint8Array(n.length),s=0;s<n.length;++s)r[s]=n.charCodeAt(s);return r},l.prototype.updateNewSubscriptionOnServer=function(e){if(e){var t=this.prepareSubscription(e),n=JSON.stringify(t);a.default.getFromLocalStorage(o.default.DEFAULT_KEYS.PUSH_SUBSCRIPTION)!==n&&(a.default.saveToLocalStorage(o.default.DEFAULT_KEYS.PUSH_SUBSCRIPTION,n),this.setSubscription(n))}},l.prototype.prepareSubscription=function(e){var t="getKey"in e?e.getKey("p256dh"):[],n="getKey"in e?e.getKey("auth"):[],r=this.encodeData(String.fromCharCode.apply(null,new Uint8Array(t))),s=this.encodeData(String.fromCharCode.apply(null,new Uint8Array(n)));return{endpoint:e.endpoint,key:r,auth:s}},l.prototype.setSubscription=function(e){if(e){var t=(new i.default).add(o.default.PARAMS.WEB_PUSH_SUBSCRIPTION,e);this.createRequest(o.default.METHODS.SET_DEVICE_ATTRIBUTES,t,{queued:!1,sendNow:!0})}},l.prototype.encodeData=function(e){return window.btoa(e)},l.prototype.decodeData=function(e){return window.atob(e)},l);function l(e){this.createRequest=e,this.serviceWorkerRegistration=null}t.default=c},function(e,t,n){"use strict";var a=this&&this.__assign||function(){return(a=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var s in t=arguments[n])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e}).apply(this,arguments)},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var i=r(n(0)),o=r(n(1)),s=r(n(3)),u=r(n(4)),c=r(n(2)),l=r(n(5)),d=(f.prototype.recordOccurrence=function(e){var t=(this.session[e]||0)+1;this.session[e]=t;var n=this.occurrences[e]||[];n.push(Date.now()),this.occurrences[e]=n,this.save()},f.prototype.recordTriggerOccurrence=function(e){var t=this.triggers[e]||[];return t.push(Date.now()),this.triggers[e]=t,this.save(),t.length},f.prototype.getSessionOccurranceCount=function(e){return this.session[e]||0},f.prototype.getOccurrences=function(e){return this.occurrences[e]||[]},f.prototype.clearSession=function(){this.session={}},f.prototype.load=function(){var e=c.default.getFromLocalStorage(i.default.DEFAULT_KEYS.MESSAGE_OCCURRENCES);if(e){var t=JSON.parse(e);this.session=t.session,this.triggers=t.triggers,this.occurrences=t.occurrences}},f.prototype.save=function(){var e=i.default.DEFAULT_KEYS.MESSAGE_OCCURRENCES;c.default.saveToLocalStorage(e,JSON.stringify({session:this.session,triggers:this.triggers,occurrences:this.occurrences}))},f);function f(){this.session={},this.triggers={},this.occurrences={}}var p=(h.prototype.enableRichInAppMessages=function(e){this._showRichIAM=e},h.prototype.onTrigger=function(t){var n=this,r=this.getMessages();Object.keys(r).filter(function(e){return n.shouldShowMessage(e,r[e],t)}).slice(0,1).forEach(function(e){return n.showMessage(e,r[e])})},h.prototype.onMessagePreview=function(n){var e=n.action,t={track:function(e){var t=e?"event '"+e+"'":"impression";console.log("Tracking "+t+" for "+n.messageId)},runActionNamed:function(e){return console.log("Running untracked action '"+e+"'")},runTrackedActionNamed:function(e){return console.log("Running tracked action '"+e+"'")}};this.handleMessage({isPreview:!0,message:a({messageId:n.messageId},e),context:t})},h.prototype.onMessagesReceived=function(e){var t=e||{};this._messageCache=t,c.default.saveToLocalStorage(i.default.DEFAULT_KEYS.MESSAGE_CACHE,JSON.stringify(t))},h.prototype.shouldShowMessage=function(e,t,n){var r=Date.now(),s=this.matchesTrigger(t.whenTriggers,n),i=this.matchesTrigger(t.unlessTriggers,n);if(!s||i)return!1;var o=this.occurrenceTracker.recordTriggerOccurrence(e);return!!this.matchesLimits(e,t.whenLimits,o)&&!(t.startTime&&t.endTime&&(r<t.startTime||t.endTime<r))},h.prototype.showMessage=function(s,e){var i=this,n=this.addDefaults(a({},e.vars)),t={track:function(e,t,n,r){i.occurrenceTracker.recordOccurrence(s),i.trackMessage(s,{event:e,value:t,info:n,params:r})},runActionNamed:function(e){return i.onAction(n[e],s)},runTrackedActionNamed:function(e){var t=e.replace(/ action$/,"");i.trackMessage(s,{event:t},function(){return i.onAction(n[e],s)})}};this.handleMessage({context:t,message:a({messageId:s},n)})},h.prototype.processMessageEvent=function(e,t){var n=document.getElementById("lp-message-"+e);if(n){var r=t.replace(/^http:\/\/leanplum\//,"").split("?"),s=r[0],i=r[1],o=(void 0===i?"":i).split("&").reduce(function(e,t){var n=t.split("="),r=n[0],s=n[1];return e[r]=decodeURIComponent(s),e},{}),a=n.metadata,u=a.message,c=a.context;switch(s){case"loadFinished":if(n.style.visibility="visible",n.style.left="0",0<u["HTML Height"]){var l=u["HTML Width"];n.style.height=u["HTML Height"]+"px",n.style.width=l,n.style.left="calc((100% - "+l+") / 2)";var d=u["HTML Align"].toLowerCase(),f="top"===d?"bottom":"top";n.style[d]="0",n.style[f]=""}else n.style.top="0";c.track();break;case"track":c.track(o.event,parseFloat(o.value),o.parameters,o.info);break;case"runAction":case"runTrackedAction":c[s+"Named"](o.action);case"close":n.metadata=null,n.parentNode.removeChild(n)}}else console.log("message closed, skipping event processing")},h.prototype.handleMessage=function(t){var n=this;if(this._showRichIAM&&"HTML"===t.message.__name__){this.resolveFiles(t.message);var e=t.message.Template||"";(new s.default).ajax("get",e.replace("-10.html","-11.html"),"",function(e){return n.renderRichInAppMessage(e,t)},function(){},!1,!0)}else this.events.emit("showMessage",this.resolveFields(t))},h.prototype.renderRichInAppMessage=function(e,t){var n=t.message.messageId,r=JSON.stringify(t.message),s=document.createElement("iframe");s.setAttribute("id","lp-message-"+n),s.style.cssText=["border-width: 0","position: fixed","top: -100%","left: -100%","width: 100%","height: 100%","visibility: hidden","z-index: 100000"].join(";"),document.body.appendChild(s),s.metadata=t,s.contentWindow.messageId=n;var i=e.replace("##Vars##",r).replace("<body>","<body><script>window.messageId='"+n+"'<\/script>");if("srcdoc"in s)s.srcdoc=i;else{var o=s.contentWindow.document;o.open(),o.write(i),o.close()}},h.prototype.trackMessage=function(e,t,n){function r(e){return void 0!==e}void 0===t&&(t={event:null}),void 0===n&&(n=function(){});var s=(new o.default).add(i.default.PARAMS.MESSAGE_ID,e);t.event&&s.add(i.default.PARAMS.EVENT,t.event),r(t.value)&&s.add(i.default.PARAMS.VALUE,t.value||0),r(t.info)&&s.add(i.default.PARAMS.INFO,t.info),r(t.params)&&s.add(i.default.PARAMS.PARAMS,JSON.stringify(t.params)),this.createRequest(i.default.METHODS.TRACK,s,{queued:!0,sendNow:!0,response:n})},h.prototype.onAction=function(t,n){var r=this;if(void 0===n&&(n=""),t){var e=this._messageCache;if("Chain to Existing Message"!==t.__name__){var s=function(){var e=t.__name__;"Open URL"===t.__name__?r.events.emit("navigationChange",t.URL):"Register For Push"===t.__name__?r.events.emit("registerForPush"):e&&r.showMessage(n,{messageId:n,action:e,vars:t})},i=this.messageIdFromAction(t);i?this.trackMessage(i,{event:null},s):s()}else{var o=t["Chained message"],a=e[o];"Open URL"===a.action?this.trackMessage(o,{event:"View"},function(){return r.onAction(a.vars,o)}):"Register For Push"===a.action?this.events.emit("registerForPush"):this.showMessage(o,a)}}},h.prototype.getMessages=function(){return this._messageCache||{}},h.prototype.addDefaults=function(e){var t=(this.getMessages().actionDefinitions||{})[e.__name__];return t?function e(t,n){for(var r=0,s=Object.keys(n);r<s.length;r++){var i=s[r],o=n[i];"object"==typeof o?t[i]=e(t[i]||{},o):void 0===t[i]&&(t[i]=o)}return t}(a({},e),t.values):e},h.prototype.resolveFiles=function(e){var t=/^__file__/;for(var n in e)t.test(n)?e[n.replace(t,"")]=this.getFileUrl(e[n]):"object"==typeof e[n]&&(e[n]=this.resolveFiles(e[n]));return e},h.prototype.resolveFields=function(e){var t=/\bcolor/i,n=/^__file__/;for(var r in e)n.test(r)?e[r.replace(n,"")+" URL"]=this.getFileUrl(e[r]):t.test(r)?e[r]=l.default.decodeColor(e[r]):"object"==typeof e[r]&&(e[r]=this.resolveFields(e[r]));return e},h.prototype.messageIdFromAction=function(e){var t=this._messageCache,n=a({},e);delete n.parentCampaignId;for(var r=0,s=Object.keys(t);r<s.length;r++){var i=s[r],o=t[i];if(o.parentCampaignId===e.parentCampaignId&&u.default(o.vars,n))return i}},h.prototype.matchesTrigger=function(e,s){if(!e)return!1;function u(e,t){return 0===e.toString().localeCompare(t.toString(),void 0,{sensitivity:"accent"})}function i(e,t,n){var r=e===n.noun;if("triggers"===n.verb)return r;if("triggersWithParameter"===n.verb){var s=n.objects,i=s[0],o=s[1],a=i in t&&u(o,t[i]);return r&&a}}return e.children.some(function(e){var t=e.subject;switch(s.trigger){case"start":return"start"===t||"resume"===t;case"resume":return"resume"===t;case"event":return"event"===t&&i(s.eventName,s.params,e);case"userAttribute":if("userAttribute"!==t)return!1;var n=e.noun in s.attributes;if("changes"===e.verb)return n;if("changesTo"!==e.verb)break;if(!n)return!1;var r=s.attributes[e.noun];return e.objects.some(function(e){return null===e&&null===r||e&&r&&u(e,r)});case"state":return"state"===t&&i(s.state,s.params,e)}return!1})},h.prototype.matchesLimits=function(u,e,c){var l=this;return!e||e.children.every(function(e){var t=e.subject,n=e.verb,r=parseInt(e.noun.toString());if("times"!==t)return"onNthOccurrence"===t?c===r:"everyNthOccurrence"===t&&c%r==0;if("limitSession"===n)return l.occurrenceTracker.getSessionOccurranceCount(u)+1===r;if("limitUser"===n)return(s=l.occurrenceTracker.getOccurrences(u).length)+1<=r;var s,i=parseInt(e.objects[0].toString())||1,o=function(e){switch(e){case"limitSecond":return 1e3;case"limitMinute":return 6e4;case"limitHour":return 36e5;case"limitDay":return 864e5}}(n)*i,a=(s=l.occurrenceTracker.getOccurrences(u)).length;return a<r||s.slice(a-r,a)[0]<Date.now()-o})},h);function h(e,t,n){var r=this;this.events=e,this.createRequest=t,this.getFileUrl=n,this._messageCache={},this.occurrenceTracker=new d,this._showRichIAM=!1,e.on("previewRequest",this.onMessagePreview.bind(this)),e.on("messagesReceived",this.onMessagesReceived.bind(this)),e.on("start",function(){r.occurrenceTracker.load(),r.occurrenceTracker.clearSession(),r.onTrigger({trigger:"start"})}),e.on("resume",function(){var e=i.default.DEFAULT_KEYS.MESSAGE_CACHE,t=c.default.getFromLocalStorage(e);r._messageCache=t?JSON.parse(t):r._messageCache,r.occurrenceTracker.load(),r.onTrigger({trigger:"resume"})}),e.on("track",function(e){r.onTrigger({trigger:"event",eventName:e.eventName,params:e.params||{}})}),e.on("advanceState",function(e){return r.onTrigger({trigger:"state",state:e.state,params:e.params||{}})}),e.on("setUserAttribute",function(e){return r.onTrigger({trigger:"userAttribute",attributes:e})})}t.default=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(s.prototype.on=function(e,t){this.handlers.push({eventName:e,callback:t})},s.prototype.off=function(t,n){this.handlers=this.handlers.filter(function(e){return e.eventName!==t||e.callback!==n})},s.prototype.emit=function(t,n){this.handlers.forEach(function(e){e.eventName===t&&e.callback(n)})},s);function s(){this.handlers=[]}t.default=r},function(e,t,n){"use strict";var r,s;Object.defineProperty(t,"__esModule",{value:!0}),(r=t.ActionParameterType||(t.ActionParameterType={})).Int="int",r.Integer="integer",r.Color="color",r.Float="float",r.Decimal="decimal",r.Number="number",r.Boolean="bool",r.String="string",r.Text="text",r.HTML="html",r.File="file",r.List="list",r.Group="group",r.Action="action",r.Unknown="",(s=t.MessageKind||(t.MessageKind={}))[s.Action=2]="Action",s[s.Template=3]="Template"},function(e,t,n){"use strict";var a=this&&this.__assign||function(){return(a=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var s in t=arguments[n])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e}).apply(this,arguments)},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var s=r(n(1)),i=r(n(0)),o=r(n(2)),u=r(n(5));var c=(l.prototype.applyDiffs=function(e,t,n){var o;this.diffs=e,this.variants=t,this.actionDefinitions=a(a({},this.actionDefinitions),(o=n)?Object.keys(o).reduce(function(r,s){r[s]=a({},o[s]);var i=o[s].kinds;return i&&(r[s].kinds=Object.keys(i).reduce(function(e,t){var n=i[t].toLowerCase();return"action"===(e[t]=n)&&(r[s].values[t]=""),e},{})),r},{}):o),this.hasReceivedDiffs=!0,this.merged=function r(t,s){if("number"==typeof s||"boolean"==typeof s||"string"==typeof s)return s;if(null==s)return t;var e=function(r){return function(e){if(r instanceof Array)for(var t=0;t<r.length;t++)e(r[t]);else for(var n in r)!{}.hasOwnProperty.call(r,n)||e(n)}},n=e(t),i=e(s),o=!1;if(null===t&&!(s instanceof Array))for(var a in o=null,s)if(s.hasOwnProperty(a)){if(null===o&&(o=!0),"string"!=typeof a){o=!1;break}if(a.length<3||"["!==a.charAt(0)||"]"!==a.charAt(a.length-1)){o=!1;break}}if(t instanceof Array||o){var u=[];return n(function(e){u.push(e)}),i(function(e){for(var t=parseInt(e.substring(1,e.length-1)),n=s[e];t>=u.length;)u.push(null);u[t]=r(u[t],n)}),u}var c={};return n(function(e){null!==s[e]&&void 0!==s[e]||(c[e]=t[e])}),i(function(e){c[e]=r(null===t?null:t[e]||{},s[e])}),c}(this.variables,e),this.saveDiffs(),this.onUpdate&&this.onUpdate()},l.prototype.loadDiffs=function(){try{this.applyDiffs(JSON.parse(this.loadLocal(i.default.DEFAULT_KEYS.VARIABLES)||null),JSON.parse(this.loadLocal(i.default.DEFAULT_KEYS.VARIANTS)||null),JSON.parse(this.loadLocal(i.default.DEFAULT_KEYS.ACTION_DEFINITIONS)||null)),this.token=this.loadLocal(i.default.DEFAULT_KEYS.TOKEN),this.variantDebugInfo=this.loadLocal(i.default.DEFAULT_KEYS.VARIANT_DEBUG_INFO)}catch(e){console.log("Leanplum: Invalid diffs: "+e)}},l.prototype.saveDiffs=function(){this.saveLocal(i.default.DEFAULT_KEYS.VARIABLES,JSON.stringify(this.diffs||{})),this.saveLocal(i.default.DEFAULT_KEYS.VARIANTS,JSON.stringify(this.variants||[])),this.saveLocal(i.default.DEFAULT_KEYS.ACTION_DEFINITIONS,JSON.stringify(this.actionDefinitions||{})),this.saveLocal(i.default.DEFAULT_KEYS.VARIANT_DEBUG_INFO,JSON.stringify(this.variantDebugInfo||{})),this.saveLocal(i.default.DEFAULT_KEYS.TOKEN,this.token)},l.prototype.getVariable=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=this.getVariables();if(n)for(var r=0;r<e.length;r++)n=n[e[r]];return n},l.prototype.getVariables=function(){return void 0!==this.merged?this.merged:this.variables},l.prototype.setVariables=function(e){this.variables=e},l.prototype.addVariablesChangedHandler=function(e){this.variablesChangedHandlers.push(e),this.hasReceivedDiffs&&e()},l.prototype.removeVariablesChangedHandler=function(e){var t=this.variablesChangedHandlers.indexOf(e);0<=t&&this.variablesChangedHandlers.splice(t,1)},l.prototype.triggerVariablesChangedHandlers=function(){for(var e=0;e<this.variablesChangedHandlers.length;e++)this.variablesChangedHandlers[e]()},l.prototype.getVariantDebugInfo=function(){return this.variantDebugInfo},l.prototype.setVariantDebugInfo=function(e){this.variantDebugInfo=e},l.prototype.sendActions=function(){var e;return!!Object.keys(this.actionDefinitions).length&&(this.setVars(((e={})[i.default.PARAMS.ACTION_DEFINITIONS]=this.actionDefinitions,e)),!0)},l.prototype.sendVariables=function(){var e;this.setVars(((e={})[i.default.PARAMS.VARIABLES]=this.variables,e))},l.prototype.setVars=function(e){var t=(new s.default).body(JSON.stringify(e));this.createRequest(i.default.METHODS.SET_VARS,t,{sendNow:!0})},l.prototype.clearUserContent=function(){this.diffs=void 0,this.variables=null,this.variants=[],this.variantDebugInfo={},this.merged=void 0},l.prototype.registerActionDefinition=function(e){var t;this.actionDefinitions[e.name]={kind:(t=e).kind||3,options:null,values:function n(e){return e.reduce(function(e,t){return t.value instanceof Array?e[t.name]=n(t.value):"action"===t.type?e[t.name]="":"color"===t.type?e[t.name]=u.default.encodeColor(t.value):e[t.name]=t.value,e},{})}(t.args),kinds:function s(e,i){return void 0===i&&(i=""),e.reduce(function(e,t){var n,r=""+i+t.name;return t.value instanceof Array?e=a(((n={})[r]="group",n),s(t.value,r+".")):e[r]=t.type.toLowerCase(),e},{})}(t.args)}},l.prototype.loadLocal=function(e){return o.default.getFromLocalStorage(e)},l.prototype.saveLocal=function(e,t){o.default.saveToLocalStorage(e,t)},l);function l(e){this.createRequest=e,this.actionDefinitions={},this.hasReceivedDiffs=!1,this.merged=void 0,this.variables=null,this.variablesChangedHandlers=[],this.variantDebugInfo={},this.diffs=void 0,this.token="",this.variants=[]}t.default=c}],s.c=r,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)s.d(n,r,function(e){return t[e]}.bind(null,r));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=6);function s(e){if(r[e])return r[e].exports;var t=r[e]={i:e,l:!1,exports:{}};return n[e].call(t.exports,t,t.exports,s),t.l=!0,t.exports}var n,r});