!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.Leanplum=t():e.Leanplum=t()}(window,function(){return r={},o.m=n=[function(e,t,n){var r=n(19),o="object"==typeof self&&self&&self.Object===Object&&self,a=r||o||Function("return this")();e.exports=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={METHODS:{START:"start",STOP:"stop",ADVANCE:"advance",TRACK:"track",PAUSE_SESSION:"pauseSession",RESUME_SESSION:"resumeSession",PAUSE_STATE:"pauseState",RESUME_STATE:"resumeState",DOWNLOAD_FILE:"downloadFile",MULTI:"multi",SET_VARS:"setVars",GET_VARS:"getVars",SET_USER_ATTRIBUTES:"setUserAttributes",SET_DEVICE_ATTRIBUTES:"setDeviceAttributes",UPLOAD_FILE:"uploadFile",REGISTER_DEVICE:"registerDevice"},SDK_VERSION:"1.4.0",CLIENT:"js",PARAMS:{ACTION:"action",APP_ID:"appId",CLIENT:"client",CLIENT_KEY:"clientKey",DEVICE_ID:"deviceId",SDK_VERSION:"sdkVersion",USER_ID:"userId",NEW_USER_ID:"newUserId",DEV_MODE:"devMode",VERSION_NAME:"versionName",SYSTEM_NAME:"systemName",SYSTEM_VERSION:"systemVersion",BROWSER_NAME:"browserName",BROWSER_VERSION:"browserVersion",DEVICE_NAME:"deviceName",DEVICE_MODEL:"deviceModel",USER_ATTRIBUTES:"userAttributes",LOCALE:"locale",COUNTRY:"country",REGION:"region",CITY:"city",LOCATION:"location",STATE:"state",INFO:"info",EVENT:"event",VALUE:"value",FILENAME:"filename",TIME:"time",DATA:"data",VARS:"vars",FILE:"file",SIZE:"size",VARIATION:"variation",HASH:"hash",EMAIL:"email",VARIABLES:"vars",PARAMS:"params",INCLUDE_DEFAULTS:"includeDefaults",INCLUDE_VARIANT_DEBUG_INFO:"includeVariantDebugInfo",WEB_PUSH_SUBSCRIPTION:"webPushSubscription"},KEYS:{IS_REGISTERED:"isRegistered",LATEST_VERSION:"latestVersion",VARS:"vars",VARIANTS:"variants",VARIANT_DEBUG_INFO:"variantDebugInfo",ACTION_METADATA:"actionMetadata",TOKEN:"token"},DEFAULT_KEYS:{COUNT:"__leanplum_unsynced",ITEM:"__leanplum_unsynced_",VARIABLES:"__leanplum_variables",VARIANTS:"__leanplum_variants",VARIANT_DEBUG_INFO:"__leanplum_variant_debug_info",ACTION_METADATA:"__leanplum_action_metadata",TOKEN:"__leanplum_token",DEVICE_ID:"__leanplum_device_id",USER_ID:"__leanplum_user_id",PUSH_SUBSCRIPTION:"__leanplum_push_subscription"},VALUES:{DETECT:"(detect)"}}},function(e,t,n){var r=n(46),o=n(52);e.exports=function(e,t){var n=o(e,t);return r(n)?n:void 0}},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(n(1)),a=(i.prototype.add=function(e,t){if(void 0===t)return this;this.argString&&(this.argString+="&");var n=encodeURIComponent(t);return this.argString+=e+"="+n,this.argValues[e]=t,this},i.prototype.body=function(e){return e?(this._body=e,this):this._body},i.prototype.attachApiKeys=function(e,t){return this.add(o.default.PARAMS.APP_ID,e).add(o.default.PARAMS.CLIENT,o.default.CLIENT).add(o.default.PARAMS.CLIENT_KEY,t)},i.prototype.build=function(){return this.argString},i.prototype.buildDict=function(){return this.argValues},i);function i(){this.argString="",this.argValues={}}t.default=a},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var p=r(n(3)),v=r(n(1)),S=r(n(5)),_=r(n(15)),h=void 0,g=null,o=(b.request=function(e,t,r){if(r=r||{},t=t||new p.default,b.deviceId||(b.deviceId=S.default.getFromLocalStorage(v.default.DEFAULT_KEYS.DEVICE_ID)),!b.deviceId){for(var n="",o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",a=0;a<16;a++)n+=o.charAt(Math.floor(Math.random()*o.length));b.deviceId=n,S.default.saveToLocalStorage(v.default.DEFAULT_KEYS.DEVICE_ID,n)}b.userId||(b.userId=S.default.getFromLocalStorage(v.default.DEFAULT_KEYS.USER_ID))||(b.userId=b.deviceId),S.default.saveToLocalStorage(v.default.DEFAULT_KEYS.USER_ID,b.userId);var i=t.attachApiKeys(b.appId,b.clientKey).add(v.default.PARAMS.SDK_VERSION,v.default.SDK_VERSION).add(v.default.PARAMS.DEVICE_ID,b.deviceId).add(v.default.PARAMS.USER_ID,b.userId).add(v.default.PARAMS.ACTION,e).add(v.default.PARAMS.VERSION_NAME,b.versionName).add(v.default.PARAMS.DEV_MODE,r.devMode).add(v.default.PARAMS.TIME,((new Date).getTime()/1e3).toString()),u=r.success||r.response,s=r.error||r.response;if(!b.appId||!b.clientKey){var c="Leanplum App ID and client key are not set. Make sure you are calling setAppIdForDevelopmentMode or setAppIdForProductionMode before issuing API calls.";return console.error(c),void(s&&s(c))}if(t.body())_.default.ajax("POST",b.apiPath+"?"+i.build(),t.body(),u,s,r.queued);else{var f=r.devMode||r.sendNow||!b.batchEnabled,l=function(){var e=b.popUnsentRequests();if(0<e.length){var t=JSON.stringify({data:e}),n=(new p.default).attachApiKeys(b.appId,b.clientKey).add(v.default.PARAMS.SDK_VERSION,v.default.SDK_VERSION).add(v.default.PARAMS.ACTION,v.default.METHODS.MULTI).add(v.default.PARAMS.TIME,((new Date).getTime()/1e3).toString().toString()).build();_.default.ajax("POST",b.apiPath+"?"+n,t,u,s,r.queued)}};if(!f&&b.batchCooldown){var d=(new Date).getTime()/1e3;!h||b.batchCooldown<=d-h?(f=!0,h=d):g=g||setTimeout(function(){g=null,h=(new Date).getTime()/1e3,l()},1e3*(b.batchCooldown-(d-h)))}b.saveRequestForLater(i.buildDict()),f&&l()}},b.setNetworkTimeout=function(e){_.default.setNetworkTimeout(e)},b.saveRequestForLater=function(e){var t=S.default.getFromLocalStorage(v.default.DEFAULT_KEYS.COUNT)||0,n=v.default.DEFAULT_KEYS.ITEM+t;S.default.saveToLocalStorage(n,JSON.stringify(e)),t++,S.default.saveToLocalStorage(v.default.DEFAULT_KEYS.COUNT,t)},b.popUnsentRequests=function(){var e=[],t=S.default.getFromLocalStorage(v.default.DEFAULT_KEYS.COUNT)||0;S.default.removeFromLocalStorage(v.default.DEFAULT_KEYS.COUNT);for(var n=0;n<t;n++){var r=v.default.DEFAULT_KEYS.ITEM+n;try{var o=JSON.parse(S.default.getFromLocalStorage(r));e.push(o)}catch(e){}S.default.removeFromLocalStorage(r)}return e},b.numResponses=function(e){return e&&e.response?e.response.length:0},b.getResponseAt=function(e,t){return e&&e.response?e.response[t]:null},b.getLastResponse=function(e){var t=b.numResponses(e);return 0<t?b.getResponseAt(e,t-1):null},b.isResponseSuccess=function(e){return!!e&&!!e.success},b.getResponseError=function(e){if(!e)return null;var t=e.error;return t?t.message:null},b.apiPath="https://www.leanplum.com/api",b.batchEnabled=!0,b.batchCooldown=5,b);function b(){}t.default=o},function(e,t,n){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0});var o={},a=(i.getFromLocalStorage=function(e){return!1===r?o[e]:localStorage[e]},i.saveToLocalStorage=function(t,n){if(!1!==r)try{localStorage[t]=n}catch(e){r=!1,o[t]=n}else o[t]=n},i.removeFromLocalStorage=function(t){if(!1!==r)try{localStorage.removeItem(t)}catch(e){r=!1,delete o[t]}else delete o[t]},i);function i(){}t.default=a},function(e,t,n){var r=n(36),o=n(37),a=n(38),i=n(39),u=n(40);function s(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}s.prototype.clear=r,s.prototype.delete=o,s.prototype.get=a,s.prototype.has=i,s.prototype.set=u,e.exports=s},function(e,t,n){var r=n(17);e.exports=function(e,t){for(var n=e.length;n--;)if(r(e[n][0],t))return n;return-1}},function(e,t,n){var r=n(13),o=n(48),a=n(49),i=r?r.toStringTag:void 0;e.exports=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":(i&&i in Object(e)?o:a)(e)}},function(e,t,n){var r=n(2)(Object,"create");e.exports=r},function(e,t,n){var r=n(61);e.exports=function(e,t){var n=e.__data__;return r(t)?n["string"==typeof t?"string":"hash"]:n.map}},function(e,t){e.exports=function(e){return null!=e&&"object"==typeof e}},function(e,t,n){var r=n(2)(n(0),"Map");e.exports=r},function(e,t,n){var r=n(0).Symbol;e.exports=r},function(e,t){var n=Array.isArray;e.exports=n},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c=Function.prototype.apply,r=[],f=10,o=(l.setNetworkTimeout=function(e){f=e},l.ajax=function(e,t,n,r,o,a,i){if(a){if(l.runningRequest)return l.enqueueRequest(arguments);l.runningRequest=!0}if("undefined"!=typeof XDomainRequest)return"http:"===location.protocol&&0===t.indexOf("https:")&&(t="http:"+t.substring(6)),c.call(l.ajaxIE8,null,arguments);var u=!1,s=new XMLHttpRequest;s.onreadystatechange=function(){if(4===s.readyState){if(u)return;var e,t=!(u=!0);if(i)e=s.responseText;else try{e=JSON.parse(s.responseText)}catch(e){setTimeout(function(){o&&o(null,s)},0),t=!0}t||(200<=s.status&&s.status<300?setTimeout(function(){r&&r(e,s)},0):setTimeout(function(){o&&o(e,s)},0)),a&&(l.runningRequest=!1,l.dequeueRequest())}},s.open(e,t,!0),s.setRequestHeader("Content-Type","text/plain"),s.send(n),setTimeout(function(){u||s.abort()},1e3*f)},l.ajaxIE8=function(e,t,n,r,o,a,i){var u=new XDomainRequest;u.onload=function(){var e,t=!1;if(i)e=u.responseText;else try{e=JSON.parse(u.responseText)}catch(e){setTimeout(function(){o&&o(null,u)},0),t=!0}t||setTimeout(function(){r&&r(e,u)},0),a&&(l.runningRequest=!1,l.dequeueRequest())},u.onerror=u.ontimeout=function(){setTimeout(function(){o&&o(null,u)},0),a&&(l.runningRequest=!1,l.dequeueRequest())},u.onprogress=function(){},u.open(e,t),u.timeout=1e3*f,u.send(n)},l.enqueueRequest=function(e){r.push(e)},l.dequeueRequest=function(){var e=r.shift();e&&c.call(l.ajax,null,e)},l.runningRequest=!1,l);function l(){}t.default=o},function(e,t,n){var r=n(33);e.exports=function(e,t){return r(e,t)}},function(e,t){e.exports=function(e,t){return e===t||e!=e&&t!=t}},function(e,t,n){var r=n(8),o=n(20);e.exports=function(e){if(!o(e))return!1;var t=r(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}},function(n,e,t){(function(e){var t="object"==typeof e&&e&&e.Object===Object&&e;n.exports=t}).call(this,t(47))},function(e,t){e.exports=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}},function(e,t){var n=Function.prototype.toString;e.exports=function(e){if(null!=e){try{return n.call(e)}catch(e){}try{return e+""}catch(e){}}return""}},function(e,t,n){var r=n(53),o=n(60),a=n(62),i=n(63),u=n(64);function s(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}s.prototype.clear=r,s.prototype.delete=o,s.prototype.get=a,s.prototype.has=i,s.prototype.set=u,e.exports=s},function(e,t,n){var _=n(65),h=n(68),g=n(69);e.exports=function(e,t,n,r,o,a){var i=1&n,u=e.length,s=t.length;if(u!=s&&!(i&&u<s))return!1;var c=a.get(e);if(c&&a.get(t))return c==t;var f=-1,l=!0,d=2&n?new _:void 0;for(a.set(e,t),a.set(t,e);++f<u;){var p=e[f],v=t[f];if(r)var S=i?r(v,p,f,t,e,a):r(p,v,f,e,t,a);if(void 0!==S){if(S)continue;l=!1;break}if(d){if(!h(t,function(e,t){if(!g(d,t)&&(p===e||o(p,e,n,r,a)))return d.push(t)})){l=!1;break}}else if(p!==v&&!o(p,v,n,r,a)){l=!1;break}}return a.delete(e),a.delete(t),l}},function(e,u,s){(function(e){var t=s(0),n=s(86),r=u&&!u.nodeType&&u,o=r&&"object"==typeof e&&e&&!e.nodeType&&e,a=o&&o.exports===r?t.Buffer:void 0,i=(a?a.isBuffer:void 0)||n;e.exports=i}).call(this,s(25)(e))},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,n){var r=n(88),o=n(89),a=n(90),i=a&&a.isTypedArray,u=i?o(i):r;e.exports=u},function(e,t){e.exports=function(e){return"number"==typeof e&&-1<e&&e%1==0&&e<=9007199254740991}},function(e,t,n){var r=n(29);e.exports=r.default},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var a=r(n(3)),o=r(n(30)),i=r(n(1)),u=r(n(31)),s=r(n(4)),c=r(n(32)),f=r(n(5)),l=r(n(102)),d=r(n(103)),p=new o.default,v=(S.setApiPath=function(e){s.default.apiPath&&(s.default.apiPath=e)},S.setEmail=function(e){S._email=e},S.setNetworkTimeout=function(e){s.default.setNetworkTimeout(e)},S.setVariantDebugInfoEnabled=function(e){S._internalState.setVariantDebugInfoEnabled(e)},S.getVariantDebugInfo=function(){return S._varCache.getVariantDebugInfo()},S.setAppIdForDevelopmentMode=function(e,t){s.default.appId=e,s.default.clientKey=t,S._internalState.devMode=!0},S.setAppIdForProductionMode=function(e,t){s.default.appId=e,s.default.clientKey=t,S._internalState.devMode=!1},S.setSocketHost=function(e){S._lpSocket.setSocketHost(e)},S.setDeviceId=function(e){s.default.deviceId=e},S.setAppVersion=function(e){s.default.versionName=e},S.setDeviceName=function(e){S._deviceName=e},S.setDeviceModel=function(e){S._deviceModel=e},S.setSystemName=function(e){S._systemName=e},S.setSystemVersion=function(e){S._systemVersion=e},S.setVariables=function(e){S._varCache.setVariables(e)},S.setRequestBatching=function(e,t){s.default.batchEnabled=e,s.default.batchCooldown=t},S.getVariables=function(){return S._varCache.getVariables()},S.getVariable=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n=S.getVariables(),r=0;r<e.length;r++)n=n[e[r]];return n},S.getVariants=function(){return S._varCache.variants||[]},S.addStartResponseHandler=function(e){S._internalState.addStartResponseHandler(e)},S.__destroy=function(){s.default.apiPath="https://www.leanplum.com/api",s.default.batchEnabled=!0,s.default.batchCooldown=5,s.default.deviceId=void 0,s.default.userId=void 0,s.default.appId=void 0,s.default.clientKey=void 0,s.default.versionName=void 0,S._internalState=new u.default,S._varCache=new d.default(S._internalState)},S.addVariablesChangedHandler=function(e){S._internalState.addVariablesChangedHandler(e)},S.removeStartResponseHandler=function(e){S._internalState.removeStartResponseHandler(e)},S.removeVariablesChangedHandler=function(e){S._internalState.removeVariablesChangedHandler(e)},S.forceContentUpdate=function(r){var e=(new a.default).add(i.default.PARAMS.INCLUDE_DEFAULTS,!1).add(i.default.PARAMS.INCLUDE_VARIANT_DEBUG_INFO,S._internalState.variantDebugInfoEnabled);s.default.request(i.default.METHODS.GET_VARS,e,{devMode:S._internalState.devMode,queued:!1,sendNow:!0,response:function(e){var t=s.default.getLastResponse(e),n=s.default.isResponseSuccess(t);n&&(S._varCache.applyDiffs(t[i.default.KEYS.VARS],t[i.default.KEYS.VARIANTS],t[i.default.KEYS.ACTION_METADATA]),S._varCache.setVariantDebugInfo(t[i.default.KEYS.VARIANT_DEBUG_INFO])),r&&r(n)}})},S.start=function(e,t,n){"function"==typeof e?(n=e,t={},e=null):"object"==typeof e&&null!=e?(n=t,t=e,e=null):"function"==typeof t&&(n=t,t={}),s.default.userId=e,n&&S.addStartResponseHandler(n),S._varCache.onUpdate=function(){S._internalState.triggerVariablesChangedHandlers()};var r=(new a.default).add(i.default.PARAMS.USER_ATTRIBUTES,JSON.stringify(t)).add(i.default.PARAMS.COUNTRY,i.default.VALUES.DETECT).add(i.default.PARAMS.REGION,i.default.VALUES.DETECT).add(i.default.PARAMS.CITY,i.default.VALUES.DETECT).add(i.default.PARAMS.LOCATION,i.default.VALUES.DETECT).add(i.default.PARAMS.SYSTEM_NAME,S._systemName||p.OS).add(i.default.PARAMS.SYSTEM_VERSION,(S._systemVersion||"").toString()).add(i.default.PARAMS.BROWSER_NAME,p.browser).add(i.default.PARAMS.BROWSER_VERSION,p.version.toString()).add(i.default.PARAMS.LOCALE,i.default.VALUES.DETECT).add(i.default.PARAMS.DEVICE_NAME,S._deviceName||p.browser+" "+p.version).add(i.default.PARAMS.DEVICE_MODEL,S._deviceModel||"Web Browser").add(i.default.PARAMS.INCLUDE_DEFAULTS,!1).add(i.default.PARAMS.INCLUDE_VARIANT_DEBUG_INFO,S._internalState.variantDebugInfoEnabled);s.default.request(i.default.METHODS.START,r,{devMode:S._internalState.devMode,queued:!0,sendNow:!0,response:function(e){S._internalState.hasStarted=!0;var t=s.default.getLastResponse(e);if(s.default.isResponseSuccess(t)){if(S._internalState.startSuccessful=!0,S._internalState.devMode){var n=t[i.default.KEYS.LATEST_VERSION];n&&console.log("A newer version of Leanplum, "+n+', is available.\nUse "npm update leanplum-sdk" or go to https://docs.leanplum.com/reference#javascript-setup to download it.'),S._lpSocket.connect(S._varCache,S._internalState)}S._varCache.applyDiffs(t[i.default.KEYS.VARS],t[i.default.KEYS.VARIANTS],t[i.default.KEYS.ACTION_METADATA]),S._varCache.setVariantDebugInfo(t[i.default.KEYS.VARIANT_DEBUG_INFO]),S._varCache.token=t[i.default.KEYS.TOKEN]}else S._internalState.startSuccessful=!1,S._varCache.loadDiffs();S._internalState.triggerStartHandlers()}})},S.startFromCache=function(e,t,n){"function"==typeof e?(n=e,t={},e=null):"object"==typeof e&&null!=e?(n=t,t=e,e=null):"function"==typeof t&&(n=t,t={}),s.default.userId=e,n&&S.addStartResponseHandler(n),S._internalState.hasStarted=!0,S._internalState.startSuccessful=!0,S._internalState.devMode&&S._lpSocket.connect(S._varCache,S._internalState),S._varCache.loadDiffs(),S._internalState.triggerStartHandlers()},S.stop=function(){s.default.request(i.default.METHODS.STOP,void 0,{sendNow:!0,devMode:S._internalState.devMode,queued:!0})},S.pauseSession=function(){s.default.request(i.default.METHODS.PAUSE_SESSION,void 0,{sendNow:!0,devMode:S._internalState.devMode,queued:!0})},S.resumeSession=function(){s.default.request(i.default.METHODS.RESUME_SESSION,void 0,{sendNow:!0,devMode:S._internalState.devMode,queued:!0})},S.pauseState=function(){s.default.request(i.default.METHODS.PAUSE_STATE,void 0,{devMode:S._internalState.devMode,queued:!0})},S.resumeState=function(){s.default.request(i.default.METHODS.RESUME_STATE,void 0,{devMode:S._internalState.devMode,queued:!0})},S.setUserId=function(e){S.setUserAttributes(e)},S.setUserAttributes=function(e,t){if(void 0===t)if("object"==typeof e)t=e,e=void 0;else if("string"!=typeof e)return void console.log("Leanplum: setUserAttributes expects a string or an object");var n=(new a.default).add(i.default.PARAMS.USER_ATTRIBUTES,t?JSON.stringify(t):void 0).add(i.default.PARAMS.NEW_USER_ID,e);s.default.request(i.default.METHODS.SET_USER_ATTRIBUTES,n,{devMode:S._internalState.devMode,queued:!0}),e&&(s.default.userId=e,f.default.saveToLocalStorage(i.default.DEFAULT_KEYS.USER_ID,s.default.userId))},S.track=function(e,t,n,r){"object"==typeof t&&null!=t?(r=t,t=n=void 0):"string"==typeof t?(r=n,n=t,t=void 0):"object"==typeof n&&null!=n&&(r=n,n=void 0);var o=(new a.default).add(i.default.PARAMS.EVENT,e).add(i.default.PARAMS.VALUE,t||0).add(i.default.PARAMS.INFO,n).add(i.default.PARAMS.PARAMS,JSON.stringify(r));s.default.request(i.default.METHODS.TRACK,o,{devMode:S._internalState.devMode,queued:!0})},S.advanceTo=function(e,t,n){"object"==typeof t&&null!=t&&(n=t,t=void 0);var r=(new a.default).add(i.default.PARAMS.STATE,e).add(i.default.PARAMS.INFO,t).add(i.default.PARAMS.PARAMS,JSON.stringify(n));s.default.request(i.default.METHODS.ADVANCE,r,{devMode:S._internalState.devMode,queued:!0})},S.isWebPushSupported=function(){return l.default.setInternalState(S._internalState),l.default.isWebPushSupported()},S.isWebPushSubscribed=function(){return l.default.setInternalState(S._internalState),l.default.isWebPushSubscribed()},S.registerForWebPush=function(n){return new Promise(function(t,e){return l.default.setInternalState(S._internalState),l.default.isWebPushSupported()?l.default.register(n,function(e){return e?t(!0):l.default.subscribeUser()}):e("Leanplum: WebPush is not supported.")})},S.unregisterFromWebPush=function(){return l.default.setInternalState(S._internalState),l.default.unsubscribeUser()},S.clearUserContent=function(){S._varCache.clearUserContent()},S._internalState=new u.default,S._lpSocket=new c.default,S._varCache=new d.default(S._internalState),S);function S(){}t.default=v},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:window.opera,identity:"Opera",versionSearch:"Version"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}],o=[{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac OS"},{string:navigator.userAgent,subString:"iPhone",identity:"iOS"},{string:navigator.userAgent,subString:"Android",identity:"Android"},{string:navigator.platform,subString:"Linux",identity:"Linux"}],a=(i.prototype._searchString=function(e){for(var t=0;t<e.length;t++){var n=e[t].string,r=e[t].prop;if(this.versionSearchString=e[t].versionSearch||e[t].identity,n){if(-1!==n.indexOf(e[t].subString))return e[t].identity}else if(r)return e[t].identity}},i.prototype._searchVersion=function(e){if(!e)return-1;var t=e.indexOf(this.versionSearchString);return-1===t?-1:parseFloat(e.substring(t+this.versionSearchString.length+1))},i);function i(){this.browser=this._searchString(r)||"Unknown Browser",this.version=this._searchVersion(navigator.userAgent)||this._searchVersion(navigator.appVersion)||"Unknown Version",this.OS=this._searchString(o)||"Unknown OS"}t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(Object.defineProperty(o.prototype,"devMode",{get:function(){return this._devMode},set:function(e){this._devMode=e},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"hasReceivedDiffs",{get:function(){return this._hasReceivedDiffs},set:function(e){this._hasReceivedDiffs=e},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"hasStarted",{get:function(){return this._hasStarted},set:function(e){this._hasStarted=e},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"startSuccessful",{get:function(){return this._startSuccessful},set:function(e){this._startSuccessful=e},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"variantDebugInfoEnabled",{get:function(){return this._variantDebugInfoEnabled},set:function(e){this._variantDebugInfoEnabled=e},enumerable:!0,configurable:!0}),o.prototype.addStartResponseHandler=function(e){this._startHandlers.push(e),this._hasStarted&&e(this._startSuccessful)},o.prototype.removeStartResponseHandler=function(e){var t=this._startHandlers.indexOf(e);0<=t&&this._startHandlers.splice(t,1)},o.prototype.triggerStartHandlers=function(){for(var e=0;e<this._startHandlers.length;e++)this._startHandlers[e](this._startSuccessful)},o.prototype.addVariablesChangedHandler=function(e){this._variablesChangedHandlers.push(e),this._hasReceivedDiffs&&e()},o.prototype.removeVariablesChangedHandler=function(e){var t=this._variablesChangedHandlers.indexOf(e);0<=t&&this._variablesChangedHandlers.splice(t,1)},o.prototype.triggerVariablesChangedHandlers=function(){for(var e=0;e<this._variablesChangedHandlers.length;e++)this._variablesChangedHandlers[e]()},o.prototype.setVariantDebugInfoEnabled=function(e){this._variantDebugInfoEnabled=e},o);function o(){this._devMode=!1,this._variablesChangedHandlers=[],this._hasReceivedDiffs=!1,this._hasStarted=!1,this._startHandlers=[],this._startSuccessful=!1,this._variantDebugInfoEnabled=!1}t.default=r},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var i=r(n(16)),u=r(n(3)),s=r(n(1)),c=r(n(4)),f=r(n(101)),o=(a.prototype.connect=function(a,r){var e=this;if(WebSocket){var o=new f.default,t=!1;o.onopen=function(){var e;t||(console.log("Leanplum: Connected to development server."),o.send("auth",((e={})[s.default.PARAMS.APP_ID]=c.default.appId,e[s.default.PARAMS.DEVICE_ID]=c.default.deviceId,e)),t=!0)},o.onerror=function(e){console.log("Leanplum: Socket error",e)},o.onmessage=function(e,t){if("updateVars"===e){var n=(new u.default).add(s.default.PARAMS.INCLUDE_DEFAULTS,!1);c.default.request(s.default.METHODS.GET_VARS,n,{devMode:r.devMode,queued:!1,sendNow:!0,response:function(e){var t=c.default.getLastResponse(e),n=t[s.default.KEYS.VARS],r=t[s.default.KEYS.VARIANTS],o=t[s.default.KEYS.ACTION_METADATA];i.default(n,a.diffs)||a.applyDiffs(n,r,o)}})}else"getVariables"===e?(a.sendVariables(),o.send("getContentResponse",{updated:!0})):"getActions"===e?o.send("getContentResponse",{updated:!1}):"registerDevice"===e&&alert("Your device has been registered to "+t[0].email+".")},o.onclose=function(){console.log("Leanplum: Disconnected to development server."),t=!1},o.connect(this.socketHost),setInterval(function(){o.connected||o.connecting||o.connect(e.socketHost)},5e3)}else console.log("Your browser doesn't support WebSockets.")},a.prototype.setSocketHost=function(e){this.socketHost=e},a);function a(){this.socketHost="dev.leanplum.com"}t.default=o},function(e,t,n){var i=n(34),u=n(11);e.exports=function e(t,n,r,o,a){return t===n||(null==t||null==n||!u(t)&&!u(n)?t!=t&&n!=n:i(t,n,r,o,e,a))}},function(e,t,n){var S=n(35),_=n(23),h=n(70),g=n(74),b=n(96),A=n(14),E=n(24),y=n(26),T="[object Object]",I=Object.prototype.hasOwnProperty;e.exports=function(e,t,n,r,o,a){var i=A(e),u=A(t),s=i?"[object Array]":b(e),c=u?"[object Array]":b(t),f=(s="[object Arguments]"==s?T:s)==T,l=(c="[object Arguments]"==c?T:c)==T,d=s==c;if(d&&E(e)){if(!E(t))return!1;f=!(i=!0)}if(d&&!f)return a=a||new S,i||y(e)?_(e,t,n,r,o,a):h(e,t,s,n,r,o,a);if(!(1&n)){var p=f&&I.call(e,"__wrapped__"),v=l&&I.call(t,"__wrapped__");if(p||v)return o(p?e.value():e,v?t.value():t,n,r,a=a||new S)}return!!d&&(a=a||new S,g(e,t,n,r,o,a))}},function(e,t,n){var r=n(6),o=n(41),a=n(42),i=n(43),u=n(44),s=n(45);function c(e){var t=this.__data__=new r(e);this.size=t.size}c.prototype.clear=o,c.prototype.delete=a,c.prototype.get=i,c.prototype.has=u,c.prototype.set=s,e.exports=c},function(e,t){e.exports=function(){this.__data__=[],this.size=0}},function(e,t,n){var r=n(7),o=Array.prototype.splice;e.exports=function(e){var t=this.__data__,n=r(t,e);return!(n<0||(n==t.length-1?t.pop():o.call(t,n,1),--this.size,0))}},function(e,t,n){var r=n(7);e.exports=function(e){var t=this.__data__,n=r(t,e);return n<0?void 0:t[n][1]}},function(e,t,n){var r=n(7);e.exports=function(e){return-1<r(this.__data__,e)}},function(e,t,n){var o=n(7);e.exports=function(e,t){var n=this.__data__,r=o(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this}},function(e,t,n){var r=n(6);e.exports=function(){this.__data__=new r,this.size=0}},function(e,t){e.exports=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n}},function(e,t){e.exports=function(e){return this.__data__.get(e)}},function(e,t){e.exports=function(e){return this.__data__.has(e)}},function(e,t,n){var o=n(6),a=n(12),i=n(22);e.exports=function(e,t){var n=this.__data__;if(n instanceof o){var r=n.__data__;if(!a||r.length<199)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new i(r)}return n.set(e,t),this.size=n.size,this}},function(e,t,n){var r=n(18),o=n(50),a=n(20),i=n(21),u=/^\[object .+?Constructor\]$/,s=Function.prototype,c=Object.prototype,f=s.toString,l=c.hasOwnProperty,d=RegExp("^"+f.call(l).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");e.exports=function(e){return!(!a(e)||o(e))&&(r(e)?d:u).test(i(e))}},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){var r=n(13),o=Object.prototype,a=o.hasOwnProperty,i=o.toString,u=r?r.toStringTag:void 0;e.exports=function(e){var t=a.call(e,u),n=e[u];try{var r=!(e[u]=void 0)}catch(e){}var o=i.call(e);return r&&(t?e[u]=n:delete e[u]),o}},function(e,t){var n=Object.prototype.toString;e.exports=function(e){return n.call(e)}},function(e,t,n){var r,o=n(51),a=(r=/[^.]+$/.exec(o&&o.keys&&o.keys.IE_PROTO||""))?"Symbol(src)_1."+r:"";e.exports=function(e){return!!a&&a in e}},function(e,t,n){var r=n(0)["__core-js_shared__"];e.exports=r},function(e,t){e.exports=function(e,t){return null==e?void 0:e[t]}},function(e,t,n){var r=n(54),o=n(6),a=n(12);e.exports=function(){this.size=0,this.__data__={hash:new r,map:new(a||o),string:new r}}},function(e,t,n){var r=n(55),o=n(56),a=n(57),i=n(58),u=n(59);function s(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}s.prototype.clear=r,s.prototype.delete=o,s.prototype.get=a,s.prototype.has=i,s.prototype.set=u,e.exports=s},function(e,t,n){var r=n(9);e.exports=function(){this.__data__=r?r(null):{},this.size=0}},function(e,t){e.exports=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}},function(e,t,n){var r=n(9),o=Object.prototype.hasOwnProperty;e.exports=function(e){var t=this.__data__;if(r){var n=t[e];return"__lodash_hash_undefined__"===n?void 0:n}return o.call(t,e)?t[e]:void 0}},function(e,t,n){var r=n(9),o=Object.prototype.hasOwnProperty;e.exports=function(e){var t=this.__data__;return r?void 0!==t[e]:o.call(t,e)}},function(e,t,n){var r=n(9);e.exports=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=r&&void 0===t?"__lodash_hash_undefined__":t,this}},function(e,t,n){var r=n(10);e.exports=function(e){var t=r(this,e).delete(e);return this.size-=t?1:0,t}},function(e,t){e.exports=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}},function(e,t,n){var r=n(10);e.exports=function(e){return r(this,e).get(e)}},function(e,t,n){var r=n(10);e.exports=function(e){return r(this,e).has(e)}},function(e,t,n){var o=n(10);e.exports=function(e,t){var n=o(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this}},function(e,t,n){var r=n(22),o=n(66),a=n(67);function i(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new r;++t<n;)this.add(e[t])}i.prototype.add=i.prototype.push=o,i.prototype.has=a,e.exports=i},function(e,t){e.exports=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this}},function(e,t){e.exports=function(e){return this.__data__.has(e)}},function(e,t){e.exports=function(e,t){for(var n=-1,r=null==e?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1}},function(e,t){e.exports=function(e,t){return e.has(t)}},function(e,t,n){var r=n(13),l=n(71),d=n(17),p=n(23),v=n(72),S=n(73),o=r?r.prototype:void 0,_=o?o.valueOf:void 0;e.exports=function(e,t,n,r,o,a,i){switch(n){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":return!(e.byteLength!=t.byteLength||!a(new l(e),new l(t)));case"[object Boolean]":case"[object Date]":case"[object Number]":return d(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var u=v;case"[object Set]":var s=1&r;if(u=u||S,e.size!=t.size&&!s)return!1;var c=i.get(e);if(c)return c==t;r|=2,i.set(e,t);var f=p(u(e),u(t),r,o,a,i);return i.delete(e),f;case"[object Symbol]":if(_)return _.call(e)==_.call(t)}return!1}},function(e,t,n){var r=n(0).Uint8Array;e.exports=r},function(e,t){e.exports=function(e){var n=-1,r=Array(e.size);return e.forEach(function(e,t){r[++n]=[t,e]}),r}},function(e,t){e.exports=function(e){var t=-1,n=Array(e.size);return e.forEach(function(e){n[++t]=e}),n}},function(e,t,n){var b=n(75),A=Object.prototype.hasOwnProperty;e.exports=function(e,t,n,r,o,a){var i=1&n,u=b(e),s=u.length;if(s!=b(t).length&&!i)return!1;for(var c=s;c--;){var f=u[c];if(!(i?f in t:A.call(t,f)))return!1}var l=a.get(e);if(l&&a.get(t))return l==t;var d=!0;a.set(e,t),a.set(t,e);for(var p=i;++c<s;){var v=e[f=u[c]],S=t[f];if(r)var _=i?r(S,v,f,t,e,a):r(v,S,f,e,t,a);if(!(void 0===_?v===S||o(v,S,n,r,a):_)){d=!1;break}p=p||"constructor"==f}if(d&&!p){var h=e.constructor,g=t.constructor;h!=g&&"constructor"in e&&"constructor"in t&&!("function"==typeof h&&h instanceof h&&"function"==typeof g&&g instanceof g)&&(d=!1)}return a.delete(e),a.delete(t),d}},function(e,t,n){var r=n(76),o=n(78),a=n(81);e.exports=function(e){return r(e,a,o)}},function(e,t,n){var o=n(77),a=n(14);e.exports=function(e,t,n){var r=t(e);return a(e)?r:o(r,n(e))}},function(e,t){e.exports=function(e,t){for(var n=-1,r=t.length,o=e.length;++n<r;)e[o+n]=t[n];return e}},function(e,t,n){var r=n(79),o=n(80),a=Object.prototype.propertyIsEnumerable,i=Object.getOwnPropertySymbols,u=i?function(t){return null==t?[]:(t=Object(t),r(i(t),function(e){return a.call(t,e)}))}:o;e.exports=u},function(e,t){e.exports=function(e,t){for(var n=-1,r=null==e?0:e.length,o=0,a=[];++n<r;){var i=e[n];t(i,n,e)&&(a[o++]=i)}return a}},function(e,t){e.exports=function(){return[]}},function(e,t,n){var r=n(82),o=n(91),a=n(95);e.exports=function(e){return(a(e)?r:o)(e)}},function(e,t,n){var f=n(83),l=n(84),d=n(14),p=n(24),v=n(87),S=n(26),_=Object.prototype.hasOwnProperty;e.exports=function(e,t){var n=d(e),r=!n&&l(e),o=!n&&!r&&p(e),a=!n&&!r&&!o&&S(e),i=n||r||o||a,u=i?f(e.length,String):[],s=u.length;for(var c in e)!t&&!_.call(e,c)||i&&("length"==c||o&&("offset"==c||"parent"==c)||a&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||v(c,s))||u.push(c);return u}},function(e,t){e.exports=function(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}},function(e,t,n){var r=n(85),o=n(11),a=Object.prototype,i=a.hasOwnProperty,u=a.propertyIsEnumerable,s=r(function(){return arguments}())?r:function(e){return o(e)&&i.call(e,"callee")&&!u.call(e,"callee")};e.exports=s},function(e,t,n){var r=n(8),o=n(11);e.exports=function(e){return o(e)&&"[object Arguments]"==r(e)}},function(e,t){e.exports=function(){return!1}},function(e,t){var r=/^(?:0|[1-9]\d*)$/;e.exports=function(e,t){var n=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==n||"symbol"!=n&&r.test(e))&&-1<e&&e%1==0&&e<t}},function(e,t,n){var r=n(8),o=n(27),a=n(11),i={};i["[object Float32Array]"]=i["[object Float64Array]"]=i["[object Int8Array]"]=i["[object Int16Array]"]=i["[object Int32Array]"]=i["[object Uint8Array]"]=i["[object Uint8ClampedArray]"]=i["[object Uint16Array]"]=i["[object Uint32Array]"]=!0,i["[object Arguments]"]=i["[object Array]"]=i["[object ArrayBuffer]"]=i["[object Boolean]"]=i["[object DataView]"]=i["[object Date]"]=i["[object Error]"]=i["[object Function]"]=i["[object Map]"]=i["[object Number]"]=i["[object Object]"]=i["[object RegExp]"]=i["[object Set]"]=i["[object String]"]=i["[object WeakMap]"]=!1,e.exports=function(e){return a(e)&&o(e.length)&&!!i[r(e)]}},function(e,t){e.exports=function(t){return function(e){return t(e)}}},function(e,i,u){(function(e){var t=u(19),n=i&&!i.nodeType&&i,r=n&&"object"==typeof e&&e&&!e.nodeType&&e,o=r&&r.exports===n&&t.process,a=function(){try{return r&&r.require&&r.require("util").types||o&&o.binding&&o.binding("util")}catch(e){}}();e.exports=a}).call(this,u(25)(e))},function(e,t,n){var r=n(92),o=n(93),a=Object.prototype.hasOwnProperty;e.exports=function(e){if(!r(e))return o(e);var t=[];for(var n in Object(e))a.call(e,n)&&"constructor"!=n&&t.push(n);return t}},function(e,t){var n=Object.prototype;e.exports=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||n)}},function(e,t,n){var r=n(94)(Object.keys,Object);e.exports=r},function(e,t){e.exports=function(t,n){return function(e){return t(n(e))}}},function(e,t,n){var r=n(18),o=n(27);e.exports=function(e){return null!=e&&o(e.length)&&!r(e)}},function(e,t,n){var r=n(97),o=n(12),a=n(98),i=n(99),u=n(100),s=n(8),c=n(21),f=c(r),l=c(o),d=c(a),p=c(i),v=c(u),S=s;(r&&"[object DataView]"!=S(new r(new ArrayBuffer(1)))||o&&"[object Map]"!=S(new o)||a&&"[object Promise]"!=S(a.resolve())||i&&"[object Set]"!=S(new i)||u&&"[object WeakMap]"!=S(new u))&&(S=function(e){var t=s(e),n="[object Object]"==t?e.constructor:void 0,r=n?c(n):"";if(r)switch(r){case f:return"[object DataView]";case l:return"[object Map]";case d:return"[object Promise]";case p:return"[object Set]";case v:return"[object WeakMap]"}return t}),e.exports=S},function(e,t,n){var r=n(2)(n(0),"DataView");e.exports=r},function(e,t,n){var r=n(2)(n(0),"Promise");e.exports=r},function(e,t,n){var r=n(2)(n(0),"Set");e.exports=r},function(e,t,n){var r=n(2)(n(0),"WeakMap");e.exports=r},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(n(15)),a=(i.prototype.connect=function(a){var u=this;u.connecting=!0,o.default.ajax("POST","https://"+a+"/socket.io/1","",function(e){var t=e.split(":"),n=t[0],r=parseInt(t[1])/2*1e3;u.socket=new WebSocket("wss://"+a+"/socket.io/1/websocket/"+n);var o=null;u.socket.onopen=function(){u.connected=!0,u.connecting=!1,u.onopen&&u.onopen(),o=setInterval(function(){u.socket.send("2:::")},r)},u.socket.onclose=function(){u.connected=!1,clearInterval(o),u.onclose&&u.onclose()},u.socket.onmessage=function(e){var t=e.data.split(":"),n=parseInt(t[0]);if(2===n)u.socket.send("2::");else if(5===n){var r=t[1],o=JSON.parse(t.slice(3).join(":")),a=o.name,i=o.args;r&&u.socket.send("6:::"+r),u.onmessage&&u.onmessage(a,i)}else 7===n&&console.log("Socket error: "+e.data)},u.socket.onerror=function(e){u.socket.close(),u.onerror&&u.onerror(e)}},null,!1,!0)},i.prototype.send=function(e,t){if(this.connected){var n=JSON.stringify({name:e,args:t});this.socket.send("5:::"+n)}else console.log("Leanplum: Socket is not connected.")},i);function i(){this.connected=!1,this.connecting=!1,this.connected=!1,this.connecting=!1}t.default=a},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(n(16)),a=r(n(1)),i=r(n(3)),u=r(n(4)),s=r(n(5)),c=!1,f=null,l=(d.setInternalState=function(e){d.internalState=e},d.isWebPushSupported=function(){return navigator&&navigator.serviceWorker&&"serviceWorker"in navigator&&"PushManager"in window},d.isWebPushSubscribed=function(){return d.isWebPushSupported()?d.getServiceWorkerRegistration().then(function(e){return new Promise(function(t){e?e.pushManager.getSubscription().then(function(e){(c=null!==e)&&d.updateNewSubscriptionOnServer(e),t(c)}):t(!1)})}):new Promise(function(e){e(!1)})},d.register=function(e,t){if(!d.isWebPushSupported())return console.log("Leanplum: Push messaging is not supported."),t(!1);navigator.serviceWorker.register(e||"/sw.min.js",null).then(function(e){(f=e).pushManager.getSubscription().then(function(e){if((c=!(null===e))&&d.updateNewSubscriptionOnServer(e),t)return t(c)})}).catch(function(e){console.log("Leanplum: Service Worker Error: ",e)})},d.subscribeUser=function(){var e=d.urlB64ToUint8Array("BInWPpWntfR39rgXSP04pqdmEdDGa50z6zqbMvxyxJCwzXIuSpSh8C888-CfJ82WELl7Xe8cjAnfCt-3vK0Ci68");return new Promise(function(t,n){return f.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:e}).then(function(e){return e?(d.updateNewSubscriptionOnServer(e),t(c=!0)):(c=!1,n())}).catch(function(e){return n("Leanplum: Failed to subscribe the user: "+e)})})},d.unsubscribeUser=function(){return new Promise(function(t,n){d.isWebPushSubscribed().then(function(e){if(!e)return t();f.pushManager.getSubscription().then(function(e){return e?e.unsubscribe():n()}).catch(function(e){n("Leanplum: Error unsubscribing: "+e)}).then(function(e){return e?(c=!1,t()):n()})},function(e){return n()})})},d.getServiceWorkerRegistration=function(){return new Promise(function(t){f?t(f):navigator.serviceWorker.getRegistration().then(function(e){t(f=e)})})},d.urlB64ToUint8Array=function(e){for(var t=(e+"=".repeat((4-e.length%4)%4)).replace(/-/g,"+").replace(/_/g,"/"),n=window.atob(t),r=new Uint8Array(n.length),o=0;o<n.length;++o)r[o]=n.charCodeAt(o);return r},d.prepareSubscription=function(e){var t=Function.prototype.apply,n=e.getKey?e.getKey("p256dh"):"",r=e.getKey?e.getKey("auth"):"",o=btoa(t.call(String.fromCharCode,null,new Uint8Array(n))),a=btoa(t.call(String.fromCharCode,null,new Uint8Array(r)));return{endpoint:e.endpoint,key:o,auth:a}},d.updateNewSubscriptionOnServer=function(e){if(e){var t=d.prepareSubscription(e),n=JSON.stringify(t),r=s.default.getFromLocalStorage(a.default.DEFAULT_KEYS.PUSH_SUBSCRIPTION);o.default(r,n)||(s.default.saveToLocalStorage(a.default.DEFAULT_KEYS.PUSH_SUBSCRIPTION,n),d.setSubscription(n))}},d.setSubscription=function(e){if(e){var t=(new i.default).add(a.default.PARAMS.WEB_PUSH_SUBSCRIPTION,e);u.default.request(a.default.METHODS.SET_DEVICE_ATTRIBUTES,t,{devMode:d.internalState.devMode,queued:!1,sendNow:!0})}},d);function d(){}t.default=l},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(n(1)),a=r(n(3)),i=r(n(5)),u=r(n(4)),s=(c.prototype.applyDiffs=function(e,t,n){this.diffs=e,this.variants=t,this.actionMetadata=n,this.internalState.hasReceivedDiffs=!0,this.merged=function r(t,o){if("number"==typeof o||"boolean"==typeof o||"string"==typeof o)return o;if(null==o)return t;function e(r){return function(e){if(r instanceof Array)for(var t=0;t<r.length;t++)e(r[t]);else for(var n in r)!{}.hasOwnProperty.call(r,n)||e(n)}}var n=e(t),a=e(o),i=!1;if(null===t&&!(o instanceof Array))for(var u in i=null,o)if(o.hasOwnProperty(u)){if(null===i&&(i=!0),"string"!=typeof u){i=!1;break}if(u.length<3||"["!==u.charAt(0)||"]"!==u.charAt(u.length-1)){i=!1;break}}if(t instanceof Array||i){var s=[];return n(function(e){s.push(e)}),a(function(e){for(var t=parseInt(e.substring(1,e.length-1)),n=o[e];t>=s.length;)s.push(null);s[t]=r(s[t],n)}),s}var c={};return n(function(e){null!==o[e]&&void 0!==o[e]||(c[e]=t[e])}),a(function(e){c[e]=r(null===t?null:t[e]||{},o[e])}),c}(this.variables,e),this.saveDiffs(),this.onUpdate&&this.onUpdate()},c.prototype.loadDiffs=function(){try{this.applyDiffs(JSON.parse(this.loadLocal(o.default.DEFAULT_KEYS.VARIABLES)||null),JSON.parse(this.loadLocal(o.default.DEFAULT_KEYS.VARIANTS)||null),JSON.parse(this.loadLocal(o.default.DEFAULT_KEYS.ACTION_METADATA)||null)),this.token=this.loadLocal(o.default.DEFAULT_KEYS.TOKEN),this.variantDebugInfo=this.loadLocal(o.default.DEFAULT_KEYS.VARIANT_DEBUG_INFO)}catch(e){console.log("Leanplum: Invalid diffs: "+e)}},c.prototype.saveDiffs=function(){this.saveLocal(o.default.DEFAULT_KEYS.VARIABLES,JSON.stringify(this.diffs||{})),this.saveLocal(o.default.DEFAULT_KEYS.VARIANTS,JSON.stringify(this.variants||[])),this.saveLocal(o.default.DEFAULT_KEYS.ACTION_METADATA,JSON.stringify(this.actionMetadata||{})),this.saveLocal(o.default.DEFAULT_KEYS.VARIANT_DEBUG_INFO,JSON.stringify(this.variantDebugInfo||{})),this.saveLocal(o.default.DEFAULT_KEYS.TOKEN,this.token)},c.prototype.getVariables=function(){return void 0!==this.merged?this.merged:this.variables},c.prototype.setVariables=function(e){this.variables=e},c.prototype.getVariantDebugInfo=function(){return this.variantDebugInfo},c.prototype.setVariantDebugInfo=function(e){this.variantDebugInfo=e},c.prototype.sendVariables=function(){var e={},t=(new a.default).body(JSON.stringify(e));e[o.default.PARAMS.VARIABLES]=this.variables,u.default.request(o.default.METHODS.SET_VARS,t,{devMode:this.internalState.devMode,sendNow:!0})},c.prototype.clearUserContent=function(){this.diffs=void 0,this.variables=null,this.variants=[],this.variantDebugInfo={},this.merged=void 0},c.prototype.loadLocal=function(e){return i.default.getFromLocalStorage(e)},c.prototype.saveLocal=function(e,t){i.default.saveToLocalStorage(e,t)},c);function c(e){this.internalState=e,this.actionMetadata={},this.merged=void 0,this.variables=null,this.variantDebugInfo={},this.diffs=void 0,this.token="",this.variants=[]}t.default=s}],o.c=r,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)o.d(n,r,function(e){return t[e]}.bind(null,r));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=28);function o(e){if(r[e])return r[e].exports;var t=r[e]={i:e,l:!1,exports:{}};return n[e].call(t.exports,t,t.exports,o),t.l=!0,t.exports}var n,r});