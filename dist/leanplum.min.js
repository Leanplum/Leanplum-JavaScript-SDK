!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.Leanplum=t():e.Leanplum=t()}(window,function(){return r={},o.m=n=[function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={METHODS:{START:"start",STOP:"stop",ADVANCE:"advance",TRACK:"track",PAUSE_SESSION:"pauseSession",RESUME_SESSION:"resumeSession",PAUSE_STATE:"pauseState",RESUME_STATE:"resumeState",DOWNLOAD_FILE:"downloadFile",MULTI:"multi",SET_VARS:"setVars",GET_VARS:"getVars",SET_USER_ATTRIBUTES:"setUserAttributes",SET_DEVICE_ATTRIBUTES:"setDeviceAttributes",UPLOAD_FILE:"uploadFile",REGISTER_DEVICE:"registerDevice"},SDK_VERSION:"1.5.0",CLIENT:"js",PARAMS:{ACTION:"action",APP_ID:"appId",CLIENT:"client",CLIENT_KEY:"clientKey",CURRENCY_CODE:"currencyCode",DEVICE_ID:"deviceId",SDK_VERSION:"sdkVersion",USER_ID:"userId",NEW_USER_ID:"newUserId",DEV_MODE:"devMode",VERSION_NAME:"versionName",SYSTEM_NAME:"systemName",SYSTEM_VERSION:"systemVersion",BROWSER_NAME:"browserName",BROWSER_VERSION:"browserVersion",DEVICE_NAME:"deviceName",DEVICE_MODEL:"deviceModel",USER_ATTRIBUTES:"userAttributes",LOCALE:"locale",COUNTRY:"country",REGION:"region",CITY:"city",LOCATION:"location",STATE:"state",INFO:"info",EVENT:"event",VALUE:"value",FILENAME:"filename",TIME:"time",DATA:"data",VARS:"vars",FILE:"file",SIZE:"size",VARIATION:"variation",HASH:"hash",EMAIL:"email",VARIABLES:"vars",PARAMS:"params",INCLUDE_DEFAULTS:"includeDefaults",INCLUDE_VARIANT_DEBUG_INFO:"includeVariantDebugInfo",WEB_PUSH_SUBSCRIPTION:"webPushSubscription"},KEYS:{IS_REGISTERED:"isRegistered",LATEST_VERSION:"latestVersion",VARS:"vars",VARIANTS:"variants",VARIANT_DEBUG_INFO:"variantDebugInfo",ACTION_METADATA:"actionMetadata",TOKEN:"token"},DEFAULT_KEYS:{COUNT:"__leanplum_unsynced",ITEM:"__leanplum_unsynced_",VARIABLES:"__leanplum_variables",VARIANTS:"__leanplum_variants",VARIANT_DEBUG_INFO:"__leanplum_variant_debug_info",ACTION_METADATA:"__leanplum_action_metadata",TOKEN:"__leanplum_token",DEVICE_ID:"__leanplum_device_id",USER_ID:"__leanplum_user_id",PUSH_SUBSCRIPTION:"__leanplum_push_subscription"},VALUES:{DETECT:"(detect)"}}},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(n(0)),i=(a.prototype.add=function(e,t){return void 0===t||(this.argString&&(this.argString+="&"),this.argString+=e+"="+encodeURIComponent(t),this.argValues[e]=t),this},a.prototype.body=function(e){return e?(this._body=e,this):this._body},a.prototype.attachApiKeys=function(e,t){return this.add(o.default.PARAMS.APP_ID,e).add(o.default.PARAMS.CLIENT,o.default.CLIENT).add(o.default.PARAMS.CLIENT_KEY,t)},a.prototype.build=function(){return this.argString},a.prototype.buildDict=function(){return this.argValues},a);function a(){this.argString="",this.argValues={}}t.default=i},function(e,t,n){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0});var o={},i=(a.getFromLocalStorage=function(e){return!1===r?o[e]:localStorage[e]},a.saveToLocalStorage=function(t,n){if(!1!==r)try{localStorage[t]=n}catch(e){r=!1,o[t]=n}else o[t]=n},a.removeFromLocalStorage=function(t){if(!1!==r)try{localStorage.removeItem(t)}catch(e){r=!1,delete o[t]}else delete o[t]},a);function a(){}t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(o.prototype.setNetworkTimeout=function(e){this.networkTimeoutSeconds=e},o.prototype.ajax=function(e,t,n,r,o,i,a){var s=this;if(i){if(this.runningRequest)return this.enqueueRequest(arguments);this.runningRequest=!0}if("undefined"!=typeof XDomainRequest)return"http:"===location.protocol&&0===t.indexOf("https:")&&(t="http:"+t.substring(6)),this.ajaxIE8.call(this,arguments);var u=!1,c=new XMLHttpRequest;c.onreadystatechange=function(){if(4===c.readyState){if(u)return;var e,t=!(u=!0);if(a)e=c.responseText;else try{e=JSON.parse(c.responseText)}catch(e){setTimeout(function(){o&&o(null,c)},0),t=!0}t||(200<=c.status&&c.status<300?setTimeout(function(){r&&r(e,c)},0):setTimeout(function(){o&&o(e,c)},0)),i&&(s.runningRequest=!1,s.dequeueRequest())}},c.open(e,t,!0),c.setRequestHeader("Content-Type","text/plain"),c.send(n),setTimeout(function(){u||c.abort()},1e3*this.networkTimeoutSeconds)},o.prototype.ajaxIE8=function(e,t,n,r,o,i,a){var s=this,u=new XDomainRequest;u.onload=function(){var e,t=!1;if(a)e=u.responseText;else try{e=JSON.parse(u.responseText)}catch(e){setTimeout(function(){o&&o(null,u)},0),t=!0}t||setTimeout(function(){r&&r(e,u)},0),i&&(s.runningRequest=!1,s.dequeueRequest())},u.onerror=u.ontimeout=function(){setTimeout(function(){o&&o(null,u)},0),i&&(s.runningRequest=!1,s.dequeueRequest())},u.onprogress=function(){},u.open(e,t),u.timeout=1e3*this.networkTimeoutSeconds,u.send(n)},o.prototype.enqueueRequest=function(e){this.requestQueue.push(e)},o.prototype.dequeueRequest=function(){var e=this.requestQueue.shift();e&&this.ajax.call(this,e)},o);function o(){this.networkTimeoutSeconds=10,this.requestQueue=[],this.runningRequest=!1}t.default=r},function(e,t,n){var r=n(5);e.exports=r.default},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(n(0)),i=r(n(6)),a=(s.setApiPath=function(e){s._lp.setApiPath(e)},s.setEmail=function(e){s._lp.setEmail(e)},s.setNetworkTimeout=function(e){s._lp.setNetworkTimeout(e)},s.setAppIdForDevelopmentMode=function(e,t){s._lp.setAppIdForDevelopmentMode(e,t)},s.setAppIdForProductionMode=function(e,t){s._lp.setAppIdForProductionMode(e,t)},s.setSocketHost=function(e){s._lp.setSocketHost(e)},s.setDeviceId=function(e){s._lp.setDeviceId(e)},s.setAppVersion=function(e){s._lp.setAppVersion(e)},s.setDeviceName=function(e){s._lp.setDeviceName(e)},s.setDeviceModel=function(e){s._lp.setDeviceModel(e)},s.setRequestBatching=function(e,t){s._lp.setRequestBatching(e,t)},s.setSystemName=function(e){s._lp.setSystemName(e)},s.setSystemVersion=function(e){s._lp.setSystemVersion(e)},s.setVariables=function(e){s._lp.setVariables(e)},s.setVariantDebugInfoEnabled=function(e){s._lp.setVariantDebugInfoEnabled(e)},s.getVariantDebugInfo=function(){return s._lp.getVariantDebugInfo()},s.getVariables=function(){return s._lp.getVariables()},s.getVariable=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return(e=s._lp).getVariable.apply(e,t)},s.getVariants=function(){return s._lp.getVariants()},s.addStartResponseHandler=function(e){s._lp.addStartResponseHandler(e)},s.removeStartResponseHandler=function(e){s._lp.removeStartResponseHandler(e)},s.addVariablesChangedHandler=function(e){s._lp.addVariablesChangedHandler(e)},s.removeVariablesChangedHandler=function(e){s._lp.removeVariablesChangedHandler(e)},s.forceContentUpdate=function(e){s._lp.forceContentUpdate(e)},s.start=function(e,t,n){s._lp.start(e,t,n)},s.startFromCache=function(e,t,n){s._lp.startFromCache(e,t,n)},s.stop=function(){s._lp.stop()},s.pauseSession=function(){s._lp.pauseSession()},s.resumeSession=function(){s._lp.resumeSession()},s.pauseState=function(){s._lp.pauseState()},s.resumeState=function(){s._lp.resumeState()},s.setUserId=function(e){s.setUserAttributes(e)},s.setUserAttributes=function(e,t){s._lp.setUserAttributes(e,t)},s.track=function(e,t,n,r){s._lp.track(e,t,n,r)},s.trackPurchase=function(e,t,n,r){void 0===r&&(r="Purchase"),s._lp.trackPurchase(e,t,n,r)},s.advanceTo=function(e,t,n){s._lp.advanceTo(e,t,n)},s.isWebPushSupported=function(){return s._lp.isWebPushSupported()},s.isWebPushSubscribed=function(){return s._lp.isWebPushSubscribed()},s.registerForWebPush=function(e){return s._lp.registerForWebPush(e)},s.unregisterFromWebPush=function(){return s._lp.unregisterFromWebPush()},s.clearUserContent=function(){s._lp.clearUserContent()},s.__destroy=function(){this._lp=new i.default(window)},s._lp=new i.default(window),s.VERSION=o.default.SDK_VERSION,s);function s(){}t.default=a},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var i=o(n(1)),a=o(n(7)),s=o(n(0)),u=o(n(8)),c=o(n(9)),l=o(n(10)),d=o(n(2)),f=o(n(15)),p=o(n(16)),h=(_.prototype.setApiPath=function(e){this._lpRequest.apiPath&&(this._lpRequest.apiPath=e)},_.prototype.setEmail=function(e){this._email=e},_.prototype.setNetworkTimeout=function(e){this._lpRequest.setNetworkTimeout(e),this._lpSocket.setNetworkTimeout(e)},_.prototype.setAppIdForDevelopmentMode=function(e,t){this._lpRequest.appId=e,this._lpRequest.clientKey=t,this._internalState.devMode=!0},_.prototype.setAppIdForProductionMode=function(e,t){this._lpRequest.appId=e,this._lpRequest.clientKey=t,this._internalState.devMode=!1},_.prototype.setSocketHost=function(e){this._lpSocket.setSocketHost(e)},_.prototype.setDeviceId=function(e){this._lpRequest.deviceId=e},_.prototype.setAppVersion=function(e){this._lpRequest.versionName=e},_.prototype.setDeviceName=function(e){this._deviceName=e},_.prototype.setDeviceModel=function(e){this._deviceModel=e},_.prototype.setRequestBatching=function(e,t){this._lpRequest.batchEnabled=e,this._lpRequest.batchCooldown=t},_.prototype.setSystemName=function(e){this._systemName=e},_.prototype.setSystemVersion=function(e){this._systemVersion=e},_.prototype.setVariables=function(e){this._varCache.setVariables(e)},_.prototype.setVariantDebugInfoEnabled=function(e){this._internalState.variantDebugInfoEnabled=e},_.prototype.getVariantDebugInfo=function(){return this._varCache.getVariantDebugInfo()},_.prototype.getVariables=function(){return this._varCache.getVariables()},_.prototype.getVariable=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return(e=this._varCache).getVariable.apply(e,t)},_.prototype.getVariants=function(){return this._varCache.variants||[]},_.prototype.addStartResponseHandler=function(e){this._internalState.addStartResponseHandler(e)},_.prototype.removeStartResponseHandler=function(e){this._internalState.removeStartResponseHandler(e)},_.prototype.addVariablesChangedHandler=function(e){this._varCache.addVariablesChangedHandler(e)},_.prototype.removeVariablesChangedHandler=function(e){this._varCache.removeVariablesChangedHandler(e)},_.prototype.forceContentUpdate=function(r){var o=this,e=(new i.default).add(s.default.PARAMS.INCLUDE_DEFAULTS,!1).add(s.default.PARAMS.INCLUDE_VARIANT_DEBUG_INFO,this._internalState.variantDebugInfoEnabled);this.createRequest(s.default.METHODS.GET_VARS,e,{queued:!1,sendNow:!0,response:function(e){var t=o._lpRequest.getLastResponse(e),n=o._lpRequest.isResponseSuccess(t);n&&(o._varCache.applyDiffs(t[s.default.KEYS.VARS],t[s.default.KEYS.VARIANTS],t[s.default.KEYS.ACTION_METADATA]),o._varCache.setVariantDebugInfo(t[s.default.KEYS.VARIANT_DEBUG_INFO])),r&&r(n)}})},_.prototype.start=function(e,t,n){var r=this;"function"==typeof e?(n=e,t={},e=null):"object"==typeof e&&null!=e?(n=t,t=e,e=null):"function"==typeof t&&(n=t,t={}),this._lpRequest.userId=e,n&&this.addStartResponseHandler(n),this._varCache.onUpdate=function(){r._varCache.triggerVariablesChangedHandlers()};var o=(new i.default).add(s.default.PARAMS.USER_ATTRIBUTES,JSON.stringify(t)).add(s.default.PARAMS.COUNTRY,s.default.VALUES.DETECT).add(s.default.PARAMS.REGION,s.default.VALUES.DETECT).add(s.default.PARAMS.CITY,s.default.VALUES.DETECT).add(s.default.PARAMS.LOCATION,s.default.VALUES.DETECT).add(s.default.PARAMS.SYSTEM_NAME,this._systemName||this._browserDetector.OS).add(s.default.PARAMS.SYSTEM_VERSION,(this._systemVersion||"").toString()).add(s.default.PARAMS.BROWSER_NAME,this._browserDetector.browser).add(s.default.PARAMS.BROWSER_VERSION,this._browserDetector.version.toString()).add(s.default.PARAMS.LOCALE,s.default.VALUES.DETECT).add(s.default.PARAMS.DEVICE_NAME,this._deviceName||this._browserDetector.browser+" "+this._browserDetector.version).add(s.default.PARAMS.DEVICE_MODEL,this._deviceModel||"Web Browser").add(s.default.PARAMS.INCLUDE_DEFAULTS,!1).add(s.default.PARAMS.INCLUDE_VARIANT_DEBUG_INFO,this._internalState.variantDebugInfoEnabled);this.createRequest(s.default.METHODS.START,o,{queued:!0,sendNow:!0,response:function(e){r._internalState.hasStarted=!0;var t=r._lpRequest.getLastResponse(e);if(r._lpRequest.isResponseSuccess(t)){if(r._internalState.startSuccessful=!0,r._internalState.devMode){var n=t[s.default.KEYS.LATEST_VERSION];n&&console.log("A newer version of Leanplum, "+n+', is available.\nUse "npm update leanplum-sdk" or go to https://docs.leanplum.com/reference#javascript-setup to download it.'),r.connectSocket()}r._varCache.applyDiffs(t[s.default.KEYS.VARS],t[s.default.KEYS.VARIANTS],t[s.default.KEYS.ACTION_METADATA]),r._varCache.setVariantDebugInfo(t[s.default.KEYS.VARIANT_DEBUG_INFO]),r._varCache.token=t[s.default.KEYS.TOKEN]}else r._internalState.startSuccessful=!1,r._varCache.loadDiffs();r._internalState.triggerStartHandlers()}})},_.prototype.startFromCache=function(e,t,n){"function"==typeof e?(n=e,t={},e=null):"object"==typeof e&&null!=e?(n=t,t=e,e=null):"function"==typeof t&&(n=t,t={}),this._lpRequest.userId=e,n&&this.addStartResponseHandler(n),this._internalState.hasStarted=!0,this._internalState.startSuccessful=!0,this._internalState.devMode&&this.connectSocket(),this._varCache.loadDiffs(),this._internalState.triggerStartHandlers()},_.prototype.stop=function(){this.createRequest(s.default.METHODS.STOP,void 0,{sendNow:!0,queued:!0})},_.prototype.pauseSession=function(){this.createRequest(s.default.METHODS.PAUSE_SESSION,void 0,{sendNow:!0,queued:!0})},_.prototype.resumeSession=function(){this.createRequest(s.default.METHODS.RESUME_SESSION,void 0,{sendNow:!0,queued:!0})},_.prototype.pauseState=function(){this.createRequest(s.default.METHODS.PAUSE_STATE,void 0,{queued:!0})},_.prototype.resumeState=function(){this.createRequest(s.default.METHODS.RESUME_STATE,void 0,{queued:!0})},_.prototype.setUserId=function(e){this.setUserAttributes(e)},_.prototype.setUserAttributes=function(e,t){if(void 0===t)if("object"==typeof e)t=e,e=void 0;else if("string"!=typeof e)return void console.log("Leanplum: setUserAttributes expects a string or an object");var n=(new i.default).add(s.default.PARAMS.USER_ATTRIBUTES,t?JSON.stringify(t):void 0).add(s.default.PARAMS.NEW_USER_ID,e);this.createRequest(s.default.METHODS.SET_USER_ATTRIBUTES,n,{queued:!0}),e&&(this._lpRequest.userId=e,d.default.saveToLocalStorage(s.default.DEFAULT_KEYS.USER_ID,this._lpRequest.userId))},_.prototype.track=function(e,t,n,r){"object"==typeof t&&null!=t?(r=t,t=n=void 0):"string"==typeof t?(r=n,n=t,t=void 0):"object"==typeof n&&null!=n&&(r=n,n=void 0);var o=(new i.default).add(s.default.PARAMS.EVENT,e).add(s.default.PARAMS.VALUE,t||0).add(s.default.PARAMS.INFO,n).add(s.default.PARAMS.PARAMS,JSON.stringify(r));this.createRequest(s.default.METHODS.TRACK,o,{queued:!0})},_.prototype.trackPurchase=function(e,t,n,r){void 0===r&&(r="Purchase");var o=(new i.default).add(s.default.PARAMS.EVENT,r).add(s.default.PARAMS.VALUE,e||0).add(s.default.PARAMS.PARAMS,JSON.stringify(n));t&&o.add(s.default.PARAMS.CURRENCY_CODE,t),this.createRequest(s.default.METHODS.TRACK,o,{queued:!0})},_.prototype.advanceTo=function(e,t,n){"object"==typeof t&&null!=t&&(n=t,t=void 0);var r=(new i.default).add(s.default.PARAMS.STATE,e).add(s.default.PARAMS.INFO,t).add(s.default.PARAMS.PARAMS,JSON.stringify(n));this.createRequest(s.default.METHODS.ADVANCE,r,{queued:!0})},_.prototype.isWebPushSupported=function(){return this._pushManager.isWebPushSupported()},_.prototype.isWebPushSubscribed=function(){return this._pushManager.isWebPushSubscribed()},_.prototype.registerForWebPush=function(e){var t=this;return this._pushManager.isWebPushSupported()?this._pushManager.register(e,function(e){return e?Promise.resolve(!0):t._pushManager.subscribeUser()}):Promise.reject("Leanplum: WebPush is not supported.")},_.prototype.unregisterFromWebPush=function(){return this._pushManager.unsubscribeUser()},_.prototype.clearUserContent=function(){this._varCache.clearUserContent()},_.prototype.createRequest=function(e,t,n){void 0===n&&(n={}),this._lpRequest.request(e,t,r({devMode:this._internalState.devMode},n))},_.prototype.connectSocket=function(){this._lpSocket.connect(this._varCache,{appId:this._lpRequest.appId,deviceId:this._lpRequest.deviceId},this.createRequest,this._lpRequest.getLastResponse)},_);function _(e){this._internalState=new u.default,this._lpRequest=new c.default,this._lpSocket=new l.default,this._pushManager=new f.default(this.createRequest.bind(this)),this._varCache=new p.default(this.createRequest.bind(this)),this._browserDetector=new a.default(e)}t.default=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(o.prototype.searchString=function(e){for(var t=0;t<e.length;t++){var n=e[t].string,r=e[t].prop;if(this.versionSearchString=e[t].versionSearch||e[t].identity,n){if(-1!==n.indexOf(e[t].subString))return e[t].identity}else if(r)return e[t].identity}},o.prototype.searchVersion=function(e){if(e){var t=e.indexOf(this.versionSearchString);if(-1!==t)return parseFloat(e.substring(t+this.versionSearchString.length+1))}},o.prototype.getBrowserData=function(e){return[{string:e.navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:e.navigator.userAgent,subString:"OmniWeb",identity:"OmniWeb",versionSearch:"OmniWeb/"},{string:e.navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:e.opera,identity:"Opera",versionSearch:"Version"},{string:e.navigator.vendor,subString:"iCab",identity:"iCab"},{string:e.navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:e.navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:e.navigator.vendor,subString:"Camino",identity:"Camino"},{string:e.navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:e.navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:e.navigator.userAgent,subString:"Android",identity:"Android Browser",versionSearch:"Version"},{string:e.navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:e.navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}]},o.prototype.getOSData=function(e){return[{string:e.navigator.platform,subString:"Win",identity:"Windows"},{string:e.navigator.platform,subString:"Mac",identity:"Mac OS"},{string:e.navigator.userAgent,subString:"iPhone",identity:"iOS"},{string:e.navigator.userAgent,subString:"Android",identity:"Android"},{string:e.navigator.platform,subString:"Linux",identity:"Linux"}]},o);function o(e){this.browser=this.searchString(this.getBrowserData(e))||"Unknown Browser",this.version=this.searchVersion(e.navigator.userAgent)||this.searchVersion(e.navigator.appVersion)||"Unknown Version",this.OS=this.searchString(this.getOSData(e))||"Unknown OS"}t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(o.prototype.addStartResponseHandler=function(e){this.startHandlers.push(e),this.hasStarted&&e(this.startSuccessful)},o.prototype.removeStartResponseHandler=function(e){var t=this.startHandlers.indexOf(e);0<=t&&this.startHandlers.splice(t,1)},o.prototype.triggerStartHandlers=function(){for(var e=0;e<this.startHandlers.length;e++)this.startHandlers[e](this.startSuccessful)},o);function o(){this.startHandlers=[],this.devMode=!1,this.hasStarted=!1,this.startSuccessful=!1,this.variantDebugInfoEnabled=!1}t.default=r},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var h=r(n(1)),_=r(n(0)),o=r(n(2)),i=r(n(3)),a=(s.prototype.request=function(e,t,r){var o=this;if(void 0===r&&(r={}),r=r||{},t=t||new h.default,this.deviceId||(this.deviceId=this.loadLocal(_.default.DEFAULT_KEYS.DEVICE_ID)),!this.deviceId){for(var n="",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",a=0;a<16;a++)n+=i.charAt(Math.floor(Math.random()*i.length));this.deviceId=n,this.saveLocal(_.default.DEFAULT_KEYS.DEVICE_ID,n)}this.userId||(this.userId=this.loadLocal(_.default.DEFAULT_KEYS.USER_ID),this.userId||(this.userId=this.deviceId)),this.saveLocal(_.default.DEFAULT_KEYS.USER_ID,this.userId);var s=t.attachApiKeys(this.appId,this.clientKey).add(_.default.PARAMS.SDK_VERSION,_.default.SDK_VERSION).add(_.default.PARAMS.DEVICE_ID,this.deviceId).add(_.default.PARAMS.USER_ID,this.userId).add(_.default.PARAMS.ACTION,e).add(_.default.PARAMS.VERSION_NAME,this.versionName).add(_.default.PARAMS.DEV_MODE,r.devMode).add(_.default.PARAMS.TIME,((new Date).getTime()/1e3).toString()),u=r.success||r.response,c=r.error||r.response;if(!this.appId||!this.clientKey){var l="Leanplum App ID and client key are not set. Make sure you are calling setAppIdForDevelopmentMode or setAppIdForProductionMode before issuing API calls.";return console.error(l),void(c&&c(l))}if(t.body())this.network.ajax("POST",this.apiPath+"?"+s.build(),t.body(),u,c,r.queued);else{var d=r.devMode||r.sendNow||!this.batchEnabled,f=function(){var e=o.popUnsentRequests();if(0<e.length){var t=JSON.stringify({data:e}),n=(new h.default).attachApiKeys(o.appId,o.clientKey).add(_.default.PARAMS.SDK_VERSION,_.default.SDK_VERSION).add(_.default.PARAMS.ACTION,_.default.METHODS.MULTI).add(_.default.PARAMS.TIME,((new Date).getTime()/1e3).toString().toString()).build();o.network.ajax("POST",o.apiPath+"?"+n,t,u,c,r.queued)}};if(!d&&this.batchCooldown){var p=(new Date).getTime()/1e3;!this.lastRequestTime||p-this.lastRequestTime>=this.batchCooldown?(d=!0,this.lastRequestTime=p):this.cooldownTimeout||(this.cooldownTimeout=setTimeout(function(){o.cooldownTimeout=null,o.lastRequestTime=(new Date).getTime()/1e3,f()},1e3*(this.batchCooldown-(p-this.lastRequestTime))))}this.saveRequestForLater(s.buildDict()),d&&f()}},s.prototype.setNetworkTimeout=function(e){this.network.setNetworkTimeout(e)},s.prototype.getLastResponse=function(e){var t,n,r,o=null!=(n=null===(t=null==e?void 0:e.response)||void 0===t?void 0:t.length)?n:0;return 0<o?null===(r=null==e?void 0:e.response)||void 0===r?void 0:r[o-1]:null},s.prototype.isResponseSuccess=function(e){return Boolean(null==e?void 0:e.success)},s.prototype.saveRequestForLater=function(e){var t=this.loadLocal(_.default.DEFAULT_KEYS.COUNT)||0,n=_.default.DEFAULT_KEYS.ITEM+t;this.saveLocal(n,JSON.stringify(e)),t++,this.saveLocal(_.default.DEFAULT_KEYS.COUNT,t)},s.prototype.popUnsentRequests=function(){var e=[],t=this.loadLocal(_.default.DEFAULT_KEYS.COUNT)||0;this.removeLocal(_.default.DEFAULT_KEYS.COUNT);for(var n=0;n<t;n++){var r=_.default.DEFAULT_KEYS.ITEM+n;try{e.push(JSON.parse(this.loadLocal(r)))}catch(e){}this.removeLocal(r)}return e},s.prototype.loadLocal=function(e){return o.default.getFromLocalStorage(e)},s.prototype.saveLocal=function(e,t){o.default.saveToLocalStorage(e,t)},s.prototype.removeLocal=function(e){o.default.removeFromLocalStorage(e)},s);function s(){this.cooldownTimeout=null,this.lastRequestTime=void 0,this.network=new i.default,this.apiPath="https://www.leanplum.com/api",this.batchCooldown=5,this.batchEnabled=!0}t.default=a},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var s=r(n(11)),u=r(n(1)),c=r(n(0)),l=r(n(14)),o=(i.prototype.connect=function(i,t,r,a){var o=this;if(WebSocket){var n=!1;this.socketClient=new l.default,this.socketClient.setNetworkTimeout(this.networkTimeoutSeconds),this.socketClient.onopen=function(){var e;n||(console.log("Leanplum: Connected to development server."),o.socketClient.send("auth",((e={})[c.default.PARAMS.APP_ID]=t.appId,e[c.default.PARAMS.DEVICE_ID]=t.deviceId,e)),n=!0)},this.socketClient.onerror=function(e){console.log("Leanplum: Socket error",e)},this.socketClient.onmessage=function(e,t){if("updateVars"===e){var n=(new u.default).add(c.default.PARAMS.INCLUDE_DEFAULTS,!1);r(c.default.METHODS.GET_VARS,n,{queued:!1,sendNow:!0,response:function(e){var t=a(e),n=t[c.default.KEYS.VARS],r=t[c.default.KEYS.VARIANTS],o=t[c.default.KEYS.ACTION_METADATA];s.default(n,i.diffs)||i.applyDiffs(n,r,o)}})}else"getVariables"===e?(i.sendVariables(),o.socketClient.send("getContentResponse",{updated:!0})):"getActions"===e?o.socketClient.send("getContentResponse",{updated:!1}):"registerDevice"===e&&alert("Your device has been registered to "+t[0].email+".")},this.socketClient.onclose=function(){console.log("Leanplum: Disconnected to development server."),n=!1},this.socketClient.connect(this.socketHost),setInterval(function(){o.socketClient.connected||o.socketClient.connecting||o.socketClient.connect(o.socketHost)},5e3)}else console.log("Your browser doesn't support WebSockets.")},i.prototype.setSocketHost=function(e){this.socketHost=e},i.prototype.setNetworkTimeout=function(e){var t;this.networkTimeoutSeconds=e,null===(t=this.socketClient)||void 0===t||t.setNetworkTimeout(e)},i);function i(){this.networkTimeoutSeconds=10,this.socketClient=null,this.socketHost="dev.leanplum.com"}t.default=o},function(e,we,t){(function(e,t){var _="[object Arguments]",S="[object Map]",v="[object Object]",g="[object Set]",o=/^\[object .+?Constructor\]$/,f=/^(?:0|[1-9]\d*)$/,n={};n["[object Float32Array]"]=n["[object Float64Array]"]=n["[object Int8Array]"]=n["[object Int16Array]"]=n["[object Int32Array]"]=n["[object Uint8Array]"]=n["[object Uint8ClampedArray]"]=n["[object Uint16Array]"]=n["[object Uint32Array]"]=!0,n[_]=n["[object Array]"]=n["[object ArrayBuffer]"]=n["[object Boolean]"]=n["[object DataView]"]=n["[object Date]"]=n["[object Error]"]=n["[object Function]"]=n[S]=n["[object Number]"]=n[v]=n["[object RegExp]"]=n[g]=n["[object String]"]=n["[object WeakMap]"]=!1;var r="object"==typeof e&&e&&e.Object===Object&&e,i="object"==typeof self&&self&&self.Object===Object&&self,a=r||i||Function("return this")(),s=we&&!we.nodeType&&we,u=s&&"object"==typeof t&&t&&!t.nodeType&&t,c=u&&u.exports===s,l=c&&r.process,d=function(){try{return l&&l.binding&&l.binding("util")}catch(e){}}(),p=d&&d.isTypedArray;function b(e,t){for(var n=-1,r=null==e?0:e.length;++n<r;)if(t(e[n],n,e))return 1}function y(e){var n=-1,r=Array(e.size);return e.forEach(function(e,t){r[++n]=[t,e]}),r}function A(e){var t=-1,n=Array(e.size);return e.forEach(function(e){n[++t]=e}),n}var h,E,R,T=Array.prototype,I=Function.prototype,m=Object.prototype,D=a["__core-js_shared__"],w=I.toString,O=m.hasOwnProperty,M=(h=/[^.]+$/.exec(D&&D.keys&&D.keys.IE_PROTO||""))?"Symbol(src)_1."+h:"",N=m.toString,C=RegExp("^"+w.call(O).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),P=c?a.Buffer:void 0,V=a.Symbol,U=a.Uint8Array,L=m.propertyIsEnumerable,k=T.splice,j=V?V.toStringTag:void 0,q=Object.getOwnPropertySymbols,F=P?P.isBuffer:void 0,H=(E=Object.keys,R=Object,function(e){return E(R(e))}),K=pe(a,"DataView"),W=pe(a,"Map"),B=pe(a,"Promise"),Y=pe(a,"Set"),x=pe(a,"WeakMap"),z=pe(Object,"create"),J=Se(K),G=Se(W),X=Se(B),$=Se(Y),Q=Se(x),Z=V?V.prototype:void 0,ee=Z?Z.valueOf:void 0;function te(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function ne(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function re(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function oe(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new re;++t<n;)this.add(e[t])}function ie(e){var t=this.__data__=new ne(e);this.size=t.size}function ae(e,t){for(var n=e.length;n--;)if(ve(e[n][0],t))return n;return-1}function se(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":j&&j in Object(e)?function(e){var t=O.call(e,j),n=e[j];try{var r=!(e[j]=void 0)}catch(e){}var o=N.call(e);return r&&(t?e[j]=n:delete e[j]),o}(e):(t=e,N.call(t));var t}function ue(e){return Te(e)&&se(e)==_}function ce(e,t,n,r,o){return e===t||(null==e||null==t||!Te(e)&&!Te(t)?e!=e&&t!=t:function(e,t,n,r,o,i){var a=be(e),s=be(t),l=a?"[object Array]":_e(e),u=s?"[object Array]":_e(t),c=(l=l==_?v:l)==v,d=(u=u==_?v:u)==v,f=l==u;if(f&&ye(e)){if(!ye(t))return!1;c=!(a=!0)}if(f&&!c)return i=i||new ie,(a||me(e)?le:function(e,t,n,r,o,i){switch(l){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":return!(e.byteLength!=t.byteLength||!o(new U(e),new U(t)));case"[object Boolean]":case"[object Date]":case"[object Number]":return ve(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case S:var a=y;case g:var s=1&n;if(a=a||A,e.size!=t.size&&!s)return!1;var u=i.get(e);if(u)return u==t;n|=2,i.set(e,t);var c=le(a(e),a(t),n,r,o,i);return i.delete(e),c;case"[object Symbol]":if(ee)return ee.call(e)==ee.call(t)}return!1})(e,t,n,r,o,i);if(!(1&n)){var p=c&&O.call(e,"__wrapped__"),h=d&&O.call(t,"__wrapped__");if(p||h)return o(p?e.value():e,h?t.value():t,n,r,i=i||new ie)}return f&&function(e,t,n,r,o,i){var a=1&n,s=de(e),u=s.length;if(u!=de(t).length&&!a)return!1;for(var c=u;c--;){var l=s[c];if(!(a?l in t:O.call(t,l)))return!1}var d=i.get(e);if(d&&i.get(t))return d==t;var f=!0;i.set(e,t),i.set(t,e);for(var p=a;++c<u;){var h=e[l=s[c]],_=t[l];if(r)var S=a?r(_,h,l,t,e,i):r(h,_,l,e,t,i);if(!(void 0===S?h===_||o(h,_,n,r,i):S)){f=!1;break}p=p||"constructor"==l}if(f&&!p){var v=e.constructor,g=t.constructor;v!=g&&"constructor"in e&&"constructor"in t&&!("function"==typeof v&&v instanceof v&&"function"==typeof g&&g instanceof g)&&(f=!1)}return i.delete(e),i.delete(t),f}(e,t,n,r,o,i=i||new ie)}(e,t,n,r,ce,o))}function le(e,t,n,r,o,i){var a=1&n,s=e.length,u=t.length;if(s!=u&&!(a&&s<u))return!1;var c=i.get(e);if(c&&i.get(t))return c==t;var l=-1,d=!0,f=2&n?new oe:void 0;for(i.set(e,t),i.set(t,e);++l<s;){var p=e[l],h=t[l];if(r)var _=a?r(h,p,l,t,e,i):r(p,h,l,e,t,i);if(void 0!==_){if(_)continue;d=!1;break}if(f){if(!b(t,function(e,t){return!f.has(t)&&(p===e||o(p,e,n,r,i))&&f.push(t)})){d=!1;break}}else if(p!==h&&!o(p,h,n,r,i)){d=!1;break}}return i.delete(e),i.delete(t),d}function de(e){return n=he,r=De(t=e),be(t)?r:function(e,t){for(var n=-1,r=t.length,o=e.length;++n<r;)e[o+n]=t[n];return e}(r,n(t));var t,n,r}function fe(e,t){var n,r=e.__data__;return("string"==(n=typeof t)||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==t:null===t)?r["string"==typeof t?"string":"hash"]:r.map}function pe(e,t){var n,r=null==e?void 0:e[t];return!Re(n=r)||M&&M in n||!(Ae(n)?C:o).test(Se(n))?void 0:r}te.prototype.clear=function(){this.__data__=z?z(null):{},this.size=0},te.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},te.prototype.get=function(e){var t=this.__data__;if(z){var n=t[e];return"__lodash_hash_undefined__"===n?void 0:n}return O.call(t,e)?t[e]:void 0},te.prototype.has=function(e){var t=this.__data__;return z?void 0!==t[e]:O.call(t,e)},te.prototype.set=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=z&&void 0===t?"__lodash_hash_undefined__":t,this},ne.prototype.clear=function(){this.__data__=[],this.size=0},ne.prototype.delete=function(e){var t=this.__data__,n=ae(t,e);return!(n<0||(n==t.length-1?t.pop():k.call(t,n,1),--this.size,0))},ne.prototype.get=function(e){var t=this.__data__,n=ae(t,e);return n<0?void 0:t[n][1]},ne.prototype.has=function(e){return-1<ae(this.__data__,e)},ne.prototype.set=function(e,t){var n=this.__data__,r=ae(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this},re.prototype.clear=function(){this.size=0,this.__data__={hash:new te,map:new(W||ne),string:new te}},re.prototype.delete=function(e){var t=fe(this,e).delete(e);return this.size-=t?1:0,t},re.prototype.get=function(e){return fe(this,e).get(e)},re.prototype.has=function(e){return fe(this,e).has(e)},re.prototype.set=function(e,t){var n=fe(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this},oe.prototype.add=oe.prototype.push=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this},oe.prototype.has=function(e){return this.__data__.has(e)},ie.prototype.clear=function(){this.__data__=new ne,this.size=0},ie.prototype.delete=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n},ie.prototype.get=function(e){return this.__data__.get(e)},ie.prototype.has=function(e){return this.__data__.has(e)},ie.prototype.set=function(e,t){var n=this.__data__;if(n instanceof ne){var r=n.__data__;if(!W||r.length<199)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new re(r)}return n.set(e,t),this.size=n.size,this};var he=q?function(s){return null==s?[]:(s=Object(s),function(e){for(var t=-1,n=null==e?0:e.length,r=0,o=[];++t<n;){var i=e[t];a=i,L.call(s,a)&&(o[r++]=i)}var a;return o}(q(s)))}:function(){return[]},_e=se;function Se(e){if(null!=e){try{return w.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function ve(e,t){return e===t||e!=e&&t!=t}(K&&"[object DataView]"!=_e(new K(new ArrayBuffer(1)))||W&&_e(new W)!=S||B&&"[object Promise]"!=_e(B.resolve())||Y&&_e(new Y)!=g||x&&"[object WeakMap]"!=_e(new x))&&(_e=function(e){var t=se(e),n=t==v?e.constructor:void 0,r=n?Se(n):"";if(r)switch(r){case J:return"[object DataView]";case G:return S;case X:return"[object Promise]";case $:return g;case Q:return"[object WeakMap]"}return t});var ge=ue(function(){return arguments}())?ue:function(e){return Te(e)&&O.call(e,"callee")&&!L.call(e,"callee")},be=Array.isArray,ye=F||function(){return!1};function Ae(e){if(Re(e)){var t=se(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}}function Ee(e){return"number"==typeof e&&-1<e&&e%1==0&&e<=9007199254740991}function Re(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function Te(e){return null!=e&&"object"==typeof e}var Ie,me=p?(Ie=p,function(e){return Ie(e)}):function(e){return Te(e)&&Ee(e.length)&&!!n[se(e)]};function De(e){return(null!=e&&Ee(e.length)&&!Ae(e)?function(e,t){var n,r,o=be(e),i=!o&&ge(e),a=!o&&!i&&ye(e),s=!o&&!i&&!a&&me(e),u=o||i||a||s,c=u?function(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}(e.length,String):[],l=c.length;for(var d in e)!t&&!O.call(e,d)||u&&("length"==d||a&&("offset"==d||"parent"==d)||s&&("buffer"==d||"byteLength"==d||"byteOffset"==d)||(n=d,(r=null==(r=l)?9007199254740991:r)&&("number"==typeof n||f.test(n))&&-1<n&&n%1==0&&n<r))||c.push(d);return c}:function(e){if(e!==("function"==typeof(t=e&&e.constructor)&&t.prototype||m))return H(e);var t,n=[];for(var r in Object(e))O.call(e,r)&&"constructor"!=r&&n.push(r);return n})(e)}t.exports=function(e,t){return ce(e,t)}}).call(this,t(12),t(13)(e))},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(n(3)),i=(a.prototype.connect=function(i){var s=this;this.connecting=!0,this.network.ajax("POST","https://"+i+"/socket.io/1","",function(e){var t=e.split(":"),n=t[0],r=parseInt(t[1])/2*1e3;s.socket=new WebSocket("wss://"+i+"/socket.io/1/websocket/"+n);var o=null;s.socket.onopen=function(){s.connected=!0,s.connecting=!1,s.onopen&&s.onopen(),o=setInterval(function(){s.socket.send("2:::")},r)},s.socket.onclose=function(){s.connected=!1,clearInterval(o),s.onclose&&s.onclose()},s.socket.onmessage=function(e){var t=e.data.split(":"),n=parseInt(t[0]);if(2===n)s.socket.send("2::");else if(5===n){var r=t[1],o=JSON.parse(t.slice(3).join(":")),i=o.name,a=o.args;r&&s.socket.send("6:::"+r),s.onmessage&&s.onmessage(i,a)}else 7===n&&console.log("Socket error: "+e.data)},s.socket.onerror=function(e){s.socket.close(),s.onerror&&self.onerror(e)}},null,!1,!0)},a.prototype.send=function(e,t){if(this.connected){var n=JSON.stringify({name:e,args:t});this.socket.send("5:::"+n)}else console.log("Leanplum: Socket is not connected.")},a.prototype.setNetworkTimeout=function(e){this.network.setNetworkTimeout(e)},a);function a(){this.network=new o.default,this.connected=!1,this.connecting=!1,this.connected=!1,this.connecting=!1}t.default=i},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,a,s,u){return new(s=s||Promise)(function(n,t){function r(e){try{i(u.next(e))}catch(e){t(e)}}function o(e){try{i(u.throw(e))}catch(e){t(e)}}function i(e){var t;e.done?n(e.value):((t=e.value)instanceof s?t:new s(function(e){e(t)})).then(r,o)}i((u=u.apply(e,a||[])).next())})},s=this&&this.__generator||function(n,r){var o,i,a,e,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,i&&(a=2&t[0]?i.return:t[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,t[1])).done)return a;switch(i=0,a&&(t=[2&t[0],a.value]),t[0]){case 0:case 1:a=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,i=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){s.label=t[1];break}if(6===t[0]&&s.label<a[1]){s.label=a[1],a=t;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(t);break}a[2]&&s.ops.pop(),s.trys.pop();continue}t=r.call(n,s)}catch(e){t=[6,e],i=0}finally{o=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var i=o(n(1)),a=o(n(0)),u=o(n(2)),c=(Object.defineProperty(l.prototype,"serviceWorker",{get:function(){return window.navigator.serviceWorker},enumerable:!0,configurable:!0}),l.prototype.isWebPushSupported=function(){var e;return Boolean(void 0!==(null===(e=window)||void 0===e?void 0:e.navigator)&&"serviceWorker"in window.navigator&&"PushManager"in window)},l.prototype.isWebPushSubscribed=function(){return r(this,void 0,void 0,function(){var t,n,r;return s(this,function(e){switch(e.label){case 0:return this.isWebPushSupported()?[4,this.getServiceWorkerRegistration()]:[2,!1];case 1:return(t=e.sent())?[4,t.pushManager.getSubscription()]:[2,!1];case 2:return n=e.sent(),(r=null!==n)&&this.updateNewSubscriptionOnServer(n),[2,r]}})})},l.prototype.register=function(i,a){return r(this,void 0,void 0,function(){var t,n,r,o;return s(this,function(e){switch(e.label){case 0:if(!this.isWebPushSupported())return console.log("Leanplum: Push messaging is not supported."),[2,a(!1)];e.label=1;case 1:return e.trys.push([1,4,,5]),[4,(t=this).serviceWorker.register(i||"/sw.min.js",null)];case 2:return t.serviceWorkerRegistration=e.sent(),[4,this.serviceWorkerRegistration.pushManager.getSubscription()];case 3:return n=e.sent(),(r=null!==n)&&this.updateNewSubscriptionOnServer(n),[2,a(r)];case 4:return o=e.sent(),console.log("Leanplum: Service Worker Error: ",o),[2,a(!1)];case 5:return[2]}})})},l.prototype.subscribeUser=function(){return r(this,void 0,void 0,function(){var t,n,r;return s(this,function(e){switch(e.label){case 0:t=this.urlB64ToUint8Array("BInWPpWntfR39rgXSP04pqdmEdDGa50z6zqbMvxyxJCwzXIuSpSh8C888-CfJ82WELl7Xe8cjAnfCt-3vK0Ci68"),e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this.serviceWorkerRegistration.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:t})];case 2:if(!(n=e.sent()))throw new Error;return this.updateNewSubscriptionOnServer(n),[3,4];case 3:throw r=e.sent(),new Error("Leanplum: Failed to subscribe the user: "+r);case 4:return[2,!0]}})})},l.prototype.unsubscribeUser=function(){return r(this,void 0,void 0,function(){var t,n;return s(this,function(e){switch(e.label){case 0:return[4,this.isWebPushSubscribed()];case 1:if(!e.sent())return[3,6];e.label=2;case 2:return e.trys.push([2,5,,6]),[4,this.serviceWorkerRegistration.pushManager.getSubscription()];case 3:if(!(t=e.sent()))throw new Error;return[4,t.unsubscribe()];case 4:return e.sent(),[3,6];case 5:throw n=e.sent(),new Error("Leanplum: Error unsubscribing: "+n);case 6:return[2]}})})},l.prototype.getServiceWorkerRegistration=function(){return r(this,void 0,void 0,function(){var t;return s(this,function(e){switch(e.label){case 0:return this.serviceWorkerRegistration?[3,2]:[4,(t=this).serviceWorker.getRegistration()];case 1:t.serviceWorkerRegistration=e.sent(),e.label=2;case 2:return[2,this.serviceWorkerRegistration]}})})},l.prototype.urlB64ToUint8Array=function(e){for(var t=(e+"=".repeat((4-e.length%4)%4)).replace(/-/g,"+").replace(/_/g,"/"),n=this.decodeData(t),r=new Uint8Array(n.length),o=0;o<n.length;++o)r[o]=n.charCodeAt(o);return r},l.prototype.updateNewSubscriptionOnServer=function(e){if(e){var t=this.prepareSubscription(e),n=JSON.stringify(t);u.default.getFromLocalStorage(a.default.DEFAULT_KEYS.PUSH_SUBSCRIPTION)!==n&&(u.default.saveToLocalStorage(a.default.DEFAULT_KEYS.PUSH_SUBSCRIPTION,n),this.setSubscription(n))}},l.prototype.prepareSubscription=function(e){var t="getKey"in e?e.getKey("p256dh"):[],n="getKey"in e?e.getKey("auth"):[],r=this.encodeData(String.fromCharCode.apply(null,new Uint8Array(t))),o=this.encodeData(String.fromCharCode.apply(null,new Uint8Array(n)));return{endpoint:e.endpoint,key:r,auth:o}},l.prototype.setSubscription=function(e){if(e){var t=(new i.default).add(a.default.PARAMS.WEB_PUSH_SUBSCRIPTION,e);this.createRequest(a.default.METHODS.SET_DEVICE_ATTRIBUTES,t,{queued:!1,sendNow:!0})}},l.prototype.encodeData=function(e){return window.btoa(e)},l.prototype.decodeData=function(e){return window.atob(e)},l);function l(e){this.createRequest=e,this.serviceWorkerRegistration=null}t.default=c},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(n(1)),i=r(n(0)),a=r(n(2)),s=(u.prototype.applyDiffs=function(e,t,n){this.diffs=e,this.variants=t,this.actionMetadata=n,this.hasReceivedDiffs=!0,this.merged=function r(t,o){if("number"==typeof o||"boolean"==typeof o||"string"==typeof o)return o;if(null==o)return t;function e(r){return function(e){if(r instanceof Array)for(var t=0;t<r.length;t++)e(r[t]);else for(var n in r)!{}.hasOwnProperty.call(r,n)||e(n)}}var n=e(t),i=e(o),a=!1;if(null===t&&!(o instanceof Array))for(var s in a=null,o)if(o.hasOwnProperty(s)){if(null===a&&(a=!0),"string"!=typeof s){a=!1;break}if(s.length<3||"["!==s.charAt(0)||"]"!==s.charAt(s.length-1)){a=!1;break}}if(t instanceof Array||a){var u=[];return n(function(e){u.push(e)}),i(function(e){for(var t=parseInt(e.substring(1,e.length-1)),n=o[e];t>=u.length;)u.push(null);u[t]=r(u[t],n)}),u}var c={};return n(function(e){null!==o[e]&&void 0!==o[e]||(c[e]=t[e])}),i(function(e){c[e]=r(null===t?null:t[e]||{},o[e])}),c}(this.variables,e),this.saveDiffs(),this.onUpdate&&this.onUpdate()},u.prototype.loadDiffs=function(){try{this.applyDiffs(JSON.parse(this.loadLocal(i.default.DEFAULT_KEYS.VARIABLES)||null),JSON.parse(this.loadLocal(i.default.DEFAULT_KEYS.VARIANTS)||null),JSON.parse(this.loadLocal(i.default.DEFAULT_KEYS.ACTION_METADATA)||null)),this.token=this.loadLocal(i.default.DEFAULT_KEYS.TOKEN),this.variantDebugInfo=this.loadLocal(i.default.DEFAULT_KEYS.VARIANT_DEBUG_INFO)}catch(e){console.log("Leanplum: Invalid diffs: "+e)}},u.prototype.saveDiffs=function(){this.saveLocal(i.default.DEFAULT_KEYS.VARIABLES,JSON.stringify(this.diffs||{})),this.saveLocal(i.default.DEFAULT_KEYS.VARIANTS,JSON.stringify(this.variants||[])),this.saveLocal(i.default.DEFAULT_KEYS.ACTION_METADATA,JSON.stringify(this.actionMetadata||{})),this.saveLocal(i.default.DEFAULT_KEYS.VARIANT_DEBUG_INFO,JSON.stringify(this.variantDebugInfo||{})),this.saveLocal(i.default.DEFAULT_KEYS.TOKEN,this.token)},u.prototype.getVariable=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=this.getVariables();if(n)for(var r=0;r<e.length;r++)n=n[e[r]];return n},u.prototype.getVariables=function(){return void 0!==this.merged?this.merged:this.variables},u.prototype.setVariables=function(e){this.variables=e},u.prototype.addVariablesChangedHandler=function(e){this.variablesChangedHandlers.push(e),this.hasReceivedDiffs&&e()},u.prototype.removeVariablesChangedHandler=function(e){var t=this.variablesChangedHandlers.indexOf(e);0<=t&&this.variablesChangedHandlers.splice(t,1)},u.prototype.triggerVariablesChangedHandlers=function(){for(var e=0;e<this.variablesChangedHandlers.length;e++)this.variablesChangedHandlers[e]()},u.prototype.getVariantDebugInfo=function(){return this.variantDebugInfo},u.prototype.setVariantDebugInfo=function(e){this.variantDebugInfo=e},u.prototype.sendVariables=function(){var e,t=((e={})[i.default.PARAMS.VARIABLES]=this.variables,e),n=(new o.default).body(JSON.stringify(t));this.createRequest(i.default.METHODS.SET_VARS,n,{sendNow:!0})},u.prototype.clearUserContent=function(){this.diffs=void 0,this.variables=null,this.variants=[],this.variantDebugInfo={},this.merged=void 0},u.prototype.loadLocal=function(e){return a.default.getFromLocalStorage(e)},u.prototype.saveLocal=function(e,t){a.default.saveToLocalStorage(e,t)},u);function u(e){this.createRequest=e,this.actionMetadata={},this.hasReceivedDiffs=!1,this.merged=void 0,this.variables=null,this.variablesChangedHandlers=[],this.variantDebugInfo={},this.diffs=void 0,this.token="",this.variants=[]}t.default=s}],o.c=r,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)o.d(n,r,function(e){return t[e]}.bind(null,r));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=4);function o(e){if(r[e])return r[e].exports;var t=r[e]={i:e,l:!1,exports:{}};return n[e].call(t.exports,t,t.exports,o),t.l=!0,t.exports}var n,r});