!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.Leanplum=t():e.Leanplum=t()}(window,function(){return r={},o.m=n=[function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={METHODS:{START:"start",STOP:"stop",ADVANCE:"advance",TRACK:"track",PAUSE_SESSION:"pauseSession",RESUME_SESSION:"resumeSession",PAUSE_STATE:"pauseState",RESUME_STATE:"resumeState",DOWNLOAD_FILE:"downloadFile",MULTI:"multi",SET_VARS:"setVars",GET_VARS:"getVars",SET_USER_ATTRIBUTES:"setUserAttributes",SET_DEVICE_ATTRIBUTES:"setDeviceAttributes",UPLOAD_FILE:"uploadFile",REGISTER_DEVICE:"registerDevice"},SDK_VERSION:"1.6.0",CLIENT:"js",PARAMS:{ACTION:"action",APP_ID:"appId",CLIENT:"client",CLIENT_KEY:"clientKey",CURRENCY_CODE:"currencyCode",DEVICE_ID:"deviceId",SDK_VERSION:"sdkVersion",USER_ID:"userId",NEW_USER_ID:"newUserId",DEV_MODE:"devMode",VERSION_NAME:"versionName",SYSTEM_NAME:"systemName",SYSTEM_VERSION:"systemVersion",BROWSER_NAME:"browserName",BROWSER_VERSION:"browserVersion",DEVICE_NAME:"deviceName",DEVICE_MODEL:"deviceModel",USER_ATTRIBUTES:"userAttributes",LOCALE:"locale",COUNTRY:"country",REGION:"region",CITY:"city",LOCATION:"location",STATE:"state",INFO:"info",EVENT:"event",VALUE:"value",FILENAME:"filename",TIME:"time",DATA:"data",VARS:"vars",FILE:"file",SIZE:"size",VARIATION:"variation",HASH:"hash",EMAIL:"email",VARIABLES:"vars",PARAMS:"params",INCLUDE_DEFAULTS:"includeDefaults",INCLUDE_VARIANT_DEBUG_INFO:"includeVariantDebugInfo",NEWSFEED_MESSAGES:"newsfeedMessages",MESSAGE_ID:"messageId",WEB_PUSH_SUBSCRIPTION:"webPushSubscription"},KEYS:{IS_REGISTERED:"isRegistered",LATEST_VERSION:"latestVersion",SYNC_INBOX:"syncNewsfeed",MESSAGES:"messages",VARS:"vars",VARIANTS:"variants",VARIANT_DEBUG_INFO:"variantDebugInfo",ACTION_METADATA:"actionMetadata",TOKEN:"token"},DEFAULT_KEYS:{COUNT:"__leanplum_unsynced",ITEM:"__leanplum_unsynced_",VARIABLES:"__leanplum_variables",VARIANTS:"__leanplum_variants",VARIANT_DEBUG_INFO:"__leanplum_variant_debug_info",ACTION_METADATA:"__leanplum_action_metadata",INBOX_MESSAGES:"__leanplum_inbox_messages",TOKEN:"__leanplum_token",DEVICE_ID:"__leanplum_device_id",USER_ID:"__leanplum_user_id",SESSION:"__leanplum_session",PUSH_SUBSCRIPTION:"__leanplum_push_subscription"},VALUES:{DETECT:"(detect)",DEFAULT_PUSH_ACTION:"Open action"}}},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(n(0)),i=(s.prototype.add=function(e,t){if(void 0===t)return this;this.argString&&(this.argString+="&");var n="";return n=t instanceof Array?JSON.stringify(t):encodeURIComponent(t),this.argString+=e+"="+n,this.argValues[e]=t,this},s.prototype.body=function(e){return e?(this._body=e,this):this._body},s.prototype.attachApiKeys=function(e,t){return this.add(o.default.PARAMS.APP_ID,e).add(o.default.PARAMS.CLIENT,o.default.CLIENT).add(o.default.PARAMS.CLIENT_KEY,t)},s.prototype.build=function(){return this.argString},s.prototype.buildDict=function(){return this.argValues},s);function s(){this.argString="",this.argValues={}}t.default=i},function(e,t,n){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0});var o={},i=(s.getFromLocalStorage=function(e){return!1===r?o[e]:localStorage[e]},s.saveToLocalStorage=function(t,n){if(!1!==r)try{localStorage[t]=n}catch(e){r=!1,o[t]=n}else o[t]=n},s.removeFromLocalStorage=function(t){if(!1!==r)try{localStorage.removeItem(t)}catch(e){r=!1,delete o[t]}else delete o[t]},s);function s(){}t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(o.prototype.setNetworkTimeout=function(e){this.networkTimeoutSeconds=e},o.prototype.ajax=function(e,t,n,r,o,i,s){var a=this;if(i){if(this.runningRequest)return this.enqueueRequest(arguments);this.runningRequest=!0}if("undefined"!=typeof XDomainRequest)return"http:"===location.protocol&&0===t.indexOf("https:")&&(t="http:"+t.substring(6)),this.ajaxIE8(e,t,n,r,o,i,s);var u=!1,c=new XMLHttpRequest;c.onreadystatechange=function(){if(4===c.readyState){if(u)return;var e,t=!(u=!0);if(s)e=c.responseText;else try{e=JSON.parse(c.responseText)}catch(e){setTimeout(function(){o&&o(null,c)},0),t=!0}t||(200<=c.status&&c.status<300?setTimeout(function(){r&&r(e,c)},0):setTimeout(function(){o&&o(e,c)},0)),i&&(a.runningRequest=!1,a.dequeueRequest())}},c.open(e,t,!0),c.setRequestHeader("Content-Type","text/plain"),c.send(n),setTimeout(function(){u||c.abort()},1e3*this.networkTimeoutSeconds)},o.prototype.ajaxIE8=function(e,t,n,r,o,i,s){var a=this,u=new XDomainRequest;u.onload=function(){var e,t=!1;if(s)e=u.responseText;else try{e=JSON.parse(u.responseText)}catch(e){setTimeout(function(){o&&o(null,u)},0),t=!0}t||setTimeout(function(){r&&r(e,u)},0),i&&(a.runningRequest=!1,a.dequeueRequest())},u.onerror=u.ontimeout=function(){setTimeout(function(){o&&o(null,u)},0),i&&(a.runningRequest=!1,a.dequeueRequest())},u.onprogress=function(){},u.open(e,t),u.timeout=1e3*this.networkTimeoutSeconds,u.send(n)},o.prototype.enqueueRequest=function(e){this.requestQueue.push(e)},o.prototype.dequeueRequest=function(){var e=this.requestQueue.shift();e&&this.ajax.apply(this,e)},o);function o(){this.networkTimeoutSeconds=10,this.requestQueue=[],this.runningRequest=!1}t.default=r},function(e,tt,t){(function(e,t){var r="__lodash_hash_undefined__",b=1,S=2,n=9007199254740991,g="[object Arguments]",y="[object Array]",o="[object AsyncFunction]",A="[object Boolean]",E="[object Date]",m="[object Error]",i="[object Function]",s="[object GeneratorFunction]",R="[object Map]",T="[object Number]",a="[object Null]",I="[object Object]",u="[object Promise]",c="[object Proxy]",D="[object RegExp]",M="[object Set]",O="[object String]",w="[object Symbol]",l="[object Undefined]",d="[object WeakMap]",N="[object ArrayBuffer]",C="[object DataView]",f=/^\[object .+?Constructor\]$/,p=/^(?:0|[1-9]\d*)$/,h={};h["[object Float32Array]"]=h["[object Float64Array]"]=h["[object Int8Array]"]=h["[object Int16Array]"]=h["[object Int32Array]"]=h["[object Uint8Array]"]=h["[object Uint8ClampedArray]"]=h["[object Uint16Array]"]=h["[object Uint32Array]"]=!0,h[g]=h[y]=h[N]=h[A]=h[C]=h[E]=h[m]=h[i]=h[R]=h[T]=h[I]=h[D]=h[M]=h[O]=h[d]=!1;var _="object"==typeof e&&e&&e.Object===Object&&e,v="object"==typeof self&&self&&self.Object===Object&&self,P=_||v||Function("return this")(),U=tt&&!tt.nodeType&&tt,L=U&&"object"==typeof t&&t&&!t.nodeType&&t,V=L&&L.exports===U,k=V&&_.process,q=function(){try{return k&&k.binding&&k.binding("util")}catch(e){}}(),j=q&&q.isTypedArray;function F(e,t){for(var n=-1,r=null==e?0:e.length;++n<r;)if(t(e[n],n,e))return 1}function H(e){var n=-1,r=Array(e.size);return e.forEach(function(e,t){r[++n]=[t,e]}),r}function K(e){var t=-1,n=Array(e.size);return e.forEach(function(e){n[++t]=e}),n}var W,x,Y,B=Array.prototype,z=Function.prototype,G=Object.prototype,J=P["__core-js_shared__"],X=z.toString,Q=G.hasOwnProperty,$=(W=/[^.]+$/.exec(J&&J.keys&&J.keys.IE_PROTO||""))?"Symbol(src)_1."+W:"",Z=G.toString,ee=RegExp("^"+X.call(Q).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),te=V?P.Buffer:void 0,ne=P.Symbol,re=P.Uint8Array,oe=G.propertyIsEnumerable,ie=B.splice,se=ne?ne.toStringTag:void 0,ae=Object.getOwnPropertySymbols,ue=te?te.isBuffer:void 0,ce=(x=Object.keys,Y=Object,function(e){return x(Y(e))}),le=je(P,"DataView"),de=je(P,"Map"),fe=je(P,"Promise"),pe=je(P,"Set"),he=je(P,"WeakMap"),_e=je(Object,"create"),ve=We(le),Se=We(de),ge=We(fe),ye=We(pe),be=We(he),Ae=ne?ne.prototype:void 0,Ee=Ae?Ae.valueOf:void 0;function me(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function Re(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function Te(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function Ie(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new Te;++t<n;)this.add(e[t])}function De(e){var t=this.__data__=new Re(e);this.size=t.size}function Me(e,t){var n=Be(e),r=!n&&Ye(e),o=!n&&!r&&ze(e),i=!n&&!r&&!o&&Ze(e),s=n||r||o||i,a=s?function(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}(e.length,String):[],u=a.length;for(var c in e)!t&&!Q.call(e,c)||s&&("length"==c||o&&("offset"==c||"parent"==c)||i&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||Ke(c,u))||a.push(c);return a}function Oe(e,t){for(var n=e.length;n--;)if(xe(e[n][0],t))return n;return-1}function we(e,t,n){var r=t(e);return Be(e)?r:function(e,t){for(var n=-1,r=t.length,o=e.length;++n<r;)e[o+n]=t[n];return e}(r,n(e))}function Ne(e){return null==e?void 0===e?l:a:se&&se in Object(e)?function(e){var t=Q.call(e,se),n=e[se];try{var r=!(e[se]=void 0)}catch(e){}var o=Z.call(e);r&&(t?e[se]=n:delete e[se]);return o}(e):(t=e,Z.call(t));var t}function Ce(e){return Qe(e)&&Ne(e)==g}function Pe(e,t,n,r,o){return e===t||(null==e||null==t||!Qe(e)&&!Qe(t)?e!=e&&t!=t:function(e,t,n,r,o,i){var s=Be(e),a=Be(t),u=s?y:He(e),c=a?y:He(t),l=(u=u==g?I:u)==I,d=(c=c==g?I:c)==I,f=u==c;if(f&&ze(e)){if(!ze(t))return!1;l=!(s=!0)}if(f&&!l)return i=i||new De,s||Ze(e)?Ve(e,t,n,r,o,i):function(e,t,n,r,o,i,s){switch(n){case C:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case N:return e.byteLength==t.byteLength&&i(new re(e),new re(t))?!0:!1;case A:case E:case T:return xe(+e,+t);case m:return e.name==t.name&&e.message==t.message;case D:case O:return e==t+"";case R:var a=H;case M:var u=r&b;if(a=a||K,e.size!=t.size&&!u)return!1;var c=s.get(e);if(c)return c==t;r|=S,s.set(e,t);var l=Ve(a(e),a(t),r,o,i,s);return s.delete(e),l;case w:if(Ee)return Ee.call(e)==Ee.call(t)}return!1}(e,t,u,n,r,o,i);if(!(n&b)){var p=l&&Q.call(e,"__wrapped__"),h=d&&Q.call(t,"__wrapped__");if(p||h){var _=p?e.value():e,v=h?t.value():t;return i=i||new De,o(_,v,n,r,i)}}return f&&(i=i||new De,function(e,t,n,r,o,i){var s=n&b,a=ke(e),u=a.length,c=ke(t).length;if(u!=c&&!s)return!1;var l=u;for(;l--;){var d=a[l];if(!(s?d in t:Q.call(t,d)))return!1}var f=i.get(e);if(f&&i.get(t))return f==t;var p=!0;i.set(e,t),i.set(t,e);var h=s;for(;++l<u;){d=a[l];var _=e[d],v=t[d];if(r)var S=s?r(v,_,d,t,e,i):r(_,v,d,e,t,i);if(!(void 0===S?_===v||o(_,v,n,r,i):S)){p=!1;break}h=h||"constructor"==d}if(p&&!h){var g=e.constructor,y=t.constructor;g!=y&&"constructor"in e&&"constructor"in t&&!("function"==typeof g&&g instanceof g&&"function"==typeof y&&y instanceof y)&&(p=!1)}return i.delete(e),i.delete(t),p}(e,t,n,r,o,i))}(e,t,n,r,Pe,o))}function Ue(e){return Xe(e)&&!($&&$ in e)&&(Ge(e)?ee:f).test(We(e))}function Le(e){if(n=(t=e)&&t.constructor,r="function"==typeof n&&n.prototype||G,t!==r)return ce(e);var t,n,r,o=[];for(var i in Object(e))Q.call(e,i)&&"constructor"!=i&&o.push(i);return o}function Ve(e,t,r,o,i,s){var n=r&b,a=e.length,u=t.length;if(a!=u&&!(n&&a<u))return!1;var c=s.get(e);if(c&&s.get(t))return c==t;var l=-1,d=!0,f=r&S?new Ie:void 0;for(s.set(e,t),s.set(t,e);++l<a;){var p=e[l],h=t[l];if(o)var _=n?o(h,p,l,t,e,s):o(p,h,l,e,t,s);if(void 0!==_){if(_)continue;d=!1;break}if(f){if(!F(t,function(e,t){return n=t,!f.has(n)&&(p===e||i(p,e,r,o,s))&&f.push(t);var n})){d=!1;break}}else if(p!==h&&!i(p,h,r,o,s)){d=!1;break}}return s.delete(e),s.delete(t),d}function ke(e){return we(e,et,Fe)}function qe(e,t){var n,r,o=e.__data__;return("string"==(r=typeof(n=t))||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==n:null===n)?o["string"==typeof t?"string":"hash"]:o.map}function je(e,t){var n,r,o=(r=t,null==(n=e)?void 0:n[r]);return Ue(o)?o:void 0}me.prototype.clear=function(){this.__data__=_e?_e(null):{},this.size=0},me.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},me.prototype.get=function(e){var t=this.__data__;if(_e){var n=t[e];return n===r?void 0:n}return Q.call(t,e)?t[e]:void 0},me.prototype.has=function(e){var t=this.__data__;return _e?void 0!==t[e]:Q.call(t,e)},me.prototype.set=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=_e&&void 0===t?r:t,this},Re.prototype.clear=function(){this.__data__=[],this.size=0},Re.prototype.delete=function(e){var t=this.__data__,n=Oe(t,e);return!(n<0)&&(n==t.length-1?t.pop():ie.call(t,n,1),--this.size,!0)},Re.prototype.get=function(e){var t=this.__data__,n=Oe(t,e);return n<0?void 0:t[n][1]},Re.prototype.has=function(e){return-1<Oe(this.__data__,e)},Re.prototype.set=function(e,t){var n=this.__data__,r=Oe(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this},Te.prototype.clear=function(){this.size=0,this.__data__={hash:new me,map:new(de||Re),string:new me}},Te.prototype.delete=function(e){var t=qe(this,e).delete(e);return this.size-=t?1:0,t},Te.prototype.get=function(e){return qe(this,e).get(e)},Te.prototype.has=function(e){return qe(this,e).has(e)},Te.prototype.set=function(e,t){var n=qe(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this},Ie.prototype.add=Ie.prototype.push=function(e){return this.__data__.set(e,r),this},Ie.prototype.has=function(e){return this.__data__.has(e)},De.prototype.clear=function(){this.__data__=new Re,this.size=0},De.prototype.delete=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n},De.prototype.get=function(e){return this.__data__.get(e)},De.prototype.has=function(e){return this.__data__.has(e)},De.prototype.set=function(e,t){var n=this.__data__;if(n instanceof Re){var r=n.__data__;if(!de||r.length<199)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new Te(r)}return n.set(e,t),this.size=n.size,this};var Fe=ae?function(t){return null==t?[]:(t=Object(t),function(e,t){for(var n=-1,r=null==e?0:e.length,o=0,i=[];++n<r;){var s=e[n];t(s,n,e)&&(i[o++]=s)}return i}(ae(t),function(e){return oe.call(t,e)}))}:function(){return[]},He=Ne;function Ke(e,t){return(t=null==t?n:t)&&("number"==typeof e||p.test(e))&&-1<e&&e%1==0&&e<t}function We(e){if(null!=e){try{return X.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function xe(e,t){return e===t||e!=e&&t!=t}(le&&He(new le(new ArrayBuffer(1)))!=C||de&&He(new de)!=R||fe&&He(fe.resolve())!=u||pe&&He(new pe)!=M||he&&He(new he)!=d)&&(He=function(e){var t=Ne(e),n=t==I?e.constructor:void 0,r=n?We(n):"";if(r)switch(r){case ve:return C;case Se:return R;case ge:return u;case ye:return M;case be:return d}return t});var Ye=Ce(function(){return arguments}())?Ce:function(e){return Qe(e)&&Q.call(e,"callee")&&!oe.call(e,"callee")},Be=Array.isArray;var ze=ue||function(){return!1};function Ge(e){if(Xe(e)){var t=Ne(e);return t==i||t==s||t==o||t==c}}function Je(e){return"number"==typeof e&&-1<e&&e%1==0&&e<=n}function Xe(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function Qe(e){return null!=e&&"object"==typeof e}var $e,Ze=j?($e=j,function(e){return $e(e)}):function(e){return Qe(e)&&Je(e.length)&&!!h[Ne(e)]};function et(e){return(null!=(t=e)&&Je(t.length)&&!Ge(t)?Me:Le)(e);var t}t.exports=function(e,t){return Pe(e,t)}}).call(this,t(13),t(14)(e))},function(e,t,n){var r=n(6);e.exports=r.default},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(n(0)),i=r(n(7)),s=(a.setApiPath=function(e){a._lp.setApiPath(e)},a.setEmail=function(e){a._lp.setEmail(e)},a.setNetworkTimeout=function(e){a._lp.setNetworkTimeout(e)},a.setAppIdForDevelopmentMode=function(e,t){a._lp.setAppIdForDevelopmentMode(e,t)},a.setAppIdForProductionMode=function(e,t){a._lp.setAppIdForProductionMode(e,t)},a.setSocketHost=function(e){a._lp.setSocketHost(e)},a.setDeviceId=function(e){a._lp.setDeviceId(e)},a.setAppVersion=function(e){a._lp.setAppVersion(e)},a.setDeviceName=function(e){a._lp.setDeviceName(e)},a.setDeviceModel=function(e){a._lp.setDeviceModel(e)},a.setRequestBatching=function(e,t){a._lp.setRequestBatching(e,t)},a.setSystemName=function(e){a._lp.setSystemName(e)},a.setSystemVersion=function(e){a._lp.setSystemVersion(e)},a.setVariables=function(e){a._lp.setVariables(e)},a.setVariantDebugInfoEnabled=function(e){a._lp.setVariantDebugInfoEnabled(e)},a.getVariantDebugInfo=function(){return a._lp.getVariantDebugInfo()},a.getVariables=function(){return a._lp.getVariables()},a.getVariable=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return(e=a._lp).getVariable.apply(e,t)},a.getVariants=function(){return a._lp.getVariants()},a.inbox=function(){return a._lp.inbox()},a.addStartResponseHandler=function(e){a._lp.addStartResponseHandler(e)},a.removeStartResponseHandler=function(e){a._lp.removeStartResponseHandler(e)},a.addVariablesChangedHandler=function(e){a._lp.addVariablesChangedHandler(e)},a.removeVariablesChangedHandler=function(e){a._lp.removeVariablesChangedHandler(e)},a.forceContentUpdate=function(e){a._lp.forceContentUpdate(e)},a.useSessionLength=function(e){a._lp.useSessionLength(e)},a.start=function(e,t,n){a._lp.start(e,t,n)},a.startFromCache=function(e,t,n){a._lp.startFromCache(e,t,n)},a.stop=function(){a._lp.stop()},a.pauseSession=function(){a._lp.pauseSession()},a.resumeSession=function(){a._lp.resumeSession()},a.pauseState=function(){a._lp.pauseState()},a.resumeState=function(){a._lp.resumeState()},a.getUserId=function(){return this._lp.getUserId()},a.setUserId=function(e){a.setUserAttributes(e)},a.setUserAttributes=function(e,t){a._lp.setUserAttributes(e,t)},a.track=function(e,t,n,r){a._lp.track(e,t,n,r)},a.trackPurchase=function(e,t,n,r){void 0===r&&(r="Purchase"),a._lp.trackPurchase(e,t,n,r)},a.advanceTo=function(e,t,n){a._lp.advanceTo(e,t,n)},a.isWebPushSupported=function(){return a._lp.isWebPushSupported()},a.isWebPushSubscribed=function(){return a._lp.isWebPushSubscribed()},a.setWebPushOptions=function(e){return a._lp.setWebPushOptions(e)},a.registerForWebPush=function(e){return a._lp.registerForWebPush(e)},a.unregisterFromWebPush=function(){return a._lp.unregisterFromWebPush()},a.clearUserContent=function(){a._lp.clearUserContent()},a.applyQueue=function(e){a._lp.applyQueue(e)},a.__destroy=function(){this._lp=new i.default(window)},a._lp=new i.default(window),a.VERSION=o.default.SDK_VERSION,a);function a(){}t.default=s},function(e,t,n){"use strict";var a=this&&this.__assign||function(){return(a=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var s=r(n(1)),o=r(n(8)),u=r(n(0)),i=r(n(9)),c=r(n(10)),l=r(n(11)),d=r(n(12)),f=r(n(2)),p=r(n(16)),h=r(n(4)),_=r(n(17)),v=u.default.DEFAULT_KEYS.SESSION,S=(g.prototype.setApiPath=function(e){this._lpRequest.apiPath&&(this._lpRequest.apiPath=e)},g.prototype.setEmail=function(e){this._email=e},g.prototype.setNetworkTimeout=function(e){this._lpRequest.setNetworkTimeout(e),this._lpSocket.setNetworkTimeout(e)},g.prototype.setAppIdForDevelopmentMode=function(e,t){this._lpRequest.appId=e,this._lpRequest.clientKey=t,this._internalState.devMode=!0},g.prototype.setAppIdForProductionMode=function(e,t){this._lpRequest.appId=e,this._lpRequest.clientKey=t,this._internalState.devMode=!1},g.prototype.setSocketHost=function(e){this._lpSocket.setSocketHost(e)},g.prototype.setDeviceId=function(e){this._lpRequest.deviceId=e},g.prototype.setAppVersion=function(e){this._lpRequest.versionName=e},g.prototype.setDeviceName=function(e){this._deviceName=e},g.prototype.setDeviceModel=function(e){this._deviceModel=e},g.prototype.setRequestBatching=function(e,t){this._lpRequest.batchEnabled=e,this._lpRequest.batchCooldown=t},g.prototype.setSystemName=function(e){this._systemName=e},g.prototype.setSystemVersion=function(e){this._systemVersion=e},g.prototype.setVariables=function(e){this._varCache.setVariables(e)},g.prototype.setVariantDebugInfoEnabled=function(e){this._internalState.variantDebugInfoEnabled=e},g.prototype.getVariantDebugInfo=function(){return this._varCache.getVariantDebugInfo()},g.prototype.getVariables=function(){return this._varCache.getVariables()},g.prototype.getVariable=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return(e=this._varCache).getVariable.apply(e,t)},g.prototype.getVariants=function(){return this._varCache.variants||[]},g.prototype.inbox=function(){return this._lpInbox},g.prototype.onInboxAction=function(e,t){var n=this;this.trackMessage(e,"Open",function(){return t&&n.onAction(t)})},g.prototype.addStartResponseHandler=function(e){this._internalState.addStartResponseHandler(e)},g.prototype.removeStartResponseHandler=function(e){this._internalState.removeStartResponseHandler(e)},g.prototype.addVariablesChangedHandler=function(e){this._varCache.addVariablesChangedHandler(e)},g.prototype.removeVariablesChangedHandler=function(e){this._varCache.removeVariablesChangedHandler(e)},g.prototype.forceContentUpdate=function(r){var o=this,e=(new s.default).add(u.default.PARAMS.INCLUDE_DEFAULTS,!1).add(u.default.PARAMS.INCLUDE_VARIANT_DEBUG_INFO,this._internalState.variantDebugInfoEnabled);this.createRequest(u.default.METHODS.GET_VARS,e,{queued:!1,sendNow:!0,response:function(e){var t=o._lpRequest.getLastResponse(e),n=o._lpRequest.isResponseSuccess(t);n&&(o._varCache.applyDiffs(t[u.default.KEYS.VARS],t[u.default.KEYS.VARIANTS],t[u.default.KEYS.ACTION_METADATA]),o._varCache.setVariantDebugInfo(t[u.default.KEYS.VARIANT_DEBUG_INFO])),r&&r(n)}})},g.prototype.useSessionLength=function(e){this._sessionLength=e},g.prototype.start=function(e,t,n){var r=this;if("function"==typeof e?(n=e,t={},e=null):"object"==typeof e&&null!=e?(n=t,t=e,e=null):"function"==typeof t&&(n=t,t={}),this.hasActiveSession())return this.startFromCache(e,t,n);this._lpRequest.userId=e,n&&this.addStartResponseHandler(n),this._varCache.onUpdate=function(){r._varCache.triggerVariablesChangedHandlers()};var o=(new s.default).add(u.default.PARAMS.USER_ATTRIBUTES,JSON.stringify(t)).add(u.default.PARAMS.COUNTRY,u.default.VALUES.DETECT).add(u.default.PARAMS.REGION,u.default.VALUES.DETECT).add(u.default.PARAMS.CITY,u.default.VALUES.DETECT).add(u.default.PARAMS.LOCATION,u.default.VALUES.DETECT).add(u.default.PARAMS.SYSTEM_NAME,this._systemName||this._browserDetector.OS).add(u.default.PARAMS.SYSTEM_VERSION,(this._systemVersion||"").toString()).add(u.default.PARAMS.BROWSER_NAME,this._browserDetector.browser).add(u.default.PARAMS.BROWSER_VERSION,this._browserDetector.version.toString()).add(u.default.PARAMS.LOCALE,u.default.VALUES.DETECT).add(u.default.PARAMS.DEVICE_NAME,this._deviceName||this._browserDetector.browser+" "+this._browserDetector.version).add(u.default.PARAMS.DEVICE_MODEL,this._deviceModel||"Web Browser").add(u.default.PARAMS.NEWSFEED_MESSAGES,this._lpInbox.messageIds()).add(u.default.PARAMS.INCLUDE_DEFAULTS,!1).add(u.default.PARAMS.INCLUDE_VARIANT_DEBUG_INFO,this._internalState.variantDebugInfoEnabled);this.createRequest(u.default.METHODS.START,o,{queued:!0,sendNow:!0,response:function(e){r._internalState.hasStarted=!0;var t=r._lpRequest.getLastResponse(e);if(r._lpRequest.isResponseSuccess(t)){if(r._internalState.startSuccessful=!0,r.updateSession(),r._messageCache=t[u.default.KEYS.MESSAGES],t[u.default.KEYS.SYNC_INBOX]&&r._lpInbox.downloadMessages(),r._internalState.devMode){var n=t[u.default.KEYS.LATEST_VERSION];n&&console.log("A newer version of the Leanplum SDK, "+n+', is available.\nUse "npm update leanplum-sdk" or go to https://docs.leanplum.com/reference#javascript-setup to download it.'),r.connectSocket()}r._varCache.applyDiffs(t[u.default.KEYS.VARS],t[u.default.KEYS.VARIANTS],t[u.default.KEYS.ACTION_METADATA]),r._varCache.setVariantDebugInfo(t[u.default.KEYS.VARIANT_DEBUG_INFO]),r._varCache.token=t[u.default.KEYS.TOKEN]}else r._internalState.startSuccessful=!1,r._varCache.loadDiffs();r._internalState.triggerStartHandlers()}})},g.prototype.startFromCache=function(e,t,n){"function"==typeof e?(n=e,t={},e=null):"object"==typeof e&&null!=e?(n=t,t=e,e=null):"function"==typeof t&&(n=t,t={}),this.updateSession(),this._lpRequest.userId=e,n&&this.addStartResponseHandler(n),this._internalState.hasStarted=!0,this._internalState.startSuccessful=!0,this._internalState.devMode&&this.connectSocket(),this._varCache.loadDiffs(),this._internalState.triggerStartHandlers()},g.prototype.stop=function(){this.createRequest(u.default.METHODS.STOP,void 0,{sendNow:!0,queued:!0,response:function(){f.default.removeFromLocalStorage(v)}})},g.prototype.pauseSession=function(){this.createRequest(u.default.METHODS.PAUSE_SESSION,void 0,{sendNow:!0,queued:!0})},g.prototype.resumeSession=function(){this.createRequest(u.default.METHODS.RESUME_SESSION,void 0,{sendNow:!0,queued:!0})},g.prototype.pauseState=function(){this.createRequest(u.default.METHODS.PAUSE_STATE,void 0,{queued:!0})},g.prototype.resumeState=function(){this.createRequest(u.default.METHODS.RESUME_STATE,void 0,{queued:!0})},g.prototype.getUserId=function(){return this._lpRequest.userId},g.prototype.setUserId=function(e){this.setUserAttributes(e)},g.prototype.setUserAttributes=function(e,t){if(void 0===t)if("object"==typeof e)t=e,e=void 0;else if("string"!=typeof e)return void console.log("Leanplum: setUserAttributes expects a string or an object");var n=(new s.default).add(u.default.PARAMS.USER_ATTRIBUTES,t?JSON.stringify(t):void 0).add(u.default.PARAMS.NEW_USER_ID,e);this.createRequest(u.default.METHODS.SET_USER_ATTRIBUTES,n,{queued:!0}),e&&(this._lpRequest.userId=e,f.default.saveToLocalStorage(u.default.DEFAULT_KEYS.USER_ID,this._lpRequest.userId))},g.prototype.track=function(e,t,n,r){var o=this;"object"==typeof t&&null!=t?(r=t,t=n=void 0):"string"==typeof t?(r=n,n=t,t=void 0):"object"==typeof n&&null!=n&&(r=n,n=void 0);var i=(new s.default).add(u.default.PARAMS.EVENT,e).add(u.default.PARAMS.VALUE,t||0).add(u.default.PARAMS.INFO,n).add(u.default.PARAMS.PARAMS,JSON.stringify(r));this.createRequest(u.default.METHODS.TRACK,i,{queued:!0,response:function(){return o.updateSession()}})},g.prototype.trackPurchase=function(e,t,n,r){void 0===r&&(r="Purchase");var o=(new s.default).add(u.default.PARAMS.EVENT,r).add(u.default.PARAMS.VALUE,e||0).add(u.default.PARAMS.PARAMS,JSON.stringify(n));t&&o.add(u.default.PARAMS.CURRENCY_CODE,t),this.createRequest(u.default.METHODS.TRACK,o,{queued:!0})},g.prototype.advanceTo=function(e,t,n){"object"==typeof t&&null!=t&&(n=t,t=void 0);var r=(new s.default).add(u.default.PARAMS.STATE,e).add(u.default.PARAMS.INFO,t).add(u.default.PARAMS.PARAMS,JSON.stringify(n));this.createRequest(u.default.METHODS.ADVANCE,r,{queued:!0})},g.prototype.isWebPushSupported=function(){return this._pushManager.isWebPushSupported()},g.prototype.isWebPushSubscribed=function(){return this._pushManager.isWebPushSubscribed()},g.prototype.setWebPushOptions=function(e){this._webPushOptions=a({},e)},g.prototype.registerForWebPush=function(e){var t=this;if(this._pushManager.isWebPushSupported()){var n=this._webPushOptions,r=e||n.serviceWorkerUrl,o=n&&n.scope?{scope:n.scope}:null;return this._pushManager.register(r,o,function(e){return e?Promise.resolve(!0):t._pushManager.subscribeUser()})}return Promise.reject("Leanplum: WebPush is not supported.")},g.prototype.unregisterFromWebPush=function(){return this._pushManager.unsubscribeUser()},g.prototype.clearUserContent=function(){this._varCache.clearUserContent()},g.prototype.applyQueue=function(e){var t=this;e.forEach(function(e){return t[e.name].apply(t,e.args)})},g.prototype.createRequest=function(e,t,n){void 0===n&&(n={}),this._lpRequest.request(e,t,a({devMode:this._internalState.devMode},n))},g.prototype.connectSocket=function(){this._lpSocket.connect(this._varCache,{appId:this._lpRequest.appId,deviceId:this._lpRequest.deviceId},this.createRequest.bind(this),this._lpRequest.getLastResponse.bind(this._lpRequest))},g.prototype.hasActiveSession=function(){if(!this._sessionLength)return!1;var e=Date.now(),t=parseInt(f.default.getFromLocalStorage(v));return!isNaN(t)&&e-t<1e3*this._sessionLength},g.prototype.updateSession=function(){f.default.saveToLocalStorage(v,String(Date.now()))},g.prototype.trackMessage=function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=function(){});var r=(new s.default).add(u.default.PARAMS.MESSAGE_ID,e);t&&r.add(u.default.PARAMS.EVENT,t),this.createRequest(u.default.METHODS.TRACK,r,{queued:!1,sendNow:!0,response:n})},g.prototype.onAction=function(e){var t=this,n=this._messageCache||{};if(e&&"Chain to Existing Message"===e.__name__){var r=e["Chained message"],o=n[r];o&&this.trackMessage(r,"View",function(){return t.onAction(o.vars)})}else{var i=function(){"Open URL"===e.__name__&&t.wnd.location.assign(e.URL)},s=this.messageIdFromAction(e);s?this.trackMessage(s,null,i):i()}},g.prototype.messageIdFromAction=function(e){var t=this._messageCache||{},n=a({},e);delete n.parentCampaignId;for(var r=0,o=Object.keys(t);r<o.length;r++){var i=o[r],s=t[i];if(s.parentCampaignId===e.parentCampaignId&&h.default(s.vars,n))return i}},g);function g(e){this.wnd=e,this._internalState=new i.default,this._lpInbox=new c.default(this.createRequest.bind(this),this.onInboxAction.bind(this)),this._lpRequest=new l.default,this._lpSocket=new d.default,this._pushManager=new p.default(this.createRequest.bind(this)),this._varCache=new _.default(this.createRequest.bind(this)),this._browserDetector=new o.default(e)}t.default=S},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(o.prototype.searchString=function(e){for(var t=0;t<e.length;t++){var n=e[t].string,r=e[t].prop;if(this.versionSearchString=e[t].versionSearch||e[t].identity,n){if(-1!==n.indexOf(e[t].subString))return e[t].identity}else if(r)return e[t].identity}},o.prototype.searchVersion=function(e){if(e){var t=e.indexOf(this.versionSearchString);if(-1!==t)return parseFloat(e.substring(t+this.versionSearchString.length+1))}},o.prototype.getBrowserData=function(e){return[{string:e.navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:e.navigator.userAgent,subString:"OmniWeb",identity:"OmniWeb",versionSearch:"OmniWeb/"},{string:e.navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:e.opera,identity:"Opera",versionSearch:"Version"},{string:e.navigator.vendor,subString:"iCab",identity:"iCab"},{string:e.navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:e.navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:e.navigator.vendor,subString:"Camino",identity:"Camino"},{string:e.navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:e.navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:e.navigator.userAgent,subString:"Android",identity:"Android Browser",versionSearch:"Version"},{string:e.navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:e.navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}]},o.prototype.getOSData=function(e){return[{string:e.navigator.platform,subString:"Win",identity:"Windows"},{string:e.navigator.platform,subString:"Mac",identity:"Mac OS"},{string:e.navigator.userAgent,subString:"iPhone",identity:"iOS"},{string:e.navigator.userAgent,subString:"Android",identity:"Android"},{string:e.navigator.platform,subString:"Linux",identity:"Linux"}]},o);function o(e){this.browser=this.searchString(this.getBrowserData(e))||"Unknown Browser",this.version=this.searchVersion(e.navigator.userAgent)||this.searchVersion(e.navigator.appVersion)||"Unknown Version",this.OS=this.searchString(this.getOSData(e))||"Unknown OS"}t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(o.prototype.addStartResponseHandler=function(e){this.startHandlers.push(e),this.hasStarted&&e(this.startSuccessful)},o.prototype.removeStartResponseHandler=function(e){var t=this.startHandlers.indexOf(e);0<=t&&this.startHandlers.splice(t,1)},o.prototype.triggerStartHandlers=function(){for(var e=0;e<this.startHandlers.length;e++)this.startHandlers[e](this.startSuccessful)},o);function o(){this.startHandlers=[],this.devMode=!1,this.hasStarted=!1,this.startSuccessful=!1,this.variantDebugInfoEnabled=!1}t.default=r},function(e,t,n){"use strict";var p=this&&this.__assign||function(){return(p=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(n(1)),h=r(n(0)),i=(s.prototype.downloadMessages=function(){var n=this;this.createRequest("getNewsfeedMessages",void 0,{queued:!0,sendNow:!0,response:function(e){var t=e.response[0];t&&t.newsfeedMessages&&(n.messageMap=t.newsfeedMessages,n.triggerChangeHandlers())}})},s.prototype.markAsRead=function(e){var t=this.messageMap[e];if(t&&!t.isRead){t.isRead=!0,this.triggerChangeHandlers();var n=new o.default;n.add("newsfeedMessageId",e),this.createRequest("markNewsfeedMessageAsRead",n,{})}},s.prototype.read=function(e){this.markAsRead(e);var t=this.message(e),n=e.split("##")[0],r=(null==t?void 0:t.openAction())||null;this.onAction(n,r)},s.prototype.remove=function(e){if(this.messageMap[e]){delete this.messageMap[e],this.triggerChangeHandlers();var t=new o.default;t.add("newsfeedMessageId",e),this.createRequest("deleteNewsfeedMessage",t,{})}},s.prototype.onChanged=function(e){this.changeHandlers.push(e)},s.prototype.triggerChangeHandlers=function(){this.changeHandlers.forEach(function(e){return e()}),this.save()},s.prototype.save=function(){sessionStorage.setItem(h.default.DEFAULT_KEYS.INBOX_MESSAGES,JSON.stringify(this.messageMap))},s.prototype.load=function(){var e=sessionStorage.getItem(h.default.DEFAULT_KEYS.INBOX_MESSAGES);this.messageMap=JSON.parse(e)||{}},s.prototype.count=function(){return Object.values(this.messageMap).length},s.prototype.unreadCount=function(){return Object.values(this.messageMap).filter(function(e){return!e.isRead}).length},s.prototype.messages=function(e){var t=[];for(var n in this.messageMap){var r=this.messageMap[n];e(r)&&t.push(a.create(n,r))}return t},s.prototype.allMessages=function(){return this.messages(function(){return!0})},s.prototype.unreadMessages=function(){return this.messages(function(e){return!e.isRead})},s.prototype.messageIds=function(){return Object.keys(this.messageMap)},s.prototype.message=function(e){var t=this.messageMap[e];return t?a.create(e,t):null},s);function s(e,t){this.createRequest=e,this.onAction=t,this.messageMap={},this.changeHandlers=[],this.load()}t.default=i;var a=(_.create=function(e,t){var n,r,o,i,s,a,u,c,l,d=null===(n=t.messageData)||void 0===n?void 0:n.parentCampaignId,f=p(p({},null===(o=null===(r=t.messageData)||void 0===r?void 0:r.vars)||void 0===o?void 0:o[h.default.VALUES.DEFAULT_PUSH_ACTION]),{parentCampaignId:d});return new _(e,null===(s=null===(i=t.messageData)||void 0===i?void 0:i.vars)||void 0===s?void 0:s.Title,null===(u=null===(a=t.messageData)||void 0===a?void 0:a.vars)||void 0===u?void 0:u.Subtitle,t.deliveryTimestamp,t.isRead,null===(l=null===(c=t.messageData)||void 0===c?void 0:c.vars)||void 0===l?void 0:l.Image,f)},_.prototype.id=function(){return this._id},_.prototype.title=function(){return this._title},_.prototype.subtitle=function(){return this._subtitle},_.prototype.timestamp=function(){return this._timestamp},_.prototype.isRead=function(){return this._isRead},_.prototype.imageUrl=function(){return this._imageUrl},_.prototype.openAction=function(){return this._openAction},_);function _(e,t,n,r,o,i,s){this._id=e,this._title=t,this._subtitle=n,this._timestamp=r,this._isRead=o,this._imageUrl=i,this._openAction=s}t.LeanplumInboxMessage=a},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var h=r(n(1)),_=r(n(0)),o=r(n(2)),i=r(n(3)),s=(Object.defineProperty(a.prototype,"userId",{get:function(){var e,t;return null!==(t=null!==(e=this.userIdValue)&&void 0!==e?e:this.loadLocal(_.default.DEFAULT_KEYS.USER_ID))&&void 0!==t?t:this.deviceId},set:function(e){this.userIdValue=e},enumerable:!0,configurable:!0}),a.prototype.request=function(e,t,r){var o=this;if(void 0===r&&(r={}),r=r||{},t=t||new h.default,this.deviceId||(this.deviceId=this.loadLocal(_.default.DEFAULT_KEYS.DEVICE_ID)),!this.deviceId){for(var n="",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",s=0;s<16;s++)n+=i.charAt(Math.floor(Math.random()*i.length));this.deviceId=n,this.saveLocal(_.default.DEFAULT_KEYS.DEVICE_ID,n)}this.saveLocal(_.default.DEFAULT_KEYS.USER_ID,this.userId);var a=t.attachApiKeys(this.appId,this.clientKey).add(_.default.PARAMS.SDK_VERSION,_.default.SDK_VERSION).add(_.default.PARAMS.DEVICE_ID,this.deviceId).add(_.default.PARAMS.USER_ID,this.userId).add(_.default.PARAMS.ACTION,e).add(_.default.PARAMS.VERSION_NAME,this.versionName).add(_.default.PARAMS.DEV_MODE,r.devMode).add(_.default.PARAMS.TIME,((new Date).getTime()/1e3).toString()),u=r.success||r.response,c=r.error||r.response;if(!this.appId||!this.clientKey){var l="Leanplum App ID and client key are not set. Make sure you are calling setAppIdForDevelopmentMode or setAppIdForProductionMode before issuing API calls.";return console.error(l),void(c&&c(l))}if(t.body())this.network.ajax("POST",this.apiPath+"?"+a.build(),t.body(),u,c,r.queued);else{var d=r.devMode||r.sendNow||!this.batchEnabled,f=function(){var e=o.popUnsentRequests();if(0<e.length){var t=JSON.stringify({data:e}),n=(new h.default).attachApiKeys(o.appId,o.clientKey).add(_.default.PARAMS.SDK_VERSION,_.default.SDK_VERSION).add(_.default.PARAMS.ACTION,_.default.METHODS.MULTI).add(_.default.PARAMS.TIME,((new Date).getTime()/1e3).toString().toString()).build();o.network.ajax("POST",o.apiPath+"?"+n,t,u,c,r.queued)}};if(!d&&this.batchCooldown){var p=(new Date).getTime()/1e3;!this.lastRequestTime||p-this.lastRequestTime>=this.batchCooldown?(d=!0,this.lastRequestTime=p):this.cooldownTimeout||(this.cooldownTimeout=setTimeout(function(){o.cooldownTimeout=null,o.lastRequestTime=(new Date).getTime()/1e3,f()},1e3*(this.batchCooldown-(p-this.lastRequestTime))))}this.saveRequestForLater(a.buildDict()),d&&f()}},a.prototype.setNetworkTimeout=function(e){this.network.setNetworkTimeout(e)},a.prototype.getLastResponse=function(e){var t,n,r,o=null!==(n=null===(t=null==e?void 0:e.response)||void 0===t?void 0:t.length)&&void 0!==n?n:0;return 0<o?null===(r=null==e?void 0:e.response)||void 0===r?void 0:r[o-1]:null},a.prototype.isResponseSuccess=function(e){return Boolean(null==e?void 0:e.success)},a.prototype.saveRequestForLater=function(e){var t=this.loadLocal(_.default.DEFAULT_KEYS.COUNT)||0,n=_.default.DEFAULT_KEYS.ITEM+t;this.saveLocal(n,JSON.stringify(e)),t++,this.saveLocal(_.default.DEFAULT_KEYS.COUNT,t)},a.prototype.popUnsentRequests=function(){var e=[],t=this.loadLocal(_.default.DEFAULT_KEYS.COUNT)||0;this.removeLocal(_.default.DEFAULT_KEYS.COUNT);for(var n=0;n<t;n++){var r=_.default.DEFAULT_KEYS.ITEM+n;try{e.push(JSON.parse(this.loadLocal(r)))}catch(e){}this.removeLocal(r)}return e},a.prototype.loadLocal=function(e){return o.default.getFromLocalStorage(e)},a.prototype.saveLocal=function(e,t){o.default.saveToLocalStorage(e,t)},a.prototype.removeLocal=function(e){o.default.removeFromLocalStorage(e)},a);function a(){this.cooldownTimeout=null,this.lastRequestTime=void 0,this.network=new i.default,this.userIdValue=void 0,this.apiPath="https://api.leanplum.com/api",this.batchCooldown=5,this.batchEnabled=!0}t.default=s},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var a=r(n(4)),u=r(n(1)),c=r(n(0)),l=r(n(15)),o=(i.prototype.connect=function(i,t,r,s){var o=this;if(WebSocket){var n=!1;this.socketClient=new l.default,this.socketClient.setNetworkTimeout(this.networkTimeoutSeconds),this.socketClient.onopen=function(){var e;n||(console.log("Leanplum: Connected to development server."),o.socketClient.send("auth",((e={})[c.default.PARAMS.APP_ID]=t.appId,e[c.default.PARAMS.DEVICE_ID]=t.deviceId,e)),n=!0)},this.socketClient.onerror=function(e){console.log("Leanplum: Socket error",e)},this.socketClient.onmessage=function(e,t){if("updateVars"===e){var n=(new u.default).add(c.default.PARAMS.INCLUDE_DEFAULTS,!1);r(c.default.METHODS.GET_VARS,n,{queued:!1,sendNow:!0,response:function(e){var t=s(e),n=t[c.default.KEYS.VARS],r=t[c.default.KEYS.VARIANTS],o=t[c.default.KEYS.ACTION_METADATA];a.default(n,i.diffs)||i.applyDiffs(n,r,o)}})}else"getVariables"===e?(i.sendVariables(),o.socketClient.send("getContentResponse",{updated:!0})):"getActions"===e?o.socketClient.send("getContentResponse",{updated:!1}):"registerDevice"===e&&alert("Your device has been registered to "+t[0].email+".")},this.socketClient.onclose=function(){console.log("Leanplum: Disconnected from development server."),n=!1},this.socketClient.connect(this.socketHost),setInterval(function(){o.socketClient.connected||o.socketClient.connecting||o.socketClient.connect(o.socketHost)},5e3)}else console.log("Your browser doesn't support WebSockets.")},i.prototype.setSocketHost=function(e){this.socketHost=e},i.prototype.setNetworkTimeout=function(e){var t;this.networkTimeoutSeconds=e,null!==(t=this.socketClient)&&void 0!==t&&t.setNetworkTimeout(e)},i);function i(){this.networkTimeoutSeconds=10,this.socketClient=null,this.socketHost="dev.leanplum.com"}t.default=o},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(n(3)),i=(s.prototype.connect=function(i){var a=this;this.connecting=!0,this.network.ajax("POST","https://"+i+"/socket.io/1","",function(e){var t=e.split(":"),n=t[0],r=parseInt(t[1])/2*1e3;a.socket=new WebSocket("wss://"+i+"/socket.io/1/websocket/"+n);var o=null;a.socket.onopen=function(){a.connected=!0,a.connecting=!1,a.onopen&&a.onopen(),o=setInterval(function(){a.socket.send("2:::")},r)},a.socket.onclose=function(){a.connected=!1,clearInterval(o),a.onclose&&a.onclose()},a.socket.onmessage=function(e){var t=e.data.split(":"),n=parseInt(t[0]);if(2===n)a.socket.send("2::");else if(5===n){var r=t[1],o=JSON.parse(t.slice(3).join(":")),i=o.name,s=o.args;r&&a.socket.send("6:::"+r),a.onmessage&&a.onmessage(i,s)}else 7===n&&console.log("Socket error: "+e.data)},a.socket.onerror=function(e){a.socket.close(),a.onerror&&a.onerror(e)}},null,!1,!0)},s.prototype.send=function(e,t){if(this.connected){var n=JSON.stringify({name:e,args:t});this.socket.send("5:::"+n)}else console.log("Leanplum: Socket is not connected.")},s.prototype.setNetworkTimeout=function(e){this.network.setNetworkTimeout(e)},s);function s(){this.network=new o.default,this.connected=!1,this.connecting=!1,this.connected=!1,this.connecting=!1}t.default=i},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,s,a,u){return new(a=a||Promise)(function(n,t){function r(e){try{i(u.next(e))}catch(e){t(e)}}function o(e){try{i(u.throw(e))}catch(e){t(e)}}function i(e){var t;e.done?n(e.value):((t=e.value)instanceof a?t:new a(function(e){e(t)})).then(r,o)}i((u=u.apply(e,s||[])).next())})},u=this&&this.__generator||function(n,r){var o,i,s,e,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(o)throw new TypeError("Generator is already executing.");for(;a;)try{if(o=1,i&&(s=2&t[0]?i.return:t[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,t[1])).done)return s;switch(i=0,s&&(t=[2&t[0],s.value]),t[0]){case 0:case 1:s=t;break;case 4:return a.label++,{value:t[1],done:!1};case 5:a.label++,i=t[1],t=[0];continue;case 7:t=a.ops.pop(),a.trys.pop();continue;default:if(!(s=0<(s=a.trys).length&&s[s.length-1])&&(6===t[0]||2===t[0])){a=0;continue}if(3===t[0]&&(!s||t[1]>s[0]&&t[1]<s[3])){a.label=t[1];break}if(6===t[0]&&a.label<s[1]){a.label=s[1],s=t;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(t);break}s[2]&&a.ops.pop(),a.trys.pop();continue}t=r.call(n,a)}catch(e){t=[6,e],i=0}finally{o=s=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var i=o(n(1)),s=o(n(0)),a=o(n(2)),c=(Object.defineProperty(l.prototype,"serviceWorker",{get:function(){return window.navigator.serviceWorker},enumerable:!0,configurable:!0}),l.prototype.isWebPushSupported=function(){return Boolean(void 0!==(null===window||void 0===window?void 0:window.navigator)&&"serviceWorker"in window.navigator&&"PushManager"in window)},l.prototype.isWebPushSubscribed=function(){return r(this,void 0,void 0,function(){var t,n,r;return u(this,function(e){switch(e.label){case 0:return this.isWebPushSupported()?[4,this.getServiceWorkerRegistration()]:[2,!1];case 1:return(t=e.sent())?[4,t.pushManager.getSubscription()]:[2,!1];case 2:return n=e.sent(),(r=null!==n)&&this.updateNewSubscriptionOnServer(n),[2,r]}})})},l.prototype.register=function(i,s,a){return r(this,void 0,void 0,function(){var t,n,r,o;return u(this,function(e){switch(e.label){case 0:if(!this.isWebPushSupported())return console.log("Leanplum: Push messaging is not supported."),[2,a(!1)];e.label=1;case 1:return e.trys.push([1,4,,5]),[4,(t=this).serviceWorker.register(i||"/sw.min.js",s)];case 2:return t.serviceWorkerRegistration=e.sent(),[4,this.serviceWorkerRegistration.pushManager.getSubscription()];case 3:return n=e.sent(),(r=null!==n)&&this.updateNewSubscriptionOnServer(n),[2,a(r)];case 4:return o=e.sent(),console.log("Leanplum: Service Worker Error: ",o),[2,a(!1)];case 5:return[2]}})})},l.prototype.subscribeUser=function(){return r(this,void 0,void 0,function(){var t,n,r;return u(this,function(e){switch(e.label){case 0:t=this.urlB64ToUint8Array("BInWPpWntfR39rgXSP04pqdmEdDGa50z6zqbMvxyxJCwzXIuSpSh8C888-CfJ82WELl7Xe8cjAnfCt-3vK0Ci68"),e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this.serviceWorkerRegistration.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:t})];case 2:if(!(n=e.sent()))throw new Error;return this.updateNewSubscriptionOnServer(n),[3,4];case 3:throw r=e.sent(),new Error("Leanplum: Failed to subscribe the user: "+r);case 4:return[2,!0]}})})},l.prototype.unsubscribeUser=function(){return r(this,void 0,void 0,function(){var t,n;return u(this,function(e){switch(e.label){case 0:return[4,this.isWebPushSubscribed()];case 1:if(!e.sent())return[3,6];e.label=2;case 2:return e.trys.push([2,5,,6]),[4,this.serviceWorkerRegistration.pushManager.getSubscription()];case 3:if(!(t=e.sent()))throw new Error;return[4,t.unsubscribe()];case 4:return e.sent(),[3,6];case 5:throw n=e.sent(),new Error("Leanplum: Error unsubscribing: "+n);case 6:return[2]}})})},l.prototype.getServiceWorkerRegistration=function(){return r(this,void 0,void 0,function(){var t;return u(this,function(e){switch(e.label){case 0:return this.serviceWorkerRegistration?[3,2]:[4,(t=this).serviceWorker.getRegistration()];case 1:t.serviceWorkerRegistration=e.sent(),e.label=2;case 2:return[2,this.serviceWorkerRegistration]}})})},l.prototype.urlB64ToUint8Array=function(e){for(var t=(e+"=".repeat((4-e.length%4)%4)).replace(/-/g,"+").replace(/_/g,"/"),n=this.decodeData(t),r=new Uint8Array(n.length),o=0;o<n.length;++o)r[o]=n.charCodeAt(o);return r},l.prototype.updateNewSubscriptionOnServer=function(e){if(e){var t=this.prepareSubscription(e),n=JSON.stringify(t);a.default.getFromLocalStorage(s.default.DEFAULT_KEYS.PUSH_SUBSCRIPTION)!==n&&(a.default.saveToLocalStorage(s.default.DEFAULT_KEYS.PUSH_SUBSCRIPTION,n),this.setSubscription(n))}},l.prototype.prepareSubscription=function(e){var t="getKey"in e?e.getKey("p256dh"):[],n="getKey"in e?e.getKey("auth"):[],r=this.encodeData(String.fromCharCode.apply(null,new Uint8Array(t))),o=this.encodeData(String.fromCharCode.apply(null,new Uint8Array(n)));return{endpoint:e.endpoint,key:r,auth:o}},l.prototype.setSubscription=function(e){if(e){var t=(new i.default).add(s.default.PARAMS.WEB_PUSH_SUBSCRIPTION,e);this.createRequest(s.default.METHODS.SET_DEVICE_ATTRIBUTES,t,{queued:!1,sendNow:!0})}},l.prototype.encodeData=function(e){return window.btoa(e)},l.prototype.decodeData=function(e){return window.atob(e)},l);function l(e){this.createRequest=e,this.serviceWorkerRegistration=null}t.default=c},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(n(1)),i=r(n(0)),s=r(n(2)),a=(u.prototype.applyDiffs=function(e,t,n){this.diffs=e,this.variants=t,this.actionMetadata=n,this.hasReceivedDiffs=!0,this.merged=function r(t,o){if("number"==typeof o||"boolean"==typeof o||"string"==typeof o)return o;if(null==o)return t;var e=function(r){return function(e){if(r instanceof Array)for(var t=0;t<r.length;t++)e(r[t]);else for(var n in r)!{}.hasOwnProperty.call(r,n)||e(n)}},n=e(t),i=e(o),s=!1;if(null===t&&!(o instanceof Array))for(var a in s=null,o)if(o.hasOwnProperty(a)){if(null===s&&(s=!0),"string"!=typeof a){s=!1;break}if(a.length<3||"["!==a.charAt(0)||"]"!==a.charAt(a.length-1)){s=!1;break}}if(t instanceof Array||s){var u=[];return n(function(e){u.push(e)}),i(function(e){for(var t=parseInt(e.substring(1,e.length-1)),n=o[e];t>=u.length;)u.push(null);u[t]=r(u[t],n)}),u}var c={};return n(function(e){null!==o[e]&&void 0!==o[e]||(c[e]=t[e])}),i(function(e){c[e]=r(null===t?null:t[e]||{},o[e])}),c}(this.variables,e),this.saveDiffs(),this.onUpdate&&this.onUpdate()},u.prototype.loadDiffs=function(){try{this.applyDiffs(JSON.parse(this.loadLocal(i.default.DEFAULT_KEYS.VARIABLES)||null),JSON.parse(this.loadLocal(i.default.DEFAULT_KEYS.VARIANTS)||null),JSON.parse(this.loadLocal(i.default.DEFAULT_KEYS.ACTION_METADATA)||null)),this.token=this.loadLocal(i.default.DEFAULT_KEYS.TOKEN),this.variantDebugInfo=this.loadLocal(i.default.DEFAULT_KEYS.VARIANT_DEBUG_INFO)}catch(e){console.log("Leanplum: Invalid diffs: "+e)}},u.prototype.saveDiffs=function(){this.saveLocal(i.default.DEFAULT_KEYS.VARIABLES,JSON.stringify(this.diffs||{})),this.saveLocal(i.default.DEFAULT_KEYS.VARIANTS,JSON.stringify(this.variants||[])),this.saveLocal(i.default.DEFAULT_KEYS.ACTION_METADATA,JSON.stringify(this.actionMetadata||{})),this.saveLocal(i.default.DEFAULT_KEYS.VARIANT_DEBUG_INFO,JSON.stringify(this.variantDebugInfo||{})),this.saveLocal(i.default.DEFAULT_KEYS.TOKEN,this.token)},u.prototype.getVariable=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=this.getVariables();if(n)for(var r=0;r<e.length;r++)n=n[e[r]];return n},u.prototype.getVariables=function(){return void 0!==this.merged?this.merged:this.variables},u.prototype.setVariables=function(e){this.variables=e},u.prototype.addVariablesChangedHandler=function(e){this.variablesChangedHandlers.push(e),this.hasReceivedDiffs&&e()},u.prototype.removeVariablesChangedHandler=function(e){var t=this.variablesChangedHandlers.indexOf(e);0<=t&&this.variablesChangedHandlers.splice(t,1)},u.prototype.triggerVariablesChangedHandlers=function(){for(var e=0;e<this.variablesChangedHandlers.length;e++)this.variablesChangedHandlers[e]()},u.prototype.getVariantDebugInfo=function(){return this.variantDebugInfo},u.prototype.setVariantDebugInfo=function(e){this.variantDebugInfo=e},u.prototype.sendVariables=function(){var e,t=((e={})[i.default.PARAMS.VARIABLES]=this.variables,e),n=(new o.default).body(JSON.stringify(t));this.createRequest(i.default.METHODS.SET_VARS,n,{sendNow:!0})},u.prototype.clearUserContent=function(){this.diffs=void 0,this.variables=null,this.variants=[],this.variantDebugInfo={},this.merged=void 0},u.prototype.loadLocal=function(e){return s.default.getFromLocalStorage(e)},u.prototype.saveLocal=function(e,t){s.default.saveToLocalStorage(e,t)},u);function u(e){this.createRequest=e,this.actionMetadata={},this.hasReceivedDiffs=!1,this.merged=void 0,this.variables=null,this.variablesChangedHandlers=[],this.variantDebugInfo={},this.diffs=void 0,this.token="",this.variants=[]}t.default=a}],o.c=r,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)o.d(n,r,function(e){return t[e]}.bind(null,r));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=5);function o(e){if(r[e])return r[e].exports;var t=r[e]={i:e,l:!1,exports:{}};return n[e].call(t.exports,t,t.exports,o),t.l=!0,t.exports}var n,r});