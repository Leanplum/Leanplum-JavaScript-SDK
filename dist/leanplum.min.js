!function(a,b){"object"==typeof exports&&"object"==typeof module?module.exports=b():"function"==typeof define&&define.amd?define([],b):"object"==typeof exports?exports.Leanplum=b():a.Leanplum=b()}(this,function(){return function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={i:d,l:!1,exports:{}};return a[d].call(e.exports,e,e.exports,b),e.l=!0,e.exports}var c={};return b.m=a,b.c=c,b.i=function(a){return a},b.d=function(a,c,d){b.o(a,c)||Object.defineProperty(a,c,{configurable:!1,enumerable:!0,get:d})},b.n=function(a){var c=a&&a.__esModule?function(){return a.default}:function(){return a};return b.d(c,"a",c),c},b.o=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)},b.p="",b(b.s=35)}([function(a,b,c){var d=c(21),e="object"==typeof self&&self&&self.Object===Object&&self,f=d||e||Function("return this")();a.exports=f},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.default=void 0;var d={METHODS:{START:"start",STOP:"stop",ADVANCE:"advance",TRACK:"track",PAUSE_SESSION:"pauseSession",RESUME_SESSION:"resumeSession",PAUSE_STATE:"pauseState",RESUME_STATE:"resumeState",DOWNLOAD_FILE:"downloadFile",MULTI:"multi",SET_VARS:"setVars",GET_VARS:"getVars",SET_USER_ATTRIBUTES:"setUserAttributes",SET_DEVICE_ATTRIBUTES:"setDeviceAttributes",UPLOAD_FILE:"uploadFile",REGISTER_DEVICE:"registerDevice"},SDK_VERSION:"1.7.2-iflix",CLIENT:"js",PARAMS:{ACTION:"action",APP_ID:"appId",CLIENT:"client",CLIENT_KEY:"clientKey",DEVICE_ID:"deviceId",SDK_VERSION:"sdkVersion",USER_ID:"userId",NEW_USER_ID:"newUserId",DEV_MODE:"devMode",VERSION_NAME:"versionName",SYSTEM_NAME:"systemName",SYSTEM_VERSION:"systemVersion",BROWSER_NAME:"browserName",BROWSER_VERSION:"browserVersion",DEVICE_NAME:"deviceName",DEVICE_MODEL:"deviceModel",USER_ATTRIBUTES:"userAttributes",LOCALE:"locale",COUNTRY:"country",REGION:"region",CITY:"city",LOCATION:"location",STATE:"state",INFO:"info",EVENT:"event",VALUE:"value",FILENAME:"filename",TIME:"time",DATA:"data",VARS:"vars",FILE:"file",SIZE:"size",VARIATION:"variation",HASH:"hash",EMAIL:"email",VARIABLES:"vars",PARAMS:"params",INCLUDE_DEFAULTS:"includeDefaults",INCLUDE_VARIANT_DEBUG_INFO:"includeVariantDebugInfo",WEB_PUSH_SUBSCRIPTION:"webPushSubscription",MESSAGE_ID:"messageId"},KEYS:{IS_REGISTERED:"isRegistered",LATEST_VERSION:"latestVersion",VARS:"vars",VARIANTS:"variants",VARIANT_DEBUG_INFO:"variantDebugInfo",ACTION_METADATA:"actionMetadata",TOKEN:"token",MESSAGES:"messages"},DEFAULT_KEYS:{COUNT:"__leanplum_unsynced",ITEM:"__leanplum_unsynced_",VARIABLES:"__leanplum_variables",VARIANTS:"__leanplum_variants",VARIANT_DEBUG_INFO:"__leanplum_variant_debug_info",ACTION_METADATA:"__leanplum_action_metadata",TOKEN:"__leanplum_token",DEVICE_ID:"__leanplum_device_id",USER_ID:"__leanplum_user_id",PUSH_SUBSCRIPTION:"__leanplum_push_subscription",MESSAGE_VIEW:"__leanplum_messages_view"},VALUES:{DETECT:"(detect)"}};b.default=d,a.exports=b.default},function(a,b,c){function d(a,b){var c=f(a,b);return e(c)?c:void 0}var e=c(53),f=c(66);a.exports=d},function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}function f(a,b,c){return b&&e(a.prototype,b),c&&e(a,c),a}Object.defineProperty(b,"__esModule",{value:!0}),b.default=void 0;var g=function(a){return a&&a.__esModule?a:{default:a}}(c(1)),h=function(){function a(){d(this,a),this.argString="",this.argValues={}}return f(a,[{key:"add",value:function(a,b){if(void 0===b)return this;this.argString&&(this.argString+="&");var c=encodeURIComponent(b);return this.argString+="".concat(a,"=").concat(c),this.argValues[a]=b,this}},{key:"body",value:function(a){return a?(this._body=a,this):this._body}},{key:"attachApiKeys",value:function(a,b){return this.add(g.default.PARAMS.APP_ID,a).add(g.default.PARAMS.CLIENT,g.default.CLIENT).add(g.default.PARAMS.CLIENT_KEY,b)}},{key:"build",value:function(){return this.argString}},{key:"buildDict",value:function(){return this.argValues}}]),a}();b.default=h,a.exports=b.default},function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}function g(a,b,c){return b&&f(a.prototype,b),c&&f(a,c),a}function h(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}Object.defineProperty(b,"__esModule",{value:!0}),b.default=void 0;var i=d(c(1)),j=d(c(3)),k=d(c(12)),l=d(c(18)),m=d(c(5)),n=void 0,o=null,p=function(){function a(){e(this,a)}return g(a,null,[{key:"request",value:function(b,c,d){if(d=d||{},c=c||new j.default,a.deviceId||(a.deviceId=m.default.getFromLocalStorage(i.default.DEFAULT_KEYS.DEVICE_ID)),!a.deviceId){for(var e="",f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",g=0;g<16;g++)e+=f.charAt(Math.floor(Math.random()*f.length));a.deviceId=e,m.default.saveToLocalStorage(i.default.DEFAULT_KEYS.DEVICE_ID,e)}a.userId||(a.userId=m.default.getFromLocalStorage(i.default.DEFAULT_KEYS.USER_ID),a.userId||(a.userId=a.deviceId)),m.default.saveToLocalStorage(i.default.DEFAULT_KEYS.USER_ID,a.userId);var h=c.attachApiKeys(a.appId,a.clientKey).add(i.default.PARAMS.SDK_VERSION,i.default.SDK_VERSION).add(i.default.PARAMS.DEVICE_ID,a.deviceId).add(i.default.PARAMS.USER_ID,a.userId).add(i.default.PARAMS.ACTION,b).add(i.default.PARAMS.VERSION_NAME,a.versionName).add(i.default.PARAMS.DEV_MODE,k.default.devMode).add(i.default.PARAMS.TIME,((new Date).getTime()/1e3).toString()),p=d.success||d.response,q=d.error||d.response;if(!a.appId||!a.clientKey){var r="Leanplum App ID and client key are not set. Make sure you are calling setAppIdForDevelopmentMode or setAppIdForProductionMode before issuing API calls.";return console.error(r),void(q&&q(r))}if(c.body())return void l.default.ajax("POST","".concat(a.apiPath,"?").concat(h.build()),c.body(),p,q,d.queued);var s=k.default.devMode||d.sendNow||!a.batchEnabled,t=function(){var b=a.popUnsentRequests();if(b.length>0){var c=JSON.stringify({data:b}),e=(new j.default).attachApiKeys(a.appId,a.clientKey).add(i.default.PARAMS.SDK_VERSION,i.default.SDK_VERSION).add(i.default.PARAMS.ACTION,i.default.METHODS.MULTI).add(i.default.PARAMS.TIME,((new Date).getTime()/1e3).toString().toString()).build();l.default.ajax("POST","".concat(a.apiPath,"?").concat(e),c,p,q,d.queued)}};if(!s&&a.batchCooldown){var u=(new Date).getTime()/1e3;!n||u-n>=a.batchCooldown?(s=!0,n=u):o||(o=setTimeout(function(){o=null,n=(new Date).getTime()/1e3,t()},1e3*(a.batchCooldown-(u-n))))}a.saveRequestForLater(h.buildDict()),s&&t()}},{key:"generateRequestUrl",value:function(b,c){if(c=c||new j.default,a.deviceId||(a.deviceId=m.default.getFromLocalStorage(i.default.DEFAULT_KEYS.DEVICE_ID)),!a.deviceId){for(var d="",e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",f=0;f<16;f++)d+=e.charAt(Math.floor(Math.random()*e.length));a.deviceId=d,m.default.saveToLocalStorage(i.default.DEFAULT_KEYS.DEVICE_ID,d)}a.userId||(a.userId=m.default.getFromLocalStorage(i.default.DEFAULT_KEYS.USER_ID),a.userId||(a.userId=a.deviceId)),m.default.saveToLocalStorage(i.default.DEFAULT_KEYS.USER_ID,a.userId);var g=c.attachApiKeys(a.appId,a.clientKey).add(i.default.PARAMS.SDK_VERSION,i.default.SDK_VERSION).add(i.default.PARAMS.DEVICE_ID,a.deviceId).add(i.default.PARAMS.USER_ID,a.userId).add(i.default.PARAMS.ACTION,b).add(i.default.PARAMS.VERSION_NAME,a.versionName).add(i.default.PARAMS.DEV_MODE,k.default.devMode).add(i.default.PARAMS.TIME,((new Date).getTime()/1e3).toString());if(!a.appId||!a.clientKey){var h="Leanplum App ID and client key are not set. Make sure you are calling setAppIdForDevelopmentMode or setAppIdForProductionMode before issuing API calls.";throw console.error(h),new Error(h)}return"".concat(a.apiPath,"?").concat(g.build())}},{key:"setNetworkTimeout",value:function(a){l.default.setNetworkTimeout(a)}},{key:"saveRequestForLater",value:function(a){var b=m.default.getFromLocalStorage(i.default.DEFAULT_KEYS.COUNT)||0,c=i.default.DEFAULT_KEYS.ITEM+b;m.default.saveToLocalStorage(c,JSON.stringify(a)),b++,m.default.saveToLocalStorage(i.default.DEFAULT_KEYS.COUNT,b)}},{key:"popUnsentRequests",value:function(){var a=[],b=m.default.getFromLocalStorage(i.default.DEFAULT_KEYS.COUNT)||0;m.default.removeFromLocalStorage(i.default.DEFAULT_KEYS.COUNT);for(var c=0;c<b;c++){var d=i.default.DEFAULT_KEYS.ITEM+c;try{var e=JSON.parse(m.default.getFromLocalStorage(d));a.push(e)}catch(a){}m.default.removeFromLocalStorage(d)}return a}},{key:"numResponses",value:function(a){return a&&a.response?a.response.length:0}},{key:"getResponseAt",value:function(a,b){return a&&a.response?a.response[b]:null}},{key:"getLastResponse",value:function(b){var c=a.numResponses(b);return c>0?a.getResponseAt(b,c-1):null}},{key:"isResponseSuccess",value:function(a){return!!a&&!!a.success}},{key:"getResponseError",value:function(a){if(!a)return null;var b=a.error;return b?b.message:null}}]),a}();b.default=p,h(p,"apiPath","https://www.leanplum.com/api"),h(p,"batchEnabled",!0),h(p,"batchCooldown",5),a.exports=b.default},function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}function f(a,b,c){return b&&e(a.prototype,b),c&&e(a,c),a}Object.defineProperty(b,"__esModule",{value:!0}),b.default=void 0;var g,h={},i=function(){function a(){d(this,a)}return f(a,null,[{key:"getFromLocalStorage",value:function(a){return!1===g?h[a]:localStorage[a]}},{key:"saveToLocalStorage",value:function(a,b){if(!1===g)return void(h[a]=b);try{localStorage[a]=b}catch(c){g=!1,h[a]=b}}},{key:"removeFromLocalStorage",value:function(a){if(!1===g)return void delete h[a];try{localStorage.removeItem(a)}catch(b){g=!1,delete h[a]}}}]),a}();b.default=i,a.exports=b.default},function(a,b,c){function d(a){var b=-1,c=null==a?0:a.length;for(this.clear();++b<c;){var d=a[b];this.set(d[0],d[1])}}var e=c(76),f=c(77),g=c(78),h=c(79),i=c(80);d.prototype.clear=e,d.prototype.delete=f,d.prototype.get=g,d.prototype.has=h,d.prototype.set=i,a.exports=d},function(a,b,c){function d(a,b){for(var c=a.length;c--;)if(e(a[c][0],b))return c;return-1}var e=c(23);a.exports=d},function(a,b,c){function d(a){return null==a?void 0===a?i:h:j&&j in Object(a)?f(a):g(a)}var e=c(15),f=c(63),g=c(89),h="[object Null]",i="[object Undefined]",j=e?e.toStringTag:void 0;a.exports=d},function(a,b,c){function d(a,b){var c=a.__data__;return e(b)?c["string"==typeof b?"string":"hash"]:c.map}var e=c(73);a.exports=d},function(a,b,c){var d=c(2),e=d(Object,"create");a.exports=e},function(a,b){function c(a){return null!=a&&"object"==typeof a}a.exports=c},function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}function f(a,b,c){return b&&e(a.prototype,b),c&&e(a,c),a}function g(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}Object.defineProperty(b,"__esModule",{value:!0}),b.default=void 0;var h=function(){function a(){d(this,a)}return f(a,null,[{key:"addStartResponseHandler",value:function(b){a.startHandlers.push(b),a.hasStarted&&b(a.startSuccessful)}},{key:"removeStartResponseHandler",value:function(b){var c=a.startHandlers.indexOf(b);c>=0&&a.startHandlers.splice(c,1)}},{key:"triggerStartHandlers",value:function(){for(var b=0;b<a.startHandlers.length;b++)a.startHandlers[b](a.startSuccessful)}},{key:"addVariablesChangedHandler",value:function(b){a.variablesChangedHandlers.push(b),a.hasReceivedDiffs&&b()}},{key:"removeVariablesChangedHandler",value:function(b){var c=a.variablesChangedHandlers.indexOf(b);c>=0&&a.variablesChangedHandlers.splice(c,1)}},{key:"triggerVariablesChangedHandlers",value:function(){for(var b=0;b<a.variablesChangedHandlers.length;b++)a.variablesChangedHandlers[b]()}},{key:"setVariantDebugInfoEnabled",value:function(b){a.variantDebugInfoEnabled=b}}]),a}();b.default=h,g(h,"devMode",!1),g(h,"variablesChangedHandlers",[]),g(h,"hasReceivedDiffs",!1),g(h,"startHandlers",[]),g(h,"hasStarted",!1),g(h,"startSuccessful",!1),g(h,"variantDebugInfoEnabled",!1),a.exports=b.default},function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}function g(a,b,c){return b&&f(a.prototype,b),c&&f(a,c),a}function h(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}Object.defineProperty(b,"__esModule",{value:!0}),b.default=void 0;var i=d(c(1)),j=d(c(12)),k=d(c(3)),l=d(c(5)),m=d(c(4)),n=function(){function a(){e(this,a)}return g(a,null,[{key:"applyDiffs",value:function(b,c,d){a.diffs=b,a.variants=c,a.actionMetadata=d,j.default.hasReceivedDiffs=!0,a.merged=a.mergeHelper(a.variables,b),a.saveDiffs(),a.onUpdate&&a.onUpdate()}},{key:"loadDiffs",value:function(){try{a.applyDiffs(JSON.parse(l.default.getFromLocalStorage(i.default.DEFAULT_KEYS.VARIABLES)||null),JSON.parse(l.default.getFromLocalStorage(i.default.DEFAULT_KEYS.VARIANTS)||null),JSON.parse(l.default.getFromLocalStorage(i.default.DEFAULT_KEYS.ACTION_METADATA)||null)),a.token=l.default.getFromLocalStorage(i.default.DEFAULT_KEYS.TOKEN),a.variantDebugInfo=l.default.getFromLocalStorage(i.default.DEFAULT_KEYS.VARIANT_DEBUG_INFO)}catch(a){console.log("Leanplum: Invalid diffs: ".concat(a))}}},{key:"saveDiffs",value:function(){l.default.saveToLocalStorage(i.default.DEFAULT_KEYS.VARIABLES,JSON.stringify(a.diffs||{})),l.default.saveToLocalStorage(i.default.DEFAULT_KEYS.VARIANTS,JSON.stringify(a.variants||[])),l.default.saveToLocalStorage(i.default.DEFAULT_KEYS.ACTION_METADATA,JSON.stringify(a.actionMetadata||{})),l.default.saveToLocalStorage(i.default.DEFAULT_KEYS.VARIANT_DEBUG_INFO,JSON.stringify(a.variantDebugInfo||{})),l.default.saveToLocalStorage(i.default.DEFAULT_KEYS.TOKEN,a.token)}},{key:"addMessageView",value:function(b){void 0===a.getMessagesView()[b]&&(a.messagesView[b]=[]);var c=a.messagesViewPerSession[b]||[],d=Date.now();c.push({t:d}),a.messagesView[b].push({t:d}),l.default.saveToLocalStorage(i.default.DEFAULT_KEYS.MESSAGE_VIEW,JSON.stringify(a.messagesView||{}))}},{key:"getMessagesView",value:function(b){return b?a.messagesViewPerSession:(void 0===a.messagesView&&(a.messagesView=JSON.parse(l.default.getFromLocalStorage(i.default.DEFAULT_KEYS.MESSAGE_VIEW)||"{}")),a.messagesView)}},{key:"getMessageView",value:function(b,c){return a.getMessagesView(c)[b]||[]}},{key:"setVariables",value:function(b){a.variables=b}},{key:"getVariables",value:function(){return void 0!==a.merged?a.merged:a.variables}},{key:"getVariantDebugInfo",value:function(){return a.variantDebugInfo}},{key:"sendVariables",value:function(){var b={};b[i.default.PARAMS.VARIABLES]=a.variables,m.default.request(i.default.METHODS.SET_VARS,(new k.default).body(JSON.stringify(b)),{sendNow:!0})}},{key:"mergeHelper",value:function(b,c){if("number"==typeof c||"boolean"==typeof c||"string"==typeof c)return c;if(null===c||void 0===c)return b;var d=function(a){return function(b){if(a instanceof Array)for(var c=0;c<a.length;c++)b(a[c]);else for(var d in a)({}).hasOwnProperty.call(a,d)&&b(d)}},e=d(b),f=d(c),g=!1;if(null===b&&!(c instanceof Array)){g=null;for(var h in c)if(c.hasOwnProperty(h)){if(null===g&&(g=!0),"string"!=typeof h){g=!1;break}if(h.length<3||"["!==h.charAt(0)||"]"!==h.charAt(h.length-1)){g=!1;break}var i=h.substring(1,h.length-1);if(!parseInt(i).toString()===i){g=!1;break}}}if(b instanceof Array||g){var j=[];return e(function(a){j.push(a)}),f(function(b){for(var d=parseInt(b.substring(1,b.length-1)),e=c[b];d>=j.length;)j.push(null);j[d]=a.mergeHelper(j[d],e)}),j}var k={};return e(function(a){null!==c[a]&&void 0!==c[a]||(k[a]=b[a])}),f(function(d){k[d]=a.mergeHelper(null!==b?b[d]:null,c[d])}),k}},{key:"clearUserContent",value:function(){a.diffs=void 0,a.variables=null,a.variants=[],a.variantDebugInfo={},a.merged=void 0}}]),a}();b.default=n,h(n,"diffs",void 0),h(n,"variables",null),h(n,"variants",[]),h(n,"variantDebugInfo",{}),h(n,"merged",void 0),h(n,"onUpdate",void 0),h(n,"token",""),h(n,"actionMetadata",{}),h(n,"messagesView",void 0),h(n,"messagesViewPerSession",[]),a.exports=b.default},function(a,b,c){var d=c(2),e=c(0),f=d(e,"Map");a.exports=f},function(a,b,c){var d=c(0),e=d.Symbol;a.exports=e},function(a,b){var c=Array.isArray;a.exports=c},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.default=void 0;var d=function(){var a={};return{subscribe:function(b,c){a.hasOwnProperty.call(a,b)||(a[b]=[]);var d=a[b].push(c)-1;return{remove:function(){delete a[b][d]}}},publish:function(b,c){a.hasOwnProperty.call(a,b)&&a[b].forEach(function(a){a(void 0!=c?c:{})})}}}();b.default=d,a.exports=b.default},function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}function f(a,b,c){return b&&e(a.prototype,b),c&&e(a,c),a}Object.defineProperty(b,"__esModule",{value:!0}),b.default=void 0;var g=[],h=10,i=function(){function a(){d(this,a)}return f(a,null,[{key:"setNetworkTimeout",value:function(a){h=a}},{key:"ajax",value:function(b,c,d,e,f,g,i){if(g){if(a.runningRequest)return a.enqueueRequest(arguments);a.runningRequest=!0}if("undefined"!=typeof XDomainRequest)return"http:"===location.protocol&&0===c.indexOf("https:")&&(c="http:".concat(c.substring(6))),Reflect.apply(a.ajaxIE8,null,arguments);var j=!1,k=new XMLHttpRequest;k.onreadystatechange=function(){if(4===k.readyState){if(j)return;j=!0;var b,c=!1;if(i)b=k.responseText;else try{b=JSON.parse(k.responseText)}catch(a){setTimeout(function(){f&&f(null,k)},0),c=!0}c||(k.status>=200&&k.status<300?setTimeout(function(){e&&e(b,k)},0):setTimeout(function(){f&&f(b,k)},0)),g&&(a.runningRequest=!1,a.dequeueRequest())}},k.open(b,c,!0),k.setRequestHeader("Content-Type","text/plain"),k.send(d),setTimeout(function(){j||k.abort()},1e3*h)}},{key:"ajaxIE8",value:function(b,c,d,e,f,g,i){var j=new XDomainRequest;j.onload=function(){var b,c=!1;if(i)b=j.responseText;else try{b=JSON.parse(j.responseText)}catch(a){setTimeout(function(){f&&f(null,j)},0),c=!0}c||setTimeout(function(){e&&e(b,j)},0),g&&(a.runningRequest=!1,a.dequeueRequest())},j.onerror=j.ontimeout=function(){setTimeout(function(){f&&f(null,j)},0),g&&(a.runningRequest=!1,a.dequeueRequest())},j.onprogress=function(){},j.open(b,c),j.timeout=1e3*h,j.send(d)}},{key:"enqueueRequest",value:function(a){g.push(a)}},{key:"dequeueRequest",value:function(){var b=g.shift();b&&Reflect.apply(a.ajax,null,b)}}]),a}();b.default=i,a.exports=b.default},function(a,b,c){function d(a){var b=-1,c=null==a?0:a.length;for(this.clear();++b<c;){var d=a[b];this.set(d[0],d[1])}}var e=c(81),f=c(82),g=c(83),h=c(84),i=c(85);d.prototype.clear=e,d.prototype.delete=f,d.prototype.get=g,d.prototype.has=h,d.prototype.set=i,a.exports=d},function(a,b,c){function d(a,b,c,d,j,k){var l=c&h,m=a.length,n=b.length;if(m!=n&&!(l&&n>m))return!1;var o=k.get(a);if(o&&k.get(b))return o==b;var p=-1,q=!0,r=c&i?new e:void 0;for(k.set(a,b),k.set(b,a);++p<m;){var s=a[p],t=b[p];if(d)var u=l?d(t,s,p,b,a,k):d(s,t,p,a,b,k);if(void 0!==u){if(u)continue;q=!1;break}if(r){if(!f(b,function(a,b){if(!g(r,b)&&(s===a||j(s,a,c,d,k)))return r.push(b)})){q=!1;break}}else if(s!==t&&!j(s,t,c,d,k)){q=!1;break}}return k.delete(a),k.delete(b),q}var e=c(41),f=c(48),g=c(58),h=1,i=2;a.exports=d},function(a,b,c){(function(b){var c="object"==typeof b&&b&&b.Object===Object&&b;a.exports=c}).call(b,c(104))},function(a,b){function c(a){if(null!=a){try{return e.call(a)}catch(a){}try{return a+""}catch(a){}}return""}var d=Function.prototype,e=d.toString;a.exports=c},function(a,b){function c(a,b){return a===b||a!==a&&b!==b}a.exports=c},function(a,b,c){(function(a){var d=c(0),e=c(103),f="object"==typeof b&&b&&!b.nodeType&&b,g=f&&"object"==typeof a&&a&&!a.nodeType&&a,h=g&&g.exports===f,i=h?d.Buffer:void 0,j=i?i.isBuffer:void 0,k=j||e;a.exports=k}).call(b,c(30)(a))},function(a,b,c){function d(a,b){return e(a,b)}var e=c(51);a.exports=d},function(a,b,c){function d(a){if(!f(a))return!1;var b=e(a);return b==h||b==i||b==g||b==j}var e=c(8),f=c(28),g="[object AsyncFunction]",h="[object Function]",i="[object GeneratorFunction]",j="[object Proxy]";a.exports=d},function(a,b){function c(a){return"number"==typeof a&&a>-1&&a%1==0&&a<=d}var d=9007199254740991;a.exports=c},function(a,b){function c(a){var b=typeof a;return null!=a&&("object"==b||"function"==b)}a.exports=c},function(a,b,c){var d=c(54),e=c(57),f=c(88),g=f&&f.isTypedArray,h=g?e(g):d;a.exports=h},function(a,b){a.exports=function(a){return a.webpackPolyfill||(a.deprecate=function(){},a.paths=[],a.children||(a.children=[]),Object.defineProperty(a,"loaded",{enumerable:!0,get:function(){return a.l}}),Object.defineProperty(a,"id",{enumerable:!0,get:function(){return a.i}}),a.webpackPolyfill=1),a}},function(a,b,c){"use strict";function d(a){for(var b=1;b<arguments.length;b++){var c=null!=arguments[b]?arguments[b]:{},d=Object.keys(c);"function"==typeof Object.getOwnPropertySymbols&&(d=d.concat(Object.getOwnPropertySymbols(c).filter(function(a){return Object.getOwnPropertyDescriptor(c,a).enumerable}))),d.forEach(function(b){e(a,b,c[b])})}return a}function e(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}function f(a,b){return i(a)||h(a,b)||g()}function g(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function h(a,b){var c=[],d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done)&&(c.push(g.value),!b||c.length!==b);d=!0);}catch(a){e=!0,f=a}finally{try{d||null==h.return||h.return()}finally{if(e)throw f}}return c}function i(a){if(Array.isArray(a))return a}function j(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function k(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}function l(a,b,c){return b&&k(a.prototype,b),c&&k(a,c),a}Object.defineProperty(b,"__esModule",{value:!0}),b.default=void 0;var m=function(a){return a&&a.__esModule?a:{default:a}}(c(13)),n=function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(b){var c=b.whenTriggers&&b.whenTriggers.children;if(!a.triggers||!c)return!1;var d=c.filter(function(b){return a.triggers.includes(b.subject)});if(!d.length)return!1;var e=o(a);return!!e&&(d=d.filter(e),d.length)}},o=function(a){return function(b){return""===b.verb||(0,s[b.verb])(b,a.noun,a.objects)}},p=function(a){return function(b){var c=b.whenLimits&&b.whenLimits.children;return!c||c.length<1||c.every(function(c){var d=t[c.verb];return!!d&&d(b.id,c.noun,c.objects[0],a)})}},q=function(a){return function(b,c){return c.t>a&&(b+=1),b}},r=function(a){return function(b){return(!b.startTime||b.startTime<a)&&(!b.endTime||b.endTime>a)}},s={triggers:function(a,b){return b===a.noun},triggersWithParameter:function(a,b,c){return b===a.noun&&c.paramValue===a.objects[c.paramName]},changesTo:function(a,b,c){return b===a.noun&&c.to===a.objects[0]},changesFromTo:function(a,b,c){return b===a.noun&&c.from===a.objects[0]&&c.to===a.objects[1]}},t={limitUser:function(a,b){return m.default.getMessageView(a).length<b},limitMonth:function(a,b,c,d){var e=d-30*c*24*60*60*1e3;return m.default.getMessageView(a).reduce(q(e),0)<b},limitWeek:function(a,b,c,d){var e=d-7*c*24*60*60*1e3;return m.default.getMessageView(a).reduce(q(e),0)<b},limitDay:function(a,b,c,d){var e=d-24*c*60*60*1e3;return m.default.getMessageView(a).reduce(q(e),0)<b},limitHour:function(a,b,c,d){var e=d-60*c*60*1e3;return m.default.getMessageView(a).reduce(q(e),0)<b},limitMinute:function(a,b,c,d){var e=d-60*c*1e3;return m.default.getMessageView(a).reduce(q(e),0)<b},limitSecond:function(a,b,c,d){var e=d-1e3*c;return m.default.getMessageView(a).reduce(q(e),0)<b},limitSession:function(a,b){return m.default.getMessageView(a,!0).length<b}},u=function(){function a(){j(this,a)}return l(a,null,[{key:"filterMessages",value:function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";arguments.length>2&&arguments[2],arguments.length>3&&arguments[3],arguments.length>4&&arguments[4];Array.isArray(b)||(b=[b]);var c=Date.now(),e=Object.entries(a).map(function(a){var b=f(a,2);return d({id:b[0]},b[1])});return e=e.filter(n({triggers:b})).filter(p(c)).filter(r(c))}}]),a}();b.default=u,a.exports=b.default},function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}function f(a,b,c){return b&&e(a.prototype,b),c&&e(a,c),a}Object.defineProperty(b,"__esModule",{value:!0}),b.default=void 0;var g=[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:window.opera,identity:"Opera",versionSearch:"Version"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}],h=[{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac OS"},{string:navigator.userAgent,subString:"iPhone",identity:"iOS"},{string:navigator.platform,subString:"Linux",identity:"Linux"}],i=function(){function a(){d(this,a),this.browser=this._searchString(g)||"Unknown Browser",this.version=this._searchVersion(navigator.userAgent)||this._searchVersion(navigator.appVersion)||"Unknown Version",this.OS=this._searchString(h)||"Unknown OS"}return f(a,[{key:"_searchString",value:function(a){for(var b=0;b<a.length;b++){var c=a[b].string,d=a[b].prop;if(this.versionSearchString=a[b].versionSearch||a[b].identity,c){if(-1!==c.indexOf(a[b].subString))return a[b].identity}else if(d)return a[b].identity}}},{key:"_searchVersion",value:function(a){if(!a)return-1;var b=a.indexOf(this.versionSearchString);return-1===b?-1:parseFloat(a.substring(b+this.versionSearchString.length+1))}}]),a}();b.default=i,a.exports=b.default},function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}function g(a,b,c){return b&&f(a.prototype,b),c&&f(a,c),a}Object.defineProperty(b,"__esModule",{value:!0}),b.default=void 0;var h=d(c(1)),i=d(c(3)),j=d(c(36)),k=d(c(13)),l=d(c(4)),m=d(c(25)),n=d(c(17)),o=function(){function a(){e(this,a)}return g(a,null,[{key:"connect",value:function(){if(!WebSocket)return void console.log("Your browser doesn't support WebSockets.");var b=new j.default,c=!1;b.onopen=function(){if(!c){console.log("Leanplum: Connected to development server.");var a={};a[h.default.PARAMS.APP_ID]=l.default.appId,a[h.default.PARAMS.DEVICE_ID]=l.default.deviceId,b.send("auth",a),c=!0}},b.onerror=function(a){console.log("Leanplum: Socket error",a)},b.onmessage=function(a,c){"updateVars"===a?l.default.request(h.default.METHODS.GET_VARS,(new i.default).add(h.default.PARAMS.INCLUDE_DEFAULTS,!1),{queued:!1,sendNow:!0,response:function(a){var b=l.default.getLastResponse(a),c=b[h.default.KEYS.VARS],d=b[h.default.KEYS.VARIANTS],e=b[h.default.KEYS.ACTION_METADATA];(0,m.default)(c,k.default.diffs)||k.default.applyDiffs(c,d,e)}}):"getVariables"===a?(k.default.sendVariables(),b.send("getContentResponse",{updated:!0})):"getActions"===a?b.send("getContentResponse",{updated:!1}):"registerDevice"===a?alert("Your device has been registered to ".concat(c[0].email,".")):"trigger"===a&&n.default.publish("websocket/trigger",{args:c})},b.onclose=function(){console.log("Leanplum: Disconnected to development server."),c=!1},b.connect(a.socketHost),setInterval(function(){b.connected||b.connecting||b.connect(a.socketHost)},5e3)}}]),a}();b.default=o,function(a,b,c){b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c}(o,"socketHost","dev.leanplum.com"),a.exports=b.default},function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}function g(a,b,c){return b&&f(a.prototype,b),c&&f(a,c),a}Object.defineProperty(b,"__esModule",{value:!0}),b.default=void 0;var h=d(c(1)),i=d(c(3)),j=d(c(25)),k=d(c(5)),l=d(c(4)),m=!1,n=null,o=function(){function a(){e(this,a)}return g(a,null,[{key:"isWebPushSupported",value:function(){return navigator&&navigator.serviceWorker&&"serviceWorker"in navigator&&"PushManager"in window}},{key:"isWebPushSubscribed",value:function(){return a.isWebPushSupported()?a.getServiceWorkerRegistration().then(function(b){return new Promise(function(c){b?b.pushManager.getSubscription().then(function(b){m=null!==b,m&&a.updateNewSubscriptionOnServer(b),c(m)}):c(!1)})}):new Promise(function(a){a(!1)})}},{key:"register",value:function(b,c){if(!a.isWebPushSupported())return console.log("Leanplum: Push messaging is not supported."),c(!1);navigator.serviceWorker.register(b||"/sw.min.js",null).then(function(b){n=b;var d;if(b.installing?d=b.installing:b.waiting?d=b.waiting:b.active&&(d=b.active),d){var e=function(){n.pushManager.getSubscription().then(function(b){if(m=!(null===b),m&&a.updateNewSubscriptionOnServer(b),c)return c(m)})};if("activated"===d.state)return e();d.addEventListener("statechange",function(a){"activated"===a.target.state&&e()})}}).catch(function(a){console.log("Leanplum: Service Worker Error: ",a)})}},{key:"subscribeUser",value:function(){var b=a.urlB64ToUint8Array("BInWPpWntfR39rgXSP04pqdmEdDGa50z6zqbMvxyxJCwzXIuSpSh8C888-CfJ82WELl7Xe8cjAnfCt-3vK0Ci68");return new Promise(function(c,d){return n.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:b}).then(function(b){return b?(a.updateNewSubscriptionOnServer(b),m=!0,c(m)):(m=!1,d())}).catch(function(a){return d("Leanplum: Failed to subscribe the user: ".concat(a))})})}},{key:"unsubscribeUser",value:function(){return new Promise(function(b,c){a.isWebPushSubscribed().then(function(a){if(!a)return b()
;n.pushManager.getSubscription().then(function(a){return a?a.unsubscribe():c()}).catch(function(a){c("Leanplum: Error unsubscribing: ".concat(a))}).then(function(a){return a?(m=!1,b()):c()})},function(a){return c()})})}},{key:"getServiceWorkerRegistration",value:function(){return new Promise(function(a){n?a(n):navigator.serviceWorker.getRegistration().then(function(b){n=b,a(b)})})}},{key:"urlB64ToUint8Array",value:function(a){for(var b="=".repeat((4-a.length%4)%4),c=(a+b).replace(/-/g,"+").replace(/_/g,"/"),d=window.atob(c),e=new Uint8Array(d.length),f=0;f<d.length;++f)e[f]=d.charCodeAt(f);return e}},{key:"prepareSubscription",value:function(a){var b=a.getKey?a.getKey("p256dh"):"",c=a.getKey?a.getKey("auth"):"",d=btoa(Reflect.apply(String.fromCharCode,null,new Uint8Array(b))),e=btoa(Reflect.apply(String.fromCharCode,null,new Uint8Array(c)));return{endpoint:a.endpoint,key:d,auth:e}}},{key:"updateNewSubscriptionOnServer",value:function(b){if(b){var c=a.prepareSubscription(b),d=JSON.stringify(c),e=k.default.getFromLocalStorage(h.default.DEFAULT_KEYS.PUSH_SUBSCRIPTION);(0,j.default)(e,d)||(k.default.saveToLocalStorage(h.default.DEFAULT_KEYS.PUSH_SUBSCRIPTION,d),a.setSubscription(d))}}},{key:"setSubscription",value:function(a){a&&l.default.request(h.default.METHODS.SET_DEVICE_ATTRIBUTES,(new i.default).add(h.default.PARAMS.WEB_PUSH_SUBSCRIPTION,a),{queued:!1,sendNow:!0})}}]),a}();b.default=o,a.exports=b.default},function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a})(a)}function f(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function g(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}function h(a,b,c){return b&&g(a.prototype,b),c&&g(a,c),a}Object.defineProperty(b,"__esModule",{value:!0}),b.default=void 0;var i=d(c(1)),j=d(c(12)),k=d(c(3)),l=d(c(32)),m=d(c(34)),n=d(c(31)),o=d(c(5)),p=d(c(13)),q=d(c(4)),r=d(c(33)),s=d(c(17)),t=new l.default,u=function(){function a(){f(this,a)}return h(a,null,[{key:"setApiPath",value:function(a){q.default.apiPath&&(q.default.apiPath=a)}},{key:"setEmail",value:function(b){a._email=b}},{key:"setNetworkTimeout",value:function(a){q.default.setNetworkTimeout(a)}},{key:"setVariantDebugInfoEnabled",value:function(a){j.default.setVariantDebugInfoEnabled(a)}},{key:"getVariantDebugInfo",value:function(){return p.default.getVariantDebugInfo()}},{key:"setAppIdForDevelopmentMode",value:function(a,b){q.default.appId=a,q.default.clientKey=b,j.default.devMode=!0}},{key:"setAppIdForProductionMode",value:function(a,b){q.default.appId=a,q.default.clientKey=b,j.default.devMode=!1}},{key:"setSocketHost",value:function(a){r.default.socketHost=a}},{key:"setDeviceId",value:function(a){q.default.deviceId=a}},{key:"setAppVersion",value:function(a){q.default.versionName=a}},{key:"setDeviceName",value:function(b){a._deviceName=b}},{key:"setDeviceModel",value:function(b){a._deviceModel=b}},{key:"setSystemName",value:function(b){a._systemName=b}},{key:"setSystemVersion",value:function(b){a._systemVersion=b}},{key:"setVariables",value:function(a){p.default.setVariables(a)}},{key:"setRequestBatching",value:function(a,b){q.default.batchEnabled=a,q.default.batchCooldown=b}},{key:"getVariables",value:function(){return p.default.getVariables()}},{key:"getVariable",value:function(){for(var b=a.getVariables(),c=arguments.length,d=new Array(c),e=0;e<c;e++)d[e]=arguments[e];for(var f=0;f<d.length;f++)b=b[d[f]];return b}},{key:"getVariants",value:function(){return p.default.variants||[]}},{key:"addStartResponseHandler",value:function(a){j.default.addStartResponseHandler(a)}},{key:"addVariablesChangedHandler",value:function(a){j.default.addVariablesChangedHandler(a)}},{key:"removeStartResponseHandler",value:function(a){j.default.removeStartResponseHandler(a)}},{key:"removeVariablesChangedHandler",value:function(a){j.default.removeVariablesChangedHandler(a)}},{key:"forceContentUpdate",value:function(a){q.default.request(i.default.METHODS.GET_VARS,(new k.default).add(i.default.PARAMS.INCLUDE_DEFAULTS,!1).add(i.default.PARAMS.INCLUDE_VARIANT_DEBUG_INFO,j.default.variantDebugInfoEnabled),{queued:!1,sendNow:!0,response:function(b){var c=q.default.getLastResponse(b),d=q.default.isResponseSuccess(c);d&&(p.default.applyDiffs(c[i.default.KEYS.VARS],c[i.default.KEYS.VARIANTS],c[i.default.KEYS.ACTION_METADATA]),p.default.variantDebugInfo=c[i.default.KEYS.VARIANT_DEBUG_INFO]),a&&a(d)}})}},{key:"start",value:function(b,c,d){"function"==typeof b?(d=b,c={},b=null):"object"===e(b)&&null!==b&&void 0!==b?(d=c,c=b,b=null):"function"==typeof c&&(d=c,c={}),q.default.userId=b,d&&a.addStartResponseHandler(d),p.default.onUpdate=function(){j.default.triggerVariablesChangedHandlers()};var f=(new k.default).add(i.default.PARAMS.USER_ATTRIBUTES,JSON.stringify(c)).add(i.default.PARAMS.COUNTRY,i.default.VALUES.DETECT).add(i.default.PARAMS.REGION,i.default.VALUES.DETECT).add(i.default.PARAMS.CITY,i.default.VALUES.DETECT).add(i.default.PARAMS.LOCATION,i.default.VALUES.DETECT).add(i.default.PARAMS.SYSTEM_NAME,a._systemName||t.OS).add(i.default.PARAMS.SYSTEM_VERSION,(a._systemVersion||"").toString()).add(i.default.PARAMS.BROWSER_NAME,t.browser).add(i.default.PARAMS.BROWSER_VERSION,t.version.toString()).add(i.default.PARAMS.LOCALE,i.default.VALUES.DETECT).add(i.default.PARAMS.DEVICE_NAME,a._deviceName||"".concat(t.browser," ").concat(t.version)).add(i.default.PARAMS.DEVICE_MODEL,a._deviceModel||"Web Browser").add(i.default.PARAMS.INCLUDE_DEFAULTS,!1).add(i.default.PARAMS.INCLUDE_VARIANT_DEBUG_INFO,j.default.variantDebugInfoEnabled);q.default.request(i.default.METHODS.START,f,{queued:!0,sendNow:!0,response:function(b){j.default.hasStarted=!0;var c=q.default.getLastResponse(b);if(q.default.isResponseSuccess(c)){if(j.default.startSuccessful=!0,j.default.devMode){var d=c[i.default.KEYS.LATEST_VERSION];d&&console.log("A newer version of Leanplum, ".concat(d,", is available. Go to")+"leanplum.com to download it."),r.default.connect()}p.default.applyDiffs(c[i.default.KEYS.VARS],c[i.default.KEYS.VARIANTS],c[i.default.KEYS.ACTION_METADATA]),p.default.variantDebugInfo=c[i.default.KEYS.VARIANT_DEBUG_INFO],p.default.token=c[i.default.KEYS.TOKEN],s.default.publish("start/messages",{messages:a.getFilteredResults(c[i.default.KEYS.MESSAGES],["start","resume"])})}else j.default.startSuccessful=!1,p.default.loadDiffs();j.default.triggerStartHandlers()}})}},{key:"getFilteredResults",value:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",e=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return null===a?[]:n.default.filterMessages(a,b,c,d,e)}},{key:"startFromCache",value:function(b,c,d){"function"==typeof b?(d=b,c={},b=null):"object"===e(b)&&null!==b&&void 0!==b?(d=c,c=b,b=null):"function"==typeof c&&(d=c,c={}),q.default.userId=b,d&&a.addStartResponseHandler(d),j.default.hasStarted=!0,j.default.startSuccessful=!0,j.default.devMode&&r.default.connect(),p.default.loadDiffs(),j.default.triggerStartHandlers()}},{key:"stop",value:function(){q.default.request(i.default.METHODS.STOP,void 0,{sendNow:!0,queued:!0})}},{key:"pauseSession",value:function(){q.default.request(i.default.METHODS.PAUSE_SESSION,void 0,{sendNow:!0,queued:!0})}},{key:"resumeSession",value:function(){q.default.request(i.default.METHODS.RESUME_SESSION,void 0,{sendNow:!0,queued:!0})}},{key:"pauseState",value:function(){q.default.request(i.default.METHODS.PAUSE_STATE,void 0,{queued:!0})}},{key:"resumeState",value:function(){q.default.request(i.default.METHODS.RESUME_STATE,void 0,{queued:!0})}},{key:"setUserId",value:function(b){a.setUserAttributes(b)}},{key:"setUserAttributes",value:function(a,b){if(void 0===b)if("object"===e(a))b=a,a=void 0;else if("string"!=typeof a)return void console.log("Leanplum: setUserAttributes expects a string or an object");q.default.request(i.default.METHODS.SET_USER_ATTRIBUTES,(new k.default).add(i.default.PARAMS.USER_ATTRIBUTES,b?JSON.stringify(b):void 0).add(i.default.PARAMS.NEW_USER_ID,a),{queued:!0}),a&&(q.default.userId=a,o.default.saveToLocalStorage(i.default.DEFAULT_KEYS.USER_ID,q.default.userId))}},{key:"getFileUrl",value:function(a){return q.default.generateRequestUrl(i.default.METHODS.DOWNLOAD_FILE,(new k.default).add(i.default.PARAMS.FILENAME,a))}},{key:"trackMessage",value:function(a,b){""===a&&p.default.addMessageView(b),q.default.request(i.default.METHODS.TRACK,(new k.default).add(i.default.PARAMS.EVENT,a).add(i.default.PARAMS.MESSAGE_ID,b),{queued:!0})}},{key:"track",value:function(a,b,c,d){"object"===e(b)&&null!==b&&void 0!==b?(d=b,c=void 0,b=void 0):"string"==typeof b?(d=c,c=b,b=void 0):"object"===e(c)&&null!==c&&void 0!==c&&(d=c,c=void 0),s.default.publish("track",{event:a,params:d}),q.default.request(i.default.METHODS.TRACK,(new k.default).add(i.default.PARAMS.EVENT,a).add(i.default.PARAMS.VALUE,b||0).add(i.default.PARAMS.INFO,c).add(i.default.PARAMS.PARAMS,JSON.stringify(d)),{queued:!0})}},{key:"advanceTo",value:function(a,b,c){"object"===e(b)&&null!==b&&void 0!==b&&(c=b,b=void 0),q.default.request(i.default.METHODS.ADVANCE,(new k.default).add(i.default.PARAMS.STATE,a).add(i.default.PARAMS.INFO,b).add(i.default.PARAMS.PARAMS,JSON.stringify(c)),{queued:!0})}},{key:"isWebPushSupported",value:function(){return m.default.isWebPushSupported()}},{key:"isWebPushSubscribed",value:function(){return m.default.isWebPushSubscribed()}},{key:"registerForWebPush",value:function(a){return new Promise(function(b,c){return m.default.isWebPushSupported()?m.default.register(a,function(a){return a?b(!0):m.default.subscribeUser()}):c("Leanplum: WebPush is not supported.")})}},{key:"unregisterFromWebPush",value:function(){return m.default.unsubscribeUser()}},{key:"clearUserContent",value:function(){p.default.clearUserContent()}},{key:"getEvents",value:function(){return s.default}}]),a}();b.default=u,a.exports=b.default},function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}function f(a,b,c){return b&&e(a.prototype,b),c&&e(a,c),a}Object.defineProperty(b,"__esModule",{value:!0}),b.default=void 0;var g=function(a){return a&&a.__esModule?a:{default:a}}(c(18)),h=function(){function a(){d(this,a),this.connected=!1,this.connecting=!1}return f(a,[{key:"connect",value:function(a){var b=this;b.connecting=!0,g.default.ajax("POST","https://".concat(a,"/socket.io/1"),"",function(c){var d=c.split(":"),e=d[0],f=parseInt(d[1])/2*1e3;b.socket=new WebSocket("wss://".concat(a,"/socket.io/1/websocket/").concat(e));var g=null;b.socket.onopen=function(){b.connected=!0,b.connecting=!1,b.onopen&&b.onopen(),g=setInterval(function(){b.socket.send("2:::")},f)},b.socket.onclose=function(){b.connected=!1,clearInterval(g),b.onclose&&b.onclose()},b.socket.onmessage=function(a){var c=a.data.split(":"),d=parseInt(c[0]);if(2===d)b.socket.send("2::");else if(5===d){var e=c[1],f=JSON.parse(c.slice(3).join(":")),g=f.name,h=f.args;e&&b.socket.send("6:::".concat(e)),b.onmessage&&b.onmessage(g,h)}else 7===d&&console.log("Socket error: ".concat(a.data))},b.socket.onerror=function(a){b.socket.close(),b.onerror&&b.onerror(a)}},null,!1,!0)}},{key:"send",value:function(a,b){if(!this.connected)return void console.log("Leanplum: Socket is not connected.");var c=JSON.stringify({name:a,args:b});this.socket.send("5:::".concat(c))}}]),a}();b.default=h,a.exports=b.default},function(a,b,c){var d=c(2),e=c(0),f=d(e,"DataView");a.exports=f},function(a,b,c){function d(a){var b=-1,c=null==a?0:a.length;for(this.clear();++b<c;){var d=a[b];this.set(d[0],d[1])}}var e=c(67),f=c(68),g=c(69),h=c(70),i=c(71);d.prototype.clear=e,d.prototype.delete=f,d.prototype.get=g,d.prototype.has=h,d.prototype.set=i,a.exports=d},function(a,b,c){var d=c(2),e=c(0),f=d(e,"Promise");a.exports=f},function(a,b,c){var d=c(2),e=c(0),f=d(e,"Set");a.exports=f},function(a,b,c){function d(a){var b=-1,c=null==a?0:a.length;for(this.__data__=new e;++b<c;)this.add(a[b])}var e=c(19),f=c(91),g=c(92);d.prototype.add=d.prototype.push=f,d.prototype.has=g,a.exports=d},function(a,b,c){function d(a){var b=this.__data__=new e(a);this.size=b.size}var e=c(6),f=c(94),g=c(95),h=c(96),i=c(97),j=c(98);d.prototype.clear=f,d.prototype.delete=g,d.prototype.get=h,d.prototype.has=i,d.prototype.set=j,a.exports=d},function(a,b,c){var d=c(0),e=d.Uint8Array;a.exports=e},function(a,b,c){var d=c(2),e=c(0),f=d(e,"WeakMap");a.exports=f},function(a,b){function c(a,b){for(var c=-1,d=null==a?0:a.length,e=0,f=[];++c<d;){var g=a[c];b(g,c,a)&&(f[e++]=g)}return f}a.exports=c},function(a,b,c){function d(a,b){var c=g(a),d=!c&&f(a),k=!c&&!d&&h(a),m=!c&&!d&&!k&&j(a),n=c||d||k||m,o=n?e(a.length,String):[],p=o.length;for(var q in a)!b&&!l.call(a,q)||n&&("length"==q||k&&("offset"==q||"parent"==q)||m&&("buffer"==q||"byteLength"==q||"byteOffset"==q)||i(q,p))||o.push(q);return o}var e=c(56),f=c(99),g=c(16),h=c(24),i=c(72),j=c(29),k=Object.prototype,l=k.hasOwnProperty;a.exports=d},function(a,b){function c(a,b){for(var c=-1,d=b.length,e=a.length;++c<d;)a[e+c]=b[c];return a}a.exports=c},function(a,b){function c(a,b){for(var c=-1,d=null==a?0:a.length;++c<d;)if(b(a[c],c,a))return!0;return!1}a.exports=c},function(a,b,c){function d(a,b,c){var d=b(a);return f(a)?d:e(d,c(a))}var e=c(47),f=c(16);a.exports=d},function(a,b,c){function d(a){return f(a)&&e(a)==g}var e=c(8),f=c(11),g="[object Arguments]";a.exports=d},function(a,b,c){function d(a,b,c,g,h){return a===b||(null==a||null==b||!f(a)&&!f(b)?a!==a&&b!==b:e(a,b,c,g,d,h))}var e=c(52),f=c(11);a.exports=d},function(a,b,c){function d(a,b,c,d,q,s){var t=j(a),u=j(b),v=t?o:i(a),w=u?o:i(b);v=v==n?p:v,w=w==n?p:w;var x=v==p,y=w==p,z=v==w;if(z&&k(a)){if(!k(b))return!1;t=!0,x=!1}if(z&&!x)return s||(s=new e),t||l(a)?f(a,b,c,d,q,s):g(a,b,v,c,d,q,s);if(!(c&m)){var A=x&&r.call(a,"__wrapped__"),B=y&&r.call(b,"__wrapped__");if(A||B){var C=A?a.value():a,D=B?b.value():b;return s||(s=new e),q(C,D,c,d,s)}}return!!z&&(s||(s=new e),h(a,b,c,d,q,s))}var e=c(42),f=c(20),g=c(60),h=c(61),i=c(65),j=c(16),k=c(24),l=c(29),m=1,n="[object Arguments]",o="[object Array]",p="[object Object]",q=Object.prototype,r=q.hasOwnProperty;a.exports=d},function(a,b,c){function d(a){return!(!g(a)||f(a))&&(e(a)?o:j).test(h(a))}var e=c(26),f=c(74),g=c(28),h=c(22),i=/[\\^$.*+?()[\]{}|]/g,j=/^\[object .+?Constructor\]$/,k=Function.prototype,l=Object.prototype,m=k.toString,n=l.hasOwnProperty,o=RegExp("^"+m.call(n).replace(i,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");a.exports=d},function(a,b,c){function d(a){return g(a)&&f(a.length)&&!!h[e(a)]}var e=c(8),f=c(27),g=c(11),h={};h["[object Float32Array]"]=h["[object Float64Array]"]=h["[object Int8Array]"]=h["[object Int16Array]"]=h["[object Int32Array]"]=h["[object Uint8Array]"]=h["[object Uint8ClampedArray]"]=h["[object Uint16Array]"]=h["[object Uint32Array]"]=!0,h["[object Arguments]"]=h["[object Array]"]=h["[object ArrayBuffer]"]=h["[object Boolean]"]=h["[object DataView]"]=h["[object Date]"]=h["[object Error]"]=h["[object Function]"]=h["[object Map]"]=h["[object Number]"]=h["[object Object]"]=h["[object RegExp]"]=h["[object Set]"]=h["[object String]"]=h["[object WeakMap]"]=!1,a.exports=d},function(a,b,c){function d(a){if(!e(a))return f(a);var b=[];for(var c in Object(a))h.call(a,c)&&"constructor"!=c&&b.push(c);return b}var e=c(75),f=c(87),g=Object.prototype,h=g.hasOwnProperty;a.exports=d},function(a,b){function c(a,b){for(var c=-1,d=Array(a);++c<a;)d[c]=b(c);return d}a.exports=c},function(a,b){function c(a){return function(b){return a(b)}}a.exports=c},function(a,b){function c(a,b){return a.has(b)}a.exports=c},function(a,b,c){var d=c(0),e=d["__core-js_shared__"];a.exports=e},function(a,b,c){function d(a,b,c,d,e,x,z){switch(c){case w:if(a.byteLength!=b.byteLength||a.byteOffset!=b.byteOffset)return!1;a=a.buffer,b=b.buffer;case v:return!(a.byteLength!=b.byteLength||!x(new f(a),new f(b)));case m:case n:case q:return g(+a,+b);case o:return a.name==b.name&&a.message==b.message;case r:case t:return a==b+"";case p:var A=i;case s:var B=d&k;if(A||(A=j),a.size!=b.size&&!B)return!1;var C=z.get(a);if(C)return C==b;d|=l,z.set(a,b);var D=h(A(a),A(b),d,e,x,z);return z.delete(a),D;case u:if(y)return y.call(a)==y.call(b)}return!1}var e=c(15),f=c(43),g=c(23),h=c(20),i=c(86),j=c(93),k=1,l=2,m="[object Boolean]",n="[object Date]",o="[object Error]",p="[object Map]",q="[object Number]",r="[object RegExp]",s="[object Set]",t="[object String]",u="[object Symbol]",v="[object ArrayBuffer]",w="[object DataView]",x=e?e.prototype:void 0,y=x?x.valueOf:void 0;a.exports=d},function(a,b,c){function d(a,b,c,d,g,i){var j=c&f,k=e(a),l=k.length;if(l!=e(b).length&&!j)return!1;for(var m=l;m--;){var n=k[m];if(!(j?n in b:h.call(b,n)))return!1}var o=i.get(a);if(o&&i.get(b))return o==b;var p=!0;i.set(a,b),i.set(b,a);for(var q=j;++m<l;){n=k[m];var r=a[n],s=b[n];if(d)var t=j?d(s,r,n,b,a,i):d(r,s,n,a,b,i);if(!(void 0===t?r===s||g(r,s,c,d,i):t)){p=!1;break}q||(q="constructor"==n)}if(p&&!q){var u=a.constructor,v=b.constructor;u!=v&&"constructor"in a&&"constructor"in b&&!("function"==typeof u&&u instanceof u&&"function"==typeof v&&v instanceof v)&&(p=!1)}return i.delete(a),i.delete(b),p}var e=c(62),f=1,g=Object.prototype,h=g.hasOwnProperty;a.exports=d},function(a,b,c){function d(a){return e(a,g,f)}var e=c(49),f=c(64),g=c(101);a.exports=d},function(a,b,c){function d(a){var b=g.call(a,i),c=a[i];try{a[i]=void 0;var d=!0}catch(a){}var e=h.call(a);return d&&(b?a[i]=c:delete a[i]),e}var e=c(15),f=Object.prototype,g=f.hasOwnProperty,h=f.toString,i=e?e.toStringTag:void 0;a.exports=d},function(a,b,c){var d=c(45),e=c(102),f=Object.prototype,g=f.propertyIsEnumerable,h=Object.getOwnPropertySymbols,i=h?function(a){return null==a?[]:(a=Object(a),d(h(a),function(b){return g.call(a,b)}))}:e;a.exports=i},function(a,b,c){var d=c(37),e=c(14),f=c(39),g=c(40),h=c(44),i=c(8),j=c(22),k=j(d),l=j(e),m=j(f),n=j(g),o=j(h),p=i;(d&&"[object DataView]"!=p(new d(new ArrayBuffer(1)))||e&&"[object Map]"!=p(new e)||f&&"[object Promise]"!=p(f.resolve())||g&&"[object Set]"!=p(new g)||h&&"[object WeakMap]"!=p(new h))&&(p=function(a){var b=i(a),c="[object Object]"==b?a.constructor:void 0,d=c?j(c):"";if(d)switch(d){case k:return"[object DataView]";case l:return"[object Map]";case m:return"[object Promise]";case n:return"[object Set]";case o:return"[object WeakMap]"}return b}),a.exports=p},function(a,b){function c(a,b){return null==a?void 0:a[b]}a.exports=c},function(a,b,c){function d(){this.__data__=e?e(null):{},this.size=0}var e=c(10);a.exports=d},function(a,b){function c(a){var b=this.has(a)&&delete this.__data__[a];return this.size-=b?1:0,b}a.exports=c},function(a,b,c){function d(a){var b=this.__data__;if(e){var c=b[a];return c===f?void 0:c}return h.call(b,a)?b[a]:void 0}var e=c(10),f="__lodash_hash_undefined__",g=Object.prototype,h=g.hasOwnProperty;a.exports=d},function(a,b,c){function d(a){var b=this.__data__;return e?void 0!==b[a]:g.call(b,a)}var e=c(10),f=Object.prototype,g=f.hasOwnProperty;a.exports=d},function(a,b,c){function d(a,b){var c=this.__data__;return this.size+=this.has(a)?0:1,c[a]=e&&void 0===b?f:b,this}var e=c(10),f="__lodash_hash_undefined__";a.exports=d},function(a,b){function c(a,b){var c=typeof a;return!!(b=null==b?d:b)&&("number"==c||"symbol"!=c&&e.test(a))&&a>-1&&a%1==0&&a<b}var d=9007199254740991,e=/^(?:0|[1-9]\d*)$/;a.exports=c},function(a,b){function c(a){var b=typeof a;return"string"==b||"number"==b||"symbol"==b||"boolean"==b?"__proto__"!==a:null===a}a.exports=c},function(a,b,c){function d(a){return!!f&&f in a}var e=c(59),f=function(){var a=/[^.]+$/.exec(e&&e.keys&&e.keys.IE_PROTO||"");return a?"Symbol(src)_1."+a:""}();a.exports=d},function(a,b){function c(a){var b=a&&a.constructor;return a===("function"==typeof b&&b.prototype||d)}var d=Object.prototype;a.exports=c},function(a,b){function c(){this.__data__=[],this.size=0}a.exports=c},function(a,b,c){function d(a){var b=this.__data__,c=e(b,a);return!(c<0)&&(c==b.length-1?b.pop():g.call(b,c,1),--this.size,!0)}var e=c(7),f=Array.prototype,g=f.splice;a.exports=d},function(a,b,c){function d(a){var b=this.__data__,c=e(b,a);return c<0?void 0:b[c][1]}var e=c(7);a.exports=d},function(a,b,c){function d(a){return e(this.__data__,a)>-1}var e=c(7);a.exports=d},function(a,b,c){function d(a,b){var c=this.__data__,d=e(c,a);return d<0?(++this.size,c.push([a,b])):c[d][1]=b,this}var e=c(7);a.exports=d},function(a,b,c){function d(){this.size=0,this.__data__={hash:new e,map:new(g||f),string:new e}}var e=c(38),f=c(6),g=c(14);a.exports=d},function(a,b,c){function d(a){var b=e(this,a).delete(a);return this.size-=b?1:0,b}var e=c(9);a.exports=d},function(a,b,c){function d(a){return e(this,a).get(a)}var e=c(9);a.exports=d},function(a,b,c){function d(a){return e(this,a).has(a)}var e=c(9);a.exports=d},function(a,b,c){function d(a,b){var c=e(this,a),d=c.size;return c.set(a,b),this.size+=c.size==d?0:1,this}var e=c(9);a.exports=d},function(a,b){function c(a){var b=-1,c=Array(a.size);return a.forEach(function(a,d){c[++b]=[d,a]}),c}a.exports=c},function(a,b,c){var d=c(90),e=d(Object.keys,Object);a.exports=e},function(a,b,c){(function(a){var d=c(21),e="object"==typeof b&&b&&!b.nodeType&&b,f=e&&"object"==typeof a&&a&&!a.nodeType&&a,g=f&&f.exports===e,h=g&&d.process,i=function(){try{var a=f&&f.require&&f.require("util").types;return a||h&&h.binding&&h.binding("util")}catch(a){}}();a.exports=i}).call(b,c(30)(a))},function(a,b){function c(a){return e.call(a)}var d=Object.prototype,e=d.toString;a.exports=c},function(a,b){function c(a,b){return function(c){return a(b(c))}}a.exports=c},function(a,b){function c(a){return this.__data__.set(a,d),this}var d="__lodash_hash_undefined__";a.exports=c},function(a,b){function c(a){return this.__data__.has(a)}a.exports=c},function(a,b){function c(a){var b=-1,c=Array(a.size);return a.forEach(function(a){c[++b]=a}),c}a.exports=c},function(a,b,c){function d(){this.__data__=new e,this.size=0}var e=c(6);a.exports=d},function(a,b){function c(a){var b=this.__data__,c=b.delete(a);return this.size=b.size,c}a.exports=c},function(a,b){function c(a){return this.__data__.get(a)}a.exports=c},function(a,b){function c(a){return this.__data__.has(a)}a.exports=c},function(a,b,c){function d(a,b){var c=this.__data__;if(c instanceof e){var d=c.__data__;if(!f||d.length<h-1)return d.push([a,b]),this.size=++c.size,this;c=this.__data__=new g(d)}return c.set(a,b),this.size=c.size,this}var e=c(6),f=c(14),g=c(19),h=200;a.exports=d},function(a,b,c){var d=c(50),e=c(11),f=Object.prototype,g=f.hasOwnProperty,h=f.propertyIsEnumerable,i=d(function(){return arguments}())?d:function(a){return e(a)&&g.call(a,"callee")&&!h.call(a,"callee")};a.exports=i},function(a,b,c){function d(a){return null!=a&&f(a.length)&&!e(a)}var e=c(26),f=c(27);a.exports=d},function(a,b,c){function d(a){return g(a)?e(a):f(a)}var e=c(46),f=c(55),g=c(100);a.exports=d},function(a,b){function c(){return[]}a.exports=c},function(a,b){function c(){return!1}a.exports=c},function(a,b){var c;c=function(){return this}();try{c=c||Function("return this")()||(0,eval)("this")}catch(a){"object"==typeof window&&(c=window)}a.exports=c}])});