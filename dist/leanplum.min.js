!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.Leanplum=t():e.Leanplum=t()}(window,function(){return r={},o.m=n=[function(e,t,n){var r=n(18),o="object"==typeof self&&self&&self.Object===Object&&self,a=r||o||Function("return this")();e.exports=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={METHODS:{START:"start",STOP:"stop",ADVANCE:"advance",TRACK:"track",PAUSE_SESSION:"pauseSession",RESUME_SESSION:"resumeSession",PAUSE_STATE:"pauseState",RESUME_STATE:"resumeState",DOWNLOAD_FILE:"downloadFile",MULTI:"multi",SET_VARS:"setVars",GET_VARS:"getVars",SET_USER_ATTRIBUTES:"setUserAttributes",SET_DEVICE_ATTRIBUTES:"setDeviceAttributes",UPLOAD_FILE:"uploadFile",REGISTER_DEVICE:"registerDevice"},SDK_VERSION:"1.4.0",CLIENT:"js",PARAMS:{ACTION:"action",APP_ID:"appId",CLIENT:"client",CLIENT_KEY:"clientKey",DEVICE_ID:"deviceId",SDK_VERSION:"sdkVersion",USER_ID:"userId",NEW_USER_ID:"newUserId",DEV_MODE:"devMode",VERSION_NAME:"versionName",SYSTEM_NAME:"systemName",SYSTEM_VERSION:"systemVersion",BROWSER_NAME:"browserName",BROWSER_VERSION:"browserVersion",DEVICE_NAME:"deviceName",DEVICE_MODEL:"deviceModel",USER_ATTRIBUTES:"userAttributes",LOCALE:"locale",COUNTRY:"country",REGION:"region",CITY:"city",LOCATION:"location",STATE:"state",INFO:"info",EVENT:"event",VALUE:"value",FILENAME:"filename",TIME:"time",DATA:"data",VARS:"vars",FILE:"file",SIZE:"size",VARIATION:"variation",HASH:"hash",EMAIL:"email",VARIABLES:"vars",PARAMS:"params",INCLUDE_DEFAULTS:"includeDefaults",INCLUDE_VARIANT_DEBUG_INFO:"includeVariantDebugInfo",WEB_PUSH_SUBSCRIPTION:"webPushSubscription"},KEYS:{IS_REGISTERED:"isRegistered",LATEST_VERSION:"latestVersion",VARS:"vars",VARIANTS:"variants",VARIANT_DEBUG_INFO:"variantDebugInfo",ACTION_METADATA:"actionMetadata",TOKEN:"token"},DEFAULT_KEYS:{COUNT:"__leanplum_unsynced",ITEM:"__leanplum_unsynced_",VARIABLES:"__leanplum_variables",VARIANTS:"__leanplum_variants",VARIANT_DEBUG_INFO:"__leanplum_variant_debug_info",ACTION_METADATA:"__leanplum_action_metadata",TOKEN:"__leanplum_token",DEVICE_ID:"__leanplum_device_id",USER_ID:"__leanplum_user_id",PUSH_SUBSCRIPTION:"__leanplum_push_subscription"},VALUES:{DETECT:"(detect)"}}},function(e,t,n){var r=n(46),o=n(52);e.exports=function(e,t){var n=o(e,t);return r(n)?n:void 0}},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(n(1)),a=(i.prototype.add=function(e,t){return void 0===t||(this.argString&&(this.argString+="&"),this.argString+=e+"="+encodeURIComponent(t),this.argValues[e]=t),this},i.prototype.body=function(e){return e?(this._body=e,this):this._body},i.prototype.attachApiKeys=function(e,t){return this.add(o.default.PARAMS.APP_ID,e).add(o.default.PARAMS.CLIENT,o.default.CLIENT).add(o.default.PARAMS.CLIENT_KEY,t)},i.prototype.build=function(){return this.argString},i.prototype.buildDict=function(){return this.argValues},i);function i(){this.argString="",this.argValues={}}t.default=a},function(e,t,n){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0});var o={},a=(i.getFromLocalStorage=function(e){return!1===r?o[e]:localStorage[e]},i.saveToLocalStorage=function(t,n){if(!1!==r)try{localStorage[t]=n}catch(e){r=!1,o[t]=n}else o[t]=n},i.removeFromLocalStorage=function(t){if(!1!==r)try{localStorage.removeItem(t)}catch(e){r=!1,delete o[t]}else delete o[t]},i);function i(){}t.default=a},function(e,t,n){var r=n(36),o=n(37),a=n(38),i=n(39),s=n(40);function u(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}u.prototype.clear=r,u.prototype.delete=o,u.prototype.get=a,u.prototype.has=i,u.prototype.set=s,e.exports=u},function(e,t,n){var r=n(16);e.exports=function(e,t){for(var n=e.length;n--;)if(r(e[n][0],t))return n;return-1}},function(e,t,n){var r=n(12),o=n(48),a=n(49),i=r?r.toStringTag:void 0;e.exports=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":(i&&i in Object(e)?o:a)(e)}},function(e,t,n){var r=n(2)(Object,"create");e.exports=r},function(e,t,n){var r=n(61);e.exports=function(e,t){var n=e.__data__;return r(t)?n["string"==typeof t?"string":"hash"]:n.map}},function(e,t){e.exports=function(e){return null!=e&&"object"==typeof e}},function(e,t,n){var r=n(2)(n(0),"Map");e.exports=r},function(e,t,n){var r=n(0).Symbol;e.exports=r},function(e,t){var n=Array.isArray;e.exports=n},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c=Function.prototype.apply,r=[],l=10,o=(f.setNetworkTimeout=function(e){l=e},f.ajax=function(e,t,n,r,o,a,i){if(a){if(f.runningRequest)return f.enqueueRequest(arguments);f.runningRequest=!0}if("undefined"!=typeof XDomainRequest)return"http:"===location.protocol&&0===t.indexOf("https:")&&(t="http:"+t.substring(6)),c.call(f.ajaxIE8,null,arguments);var s=!1,u=new XMLHttpRequest;u.onreadystatechange=function(){if(4===u.readyState){if(s)return;var e,t=!(s=!0);if(i)e=u.responseText;else try{e=JSON.parse(u.responseText)}catch(e){setTimeout(function(){o&&o(null,u)},0),t=!0}t||(200<=u.status&&u.status<300?setTimeout(function(){r&&r(e,u)},0):setTimeout(function(){o&&o(e,u)},0)),a&&(f.runningRequest=!1,f.dequeueRequest())}},u.open(e,t,!0),u.setRequestHeader("Content-Type","text/plain"),u.send(n),setTimeout(function(){s||u.abort()},1e3*l)},f.ajaxIE8=function(e,t,n,r,o,a,i){var s=new XDomainRequest;s.onload=function(){var e,t=!1;if(i)e=s.responseText;else try{e=JSON.parse(s.responseText)}catch(e){setTimeout(function(){o&&o(null,s)},0),t=!0}t||setTimeout(function(){r&&r(e,s)},0),a&&(f.runningRequest=!1,f.dequeueRequest())},s.onerror=s.ontimeout=function(){setTimeout(function(){o&&o(null,s)},0),a&&(f.runningRequest=!1,f.dequeueRequest())},s.onprogress=function(){},s.open(e,t),s.timeout=1e3*l,s.send(n)},f.enqueueRequest=function(e){r.push(e)},f.dequeueRequest=function(){var e=r.shift();e&&c.call(f.ajax,null,e)},f.runningRequest=!1,f);function f(){}t.default=o},function(e,t,n){var r=n(33);e.exports=function(e,t){return r(e,t)}},function(e,t){e.exports=function(e,t){return e===t||e!=e&&t!=t}},function(e,t,n){var r=n(7),o=n(19);e.exports=function(e){if(!o(e))return!1;var t=r(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}},function(n,e,t){(function(e){var t="object"==typeof e&&e&&e.Object===Object&&e;n.exports=t}).call(this,t(47))},function(e,t){e.exports=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}},function(e,t){var n=Function.prototype.toString;e.exports=function(e){if(null!=e){try{return n.call(e)}catch(e){}try{return e+""}catch(e){}}return""}},function(e,t,n){var r=n(53),o=n(60),a=n(62),i=n(63),s=n(64);function u(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}u.prototype.clear=r,u.prototype.delete=o,u.prototype.get=a,u.prototype.has=i,u.prototype.set=s,e.exports=u},function(e,t,n){var S=n(65),_=n(68),g=n(69);e.exports=function(e,t,n,r,o,a){var i=1&n,s=e.length,u=t.length;if(s!=u&&!(i&&s<u))return!1;var c=a.get(e);if(c&&a.get(t))return c==t;var l=-1,f=!0,d=2&n?new S:void 0;for(a.set(e,t),a.set(t,e);++l<s;){var p=e[l],h=t[l];if(r)var v=i?r(h,p,l,t,e,a):r(p,h,l,e,t,a);if(void 0!==v){if(v)continue;f=!1;break}if(d){if(!_(t,function(e,t){if(!g(d,t)&&(p===e||o(p,e,n,r,a)))return d.push(t)})){f=!1;break}}else if(p!==h&&!o(p,h,n,r,a)){f=!1;break}}return a.delete(e),a.delete(t),f}},function(e,s,u){(function(e){var t=u(0),n=u(86),r=s&&!s.nodeType&&s,o=r&&"object"==typeof e&&e&&!e.nodeType&&e,a=o&&o.exports===r?t.Buffer:void 0,i=(a?a.isBuffer:void 0)||n;e.exports=i}).call(this,u(24)(e))},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,n){var r=n(88),o=n(89),a=n(90),i=a&&a.isTypedArray,s=i?o(i):r;e.exports=s},function(e,t){e.exports=function(e){return"number"==typeof e&&-1<e&&e%1==0&&e<=9007199254740991}},function(e,t,n){var r=n(28);e.exports=r.default},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var a=o(n(3)),i=o(n(29)),s=o(n(1)),u=o(n(30)),c=o(n(31)),l=o(n(32)),f=o(n(4)),d=o(n(102)),p=o(n(103)),h=new i.default(window),v=(S.setApiPath=function(e){S._lpRequest.apiPath&&(S._lpRequest.apiPath=e)},S.setEmail=function(e){S._email=e},S.setNetworkTimeout=function(e){S._lpRequest.setNetworkTimeout(e)},S.setVariantDebugInfoEnabled=function(e){S._internalState.variantDebugInfoEnabled=e},S.getVariantDebugInfo=function(){return S._varCache.getVariantDebugInfo()},S.setAppIdForDevelopmentMode=function(e,t){S._lpRequest.appId=e,S._lpRequest.clientKey=t,S._internalState.devMode=!0},S.setAppIdForProductionMode=function(e,t){S._lpRequest.appId=e,S._lpRequest.clientKey=t,S._internalState.devMode=!1},S.setSocketHost=function(e){S._lpSocket.setSocketHost(e)},S.setDeviceId=function(e){S._lpRequest.deviceId=e},S.setAppVersion=function(e){S._lpRequest.versionName=e},S.setDeviceName=function(e){S._deviceName=e},S.setDeviceModel=function(e){S._deviceModel=e},S.setRequestBatching=function(e,t){S._lpRequest.batchEnabled=e,S._lpRequest.batchCooldown=t},S.setSystemName=function(e){S._systemName=e},S.setSystemVersion=function(e){S._systemVersion=e},S.setVariables=function(e){S._varCache.setVariables(e)},S.getVariables=function(){return S._varCache.getVariables()},S.getVariable=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n=S.getVariables(),r=0;r<e.length;r++)n=n[e[r]];return n},S.getVariants=function(){return S._varCache.variants||[]},S.addStartResponseHandler=function(e){S._internalState.addStartResponseHandler(e)},S.removeStartResponseHandler=function(e){S._internalState.removeStartResponseHandler(e)},S.__destroy=function(){S._lpRequest=new c.default,S._internalState=new u.default,S._lpSocket=new l.default,S._pushManager=new d.default(S.createRequest),S._varCache=new p.default(S.createRequest)},S.addVariablesChangedHandler=function(e){S._varCache.addVariablesChangedHandler(e)},S.removeVariablesChangedHandler=function(e){S._varCache.removeVariablesChangedHandler(e)},S.forceContentUpdate=function(r){var e=(new a.default).add(s.default.PARAMS.INCLUDE_DEFAULTS,!1).add(s.default.PARAMS.INCLUDE_VARIANT_DEBUG_INFO,S._internalState.variantDebugInfoEnabled);S.createRequest(s.default.METHODS.GET_VARS,e,{queued:!1,sendNow:!0,response:function(e){var t=S._lpRequest.getLastResponse(e),n=S._lpRequest.isResponseSuccess(t);n&&(S._varCache.applyDiffs(t[s.default.KEYS.VARS],t[s.default.KEYS.VARIANTS],t[s.default.KEYS.ACTION_METADATA]),S._varCache.setVariantDebugInfo(t[s.default.KEYS.VARIANT_DEBUG_INFO])),r&&r(n)}})},S.start=function(e,t,n){"function"==typeof e?(n=e,t={},e=null):"object"==typeof e&&null!=e?(n=t,t=e,e=null):"function"==typeof t&&(n=t,t={}),S._lpRequest.userId=e,n&&S.addStartResponseHandler(n),S._varCache.onUpdate=function(){S._varCache.triggerVariablesChangedHandlers()};var r=(new a.default).add(s.default.PARAMS.USER_ATTRIBUTES,JSON.stringify(t)).add(s.default.PARAMS.COUNTRY,s.default.VALUES.DETECT).add(s.default.PARAMS.REGION,s.default.VALUES.DETECT).add(s.default.PARAMS.CITY,s.default.VALUES.DETECT).add(s.default.PARAMS.LOCATION,s.default.VALUES.DETECT).add(s.default.PARAMS.SYSTEM_NAME,S._systemName||h.OS).add(s.default.PARAMS.SYSTEM_VERSION,(S._systemVersion||"").toString()).add(s.default.PARAMS.BROWSER_NAME,h.browser).add(s.default.PARAMS.BROWSER_VERSION,h.version.toString()).add(s.default.PARAMS.LOCALE,s.default.VALUES.DETECT).add(s.default.PARAMS.DEVICE_NAME,S._deviceName||h.browser+" "+h.version).add(s.default.PARAMS.DEVICE_MODEL,S._deviceModel||"Web Browser").add(s.default.PARAMS.INCLUDE_DEFAULTS,!1).add(s.default.PARAMS.INCLUDE_VARIANT_DEBUG_INFO,S._internalState.variantDebugInfoEnabled);S.createRequest(s.default.METHODS.START,r,{queued:!0,sendNow:!0,response:function(e){S._internalState.hasStarted=!0;var t=S._lpRequest.getLastResponse(e);if(S._lpRequest.isResponseSuccess(t)){if(S._internalState.startSuccessful=!0,S._internalState.devMode){var n=t[s.default.KEYS.LATEST_VERSION];n&&console.log("A newer version of Leanplum, "+n+', is available.\nUse "npm update leanplum-sdk" or go to https://docs.leanplum.com/reference#javascript-setup to download it.'),S.connectSocket()}S._varCache.applyDiffs(t[s.default.KEYS.VARS],t[s.default.KEYS.VARIANTS],t[s.default.KEYS.ACTION_METADATA]),S._varCache.setVariantDebugInfo(t[s.default.KEYS.VARIANT_DEBUG_INFO]),S._varCache.token=t[s.default.KEYS.TOKEN]}else S._internalState.startSuccessful=!1,S._varCache.loadDiffs();S._internalState.triggerStartHandlers()}})},S.startFromCache=function(e,t,n){"function"==typeof e?(n=e,t={},e=null):"object"==typeof e&&null!=e?(n=t,t=e,e=null):"function"==typeof t&&(n=t,t={}),S._lpRequest.userId=e,n&&S.addStartResponseHandler(n),S._internalState.hasStarted=!0,S._internalState.startSuccessful=!0,S._internalState.devMode&&S.connectSocket(),S._varCache.loadDiffs(),S._internalState.triggerStartHandlers()},S.stop=function(){S.createRequest(s.default.METHODS.STOP,void 0,{sendNow:!0,queued:!0})},S.pauseSession=function(){S.createRequest(s.default.METHODS.PAUSE_SESSION,void 0,{sendNow:!0,queued:!0})},S.resumeSession=function(){S.createRequest(s.default.METHODS.RESUME_SESSION,void 0,{sendNow:!0,queued:!0})},S.pauseState=function(){S.createRequest(s.default.METHODS.PAUSE_STATE,void 0,{queued:!0})},S.resumeState=function(){S.createRequest(s.default.METHODS.RESUME_STATE,void 0,{queued:!0})},S.setUserId=function(e){S.setUserAttributes(e)},S.setUserAttributes=function(e,t){if(void 0===t)if("object"==typeof e)t=e,e=void 0;else if("string"!=typeof e)return void console.log("Leanplum: setUserAttributes expects a string or an object");var n=(new a.default).add(s.default.PARAMS.USER_ATTRIBUTES,t?JSON.stringify(t):void 0).add(s.default.PARAMS.NEW_USER_ID,e);S.createRequest(s.default.METHODS.SET_USER_ATTRIBUTES,n,{queued:!0}),e&&(S._lpRequest.userId=e,f.default.saveToLocalStorage(s.default.DEFAULT_KEYS.USER_ID,S._lpRequest.userId))},S.track=function(e,t,n,r){"object"==typeof t&&null!=t?(r=t,t=n=void 0):"string"==typeof t?(r=n,n=t,t=void 0):"object"==typeof n&&null!=n&&(r=n,n=void 0);var o=(new a.default).add(s.default.PARAMS.EVENT,e).add(s.default.PARAMS.VALUE,t||0).add(s.default.PARAMS.INFO,n).add(s.default.PARAMS.PARAMS,JSON.stringify(r));S.createRequest(s.default.METHODS.TRACK,o,{queued:!0})},S.advanceTo=function(e,t,n){"object"==typeof t&&null!=t&&(n=t,t=void 0);var r=(new a.default).add(s.default.PARAMS.STATE,e).add(s.default.PARAMS.INFO,t).add(s.default.PARAMS.PARAMS,JSON.stringify(n));S.createRequest(s.default.METHODS.ADVANCE,r,{queued:!0})},S.isWebPushSupported=function(){return S._pushManager.isWebPushSupported()},S.isWebPushSubscribed=function(){return S._pushManager.isWebPushSubscribed()},S.registerForWebPush=function(e){return S._pushManager.isWebPushSupported()?S._pushManager.register(e,function(e){return e?Promise.resolve(!0):S._pushManager.subscribeUser()}):Promise.reject("Leanplum: WebPush is not supported.")},S.unregisterFromWebPush=function(){return S._pushManager.unsubscribeUser()},S.clearUserContent=function(){S._varCache.clearUserContent()},S.createRequest=function(e,t,n){void 0===n&&(n={}),S._lpRequest.request(e,t,r({devMode:S._internalState.devMode},n))},S.connectSocket=function(){S._lpSocket.connect(S._varCache,{appId:S._lpRequest.appId,deviceId:S._lpRequest.deviceId},S.createRequest,S._lpRequest.getLastResponse)},S._internalState=new u.default,S._lpRequest=new c.default,S._lpSocket=new l.default,S._pushManager=new d.default(S.createRequest),S._varCache=new p.default(S.createRequest),S);function S(){}t.default=v},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(o.prototype.searchString=function(e){for(var t=0;t<e.length;t++){var n=e[t].string,r=e[t].prop;if(this.versionSearchString=e[t].versionSearch||e[t].identity,n){if(-1!==n.indexOf(e[t].subString))return e[t].identity}else if(r)return e[t].identity}},o.prototype.searchVersion=function(e){if(e){var t=e.indexOf(this.versionSearchString);if(-1!==t)return parseFloat(e.substring(t+this.versionSearchString.length+1))}},o.prototype.getBrowserData=function(e){return[{string:e.navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:e.navigator.userAgent,subString:"OmniWeb",identity:"OmniWeb",versionSearch:"OmniWeb/"},{string:e.navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:e.opera,identity:"Opera",versionSearch:"Version"},{string:e.navigator.vendor,subString:"iCab",identity:"iCab"},{string:e.navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:e.navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:e.navigator.vendor,subString:"Camino",identity:"Camino"},{string:e.navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:e.navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:e.navigator.userAgent,subString:"Android",identity:"Android Browser",versionSearch:"Version"},{string:e.navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:e.navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}]},o.prototype.getOSData=function(e){return[{string:e.navigator.platform,subString:"Win",identity:"Windows"},{string:e.navigator.platform,subString:"Mac",identity:"Mac OS"},{string:e.navigator.userAgent,subString:"iPhone",identity:"iOS"},{string:e.navigator.userAgent,subString:"Android",identity:"Android"},{string:e.navigator.platform,subString:"Linux",identity:"Linux"}]},o);function o(e){this.browser=this.searchString(this.getBrowserData(e))||"Unknown Browser",this.version=this.searchVersion(e.navigator.userAgent)||this.searchVersion(e.navigator.appVersion)||"Unknown Version",this.OS=this.searchString(this.getOSData(e))||"Unknown OS"}t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(o.prototype.addStartResponseHandler=function(e){this.startHandlers.push(e),this.hasStarted&&e(this.startSuccessful)},o.prototype.removeStartResponseHandler=function(e){var t=this.startHandlers.indexOf(e);0<=t&&this.startHandlers.splice(t,1)},o.prototype.triggerStartHandlers=function(){for(var e=0;e<this.startHandlers.length;e++)this.startHandlers[e](this.startSuccessful)},o);function o(){this.startHandlers=[],this.devMode=!1,this.hasStarted=!1,this.startSuccessful=!1,this.variantDebugInfoEnabled=!1}t.default=r},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var h=r(n(3)),v=r(n(1)),o=r(n(4)),S=r(n(14)),a=(i.prototype.request=function(e,t,r){var o=this;if(void 0===r&&(r={}),r=r||{},t=t||new h.default,this.deviceId||(this.deviceId=this.loadLocal(v.default.DEFAULT_KEYS.DEVICE_ID)),!this.deviceId){for(var n="",a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=0;i<16;i++)n+=a.charAt(Math.floor(Math.random()*a.length));this.deviceId=n,this.saveLocal(v.default.DEFAULT_KEYS.DEVICE_ID,n)}this.userId||(this.userId=this.loadLocal(v.default.DEFAULT_KEYS.USER_ID),this.userId||(this.userId=this.deviceId)),this.saveLocal(v.default.DEFAULT_KEYS.USER_ID,this.userId);var s=t.attachApiKeys(this.appId,this.clientKey).add(v.default.PARAMS.SDK_VERSION,v.default.SDK_VERSION).add(v.default.PARAMS.DEVICE_ID,this.deviceId).add(v.default.PARAMS.USER_ID,this.userId).add(v.default.PARAMS.ACTION,e).add(v.default.PARAMS.VERSION_NAME,this.versionName).add(v.default.PARAMS.DEV_MODE,r.devMode).add(v.default.PARAMS.TIME,((new Date).getTime()/1e3).toString()),u=r.success||r.response,c=r.error||r.response;if(!this.appId||!this.clientKey){var l="Leanplum App ID and client key are not set. Make sure you are calling setAppIdForDevelopmentMode or setAppIdForProductionMode before issuing API calls.";return console.error(l),void(c&&c(l))}if(t.body())S.default.ajax("POST",this.apiPath+"?"+s.build(),t.body(),u,c,r.queued);else{var f=r.devMode||r.sendNow||!this.batchEnabled,d=function(){var e=o.popUnsentRequests();if(0<e.length){var t=JSON.stringify({data:e}),n=(new h.default).attachApiKeys(o.appId,o.clientKey).add(v.default.PARAMS.SDK_VERSION,v.default.SDK_VERSION).add(v.default.PARAMS.ACTION,v.default.METHODS.MULTI).add(v.default.PARAMS.TIME,((new Date).getTime()/1e3).toString().toString()).build();S.default.ajax("POST",o.apiPath+"?"+n,t,u,c,r.queued)}};if(!f&&this.batchCooldown){var p=(new Date).getTime()/1e3;!this.lastRequestTime||p-this.lastRequestTime>=this.batchCooldown?(f=!0,this.lastRequestTime=p):this.cooldownTimeout||(this.cooldownTimeout=setTimeout(function(){o.cooldownTimeout=null,o.lastRequestTime=(new Date).getTime()/1e3,d()},1e3*(this.batchCooldown-(p-this.lastRequestTime))))}this.saveRequestForLater(s.buildDict()),f&&d()}},i.prototype.setNetworkTimeout=function(e){S.default.setNetworkTimeout(e)},i.prototype.getLastResponse=function(e){var t,n,r,o=null!=(n=null===(t=null==e?void 0:e.response)||void 0===t?void 0:t.length)?n:0;return 0<o?null===(r=null==e?void 0:e.response)||void 0===r?void 0:r[o-1]:null},i.prototype.isResponseSuccess=function(e){return Boolean(null==e?void 0:e.success)},i.prototype.saveRequestForLater=function(e){var t=this.loadLocal(v.default.DEFAULT_KEYS.COUNT)||0,n=v.default.DEFAULT_KEYS.ITEM+t;this.saveLocal(n,JSON.stringify(e)),t++,this.saveLocal(v.default.DEFAULT_KEYS.COUNT,t)},i.prototype.popUnsentRequests=function(){var e=[],t=this.loadLocal(v.default.DEFAULT_KEYS.COUNT)||0;this.removeLocal(v.default.DEFAULT_KEYS.COUNT);for(var n=0;n<t;n++){var r=v.default.DEFAULT_KEYS.ITEM+n;try{e.push(JSON.parse(this.loadLocal(r)))}catch(e){}this.removeLocal(r)}return e},i.prototype.loadLocal=function(e){return o.default.getFromLocalStorage(e)},i.prototype.saveLocal=function(e,t){o.default.saveToLocalStorage(e,t)},i.prototype.removeLocal=function(e){o.default.removeFromLocalStorage(e)},i);function i(){this.lastRequestTime=void 0,this.cooldownTimeout=null,this.apiPath="https://www.leanplum.com/api",this.batchCooldown=5,this.batchEnabled=!0}t.default=a},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var s=r(n(15)),u=r(n(3)),c=r(n(1)),l=r(n(101)),o=(a.prototype.connect=function(a,t,r,i){var e=this;if(WebSocket){var o=new l.default,n=!1;o.onopen=function(){var e;n||(console.log("Leanplum: Connected to development server."),o.send("auth",((e={})[c.default.PARAMS.APP_ID]=t.appId,e[c.default.PARAMS.DEVICE_ID]=t.deviceId,e)),n=!0)},o.onerror=function(e){console.log("Leanplum: Socket error",e)},o.onmessage=function(e,t){if("updateVars"===e){var n=(new u.default).add(c.default.PARAMS.INCLUDE_DEFAULTS,!1);r(c.default.METHODS.GET_VARS,n,{queued:!1,sendNow:!0,response:function(e){var t=i(e),n=t[c.default.KEYS.VARS],r=t[c.default.KEYS.VARIANTS],o=t[c.default.KEYS.ACTION_METADATA];s.default(n,a.diffs)||a.applyDiffs(n,r,o)}})}else"getVariables"===e?(a.sendVariables(),o.send("getContentResponse",{updated:!0})):"getActions"===e?o.send("getContentResponse",{updated:!1}):"registerDevice"===e&&alert("Your device has been registered to "+t[0].email+".")},o.onclose=function(){console.log("Leanplum: Disconnected to development server."),n=!1},o.connect(this.socketHost),setInterval(function(){o.connected||o.connecting||o.connect(e.socketHost)},5e3)}else console.log("Your browser doesn't support WebSockets.")},a.prototype.setSocketHost=function(e){this.socketHost=e},a);function a(){this.socketHost="dev.leanplum.com"}t.default=o},function(e,t,n){var i=n(34),s=n(10);e.exports=function e(t,n,r,o,a){return t===n||(null==t||null==n||!s(t)&&!s(n)?t!=t&&n!=n:i(t,n,r,o,e,a))}},function(e,t,n){var v=n(35),S=n(22),_=n(70),g=n(74),b=n(96),y=n(13),A=n(23),E=n(25),R="[object Object]",T=Object.prototype.hasOwnProperty;e.exports=function(e,t,n,r,o,a){var i=y(e),s=y(t),u=i?"[object Array]":b(e),c=s?"[object Array]":b(t),l=(u="[object Arguments]"==u?R:u)==R,f=(c="[object Arguments]"==c?R:c)==R,d=u==c;if(d&&A(e)){if(!A(t))return!1;l=!(i=!0)}if(d&&!l)return a=a||new v,i||E(e)?S(e,t,n,r,o,a):_(e,t,u,n,r,o,a);if(!(1&n)){var p=l&&T.call(e,"__wrapped__"),h=f&&T.call(t,"__wrapped__");if(p||h)return o(p?e.value():e,h?t.value():t,n,r,a=a||new v)}return!!d&&(a=a||new v,g(e,t,n,r,o,a))}},function(e,t,n){var r=n(5),o=n(41),a=n(42),i=n(43),s=n(44),u=n(45);function c(e){var t=this.__data__=new r(e);this.size=t.size}c.prototype.clear=o,c.prototype.delete=a,c.prototype.get=i,c.prototype.has=s,c.prototype.set=u,e.exports=c},function(e,t){e.exports=function(){this.__data__=[],this.size=0}},function(e,t,n){var r=n(6),o=Array.prototype.splice;e.exports=function(e){var t=this.__data__,n=r(t,e);return!(n<0||(n==t.length-1?t.pop():o.call(t,n,1),--this.size,0))}},function(e,t,n){var r=n(6);e.exports=function(e){var t=this.__data__,n=r(t,e);return n<0?void 0:t[n][1]}},function(e,t,n){var r=n(6);e.exports=function(e){return-1<r(this.__data__,e)}},function(e,t,n){var o=n(6);e.exports=function(e,t){var n=this.__data__,r=o(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this}},function(e,t,n){var r=n(5);e.exports=function(){this.__data__=new r,this.size=0}},function(e,t){e.exports=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n}},function(e,t){e.exports=function(e){return this.__data__.get(e)}},function(e,t){e.exports=function(e){return this.__data__.has(e)}},function(e,t,n){var o=n(5),a=n(11),i=n(21);e.exports=function(e,t){var n=this.__data__;if(n instanceof o){var r=n.__data__;if(!a||r.length<199)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new i(r)}return n.set(e,t),this.size=n.size,this}},function(e,t,n){var r=n(17),o=n(50),a=n(19),i=n(20),s=/^\[object .+?Constructor\]$/,u=Function.prototype,c=Object.prototype,l=u.toString,f=c.hasOwnProperty,d=RegExp("^"+l.call(f).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");e.exports=function(e){return!(!a(e)||o(e))&&(r(e)?d:s).test(i(e))}},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){var r=n(12),o=Object.prototype,a=o.hasOwnProperty,i=o.toString,s=r?r.toStringTag:void 0;e.exports=function(e){var t=a.call(e,s),n=e[s];try{var r=!(e[s]=void 0)}catch(e){}var o=i.call(e);return r&&(t?e[s]=n:delete e[s]),o}},function(e,t){var n=Object.prototype.toString;e.exports=function(e){return n.call(e)}},function(e,t,n){var r,o=n(51),a=(r=/[^.]+$/.exec(o&&o.keys&&o.keys.IE_PROTO||""))?"Symbol(src)_1."+r:"";e.exports=function(e){return!!a&&a in e}},function(e,t,n){var r=n(0)["__core-js_shared__"];e.exports=r},function(e,t){e.exports=function(e,t){return null==e?void 0:e[t]}},function(e,t,n){var r=n(54),o=n(5),a=n(11);e.exports=function(){this.size=0,this.__data__={hash:new r,map:new(a||o),string:new r}}},function(e,t,n){var r=n(55),o=n(56),a=n(57),i=n(58),s=n(59);function u(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}u.prototype.clear=r,u.prototype.delete=o,u.prototype.get=a,u.prototype.has=i,u.prototype.set=s,e.exports=u},function(e,t,n){var r=n(8);e.exports=function(){this.__data__=r?r(null):{},this.size=0}},function(e,t){e.exports=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}},function(e,t,n){var r=n(8),o=Object.prototype.hasOwnProperty;e.exports=function(e){var t=this.__data__;if(r){var n=t[e];return"__lodash_hash_undefined__"===n?void 0:n}return o.call(t,e)?t[e]:void 0}},function(e,t,n){var r=n(8),o=Object.prototype.hasOwnProperty;e.exports=function(e){var t=this.__data__;return r?void 0!==t[e]:o.call(t,e)}},function(e,t,n){var r=n(8);e.exports=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=r&&void 0===t?"__lodash_hash_undefined__":t,this}},function(e,t,n){var r=n(9);e.exports=function(e){var t=r(this,e).delete(e);return this.size-=t?1:0,t}},function(e,t){e.exports=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}},function(e,t,n){var r=n(9);e.exports=function(e){return r(this,e).get(e)}},function(e,t,n){var r=n(9);e.exports=function(e){return r(this,e).has(e)}},function(e,t,n){var o=n(9);e.exports=function(e,t){var n=o(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this}},function(e,t,n){var r=n(21),o=n(66),a=n(67);function i(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new r;++t<n;)this.add(e[t])}i.prototype.add=i.prototype.push=o,i.prototype.has=a,e.exports=i},function(e,t){e.exports=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this}},function(e,t){e.exports=function(e){return this.__data__.has(e)}},function(e,t){e.exports=function(e,t){for(var n=-1,r=null==e?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1}},function(e,t){e.exports=function(e,t){return e.has(t)}},function(e,t,n){var r=n(12),f=n(71),d=n(16),p=n(22),h=n(72),v=n(73),o=r?r.prototype:void 0,S=o?o.valueOf:void 0;e.exports=function(e,t,n,r,o,a,i){switch(n){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":return!(e.byteLength!=t.byteLength||!a(new f(e),new f(t)));case"[object Boolean]":case"[object Date]":case"[object Number]":return d(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var s=h;case"[object Set]":var u=1&r;if(s=s||v,e.size!=t.size&&!u)return!1;var c=i.get(e);if(c)return c==t;r|=2,i.set(e,t);var l=p(s(e),s(t),r,o,a,i);return i.delete(e),l;case"[object Symbol]":if(S)return S.call(e)==S.call(t)}return!1}},function(e,t,n){var r=n(0).Uint8Array;e.exports=r},function(e,t){e.exports=function(e){var n=-1,r=Array(e.size);return e.forEach(function(e,t){r[++n]=[t,e]}),r}},function(e,t){e.exports=function(e){var t=-1,n=Array(e.size);return e.forEach(function(e){n[++t]=e}),n}},function(e,t,n){var b=n(75),y=Object.prototype.hasOwnProperty;e.exports=function(e,t,n,r,o,a){var i=1&n,s=b(e),u=s.length;if(u!=b(t).length&&!i)return!1;for(var c=u;c--;){var l=s[c];if(!(i?l in t:y.call(t,l)))return!1}var f=a.get(e);if(f&&a.get(t))return f==t;var d=!0;a.set(e,t),a.set(t,e);for(var p=i;++c<u;){var h=e[l=s[c]],v=t[l];if(r)var S=i?r(v,h,l,t,e,a):r(h,v,l,e,t,a);if(!(void 0===S?h===v||o(h,v,n,r,a):S)){d=!1;break}p=p||"constructor"==l}if(d&&!p){var _=e.constructor,g=t.constructor;_!=g&&"constructor"in e&&"constructor"in t&&!("function"==typeof _&&_ instanceof _&&"function"==typeof g&&g instanceof g)&&(d=!1)}return a.delete(e),a.delete(t),d}},function(e,t,n){var r=n(76),o=n(78),a=n(81);e.exports=function(e){return r(e,a,o)}},function(e,t,n){var o=n(77),a=n(13);e.exports=function(e,t,n){var r=t(e);return a(e)?r:o(r,n(e))}},function(e,t){e.exports=function(e,t){for(var n=-1,r=t.length,o=e.length;++n<r;)e[o+n]=t[n];return e}},function(e,t,n){var r=n(79),o=n(80),a=Object.prototype.propertyIsEnumerable,i=Object.getOwnPropertySymbols,s=i?function(t){return null==t?[]:(t=Object(t),r(i(t),function(e){return a.call(t,e)}))}:o;e.exports=s},function(e,t){e.exports=function(e,t){for(var n=-1,r=null==e?0:e.length,o=0,a=[];++n<r;){var i=e[n];t(i,n,e)&&(a[o++]=i)}return a}},function(e,t){e.exports=function(){return[]}},function(e,t,n){var r=n(82),o=n(91),a=n(95);e.exports=function(e){return(a(e)?r:o)(e)}},function(e,t,n){var l=n(83),f=n(84),d=n(13),p=n(23),h=n(87),v=n(25),S=Object.prototype.hasOwnProperty;e.exports=function(e,t){var n=d(e),r=!n&&f(e),o=!n&&!r&&p(e),a=!n&&!r&&!o&&v(e),i=n||r||o||a,s=i?l(e.length,String):[],u=s.length;for(var c in e)!t&&!S.call(e,c)||i&&("length"==c||o&&("offset"==c||"parent"==c)||a&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||h(c,u))||s.push(c);return s}},function(e,t){e.exports=function(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}},function(e,t,n){var r=n(85),o=n(10),a=Object.prototype,i=a.hasOwnProperty,s=a.propertyIsEnumerable,u=r(function(){return arguments}())?r:function(e){return o(e)&&i.call(e,"callee")&&!s.call(e,"callee")};e.exports=u},function(e,t,n){var r=n(7),o=n(10);e.exports=function(e){return o(e)&&"[object Arguments]"==r(e)}},function(e,t){e.exports=function(){return!1}},function(e,t){var r=/^(?:0|[1-9]\d*)$/;e.exports=function(e,t){var n=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==n||"symbol"!=n&&r.test(e))&&-1<e&&e%1==0&&e<t}},function(e,t,n){var r=n(7),o=n(26),a=n(10),i={};i["[object Float32Array]"]=i["[object Float64Array]"]=i["[object Int8Array]"]=i["[object Int16Array]"]=i["[object Int32Array]"]=i["[object Uint8Array]"]=i["[object Uint8ClampedArray]"]=i["[object Uint16Array]"]=i["[object Uint32Array]"]=!0,i["[object Arguments]"]=i["[object Array]"]=i["[object ArrayBuffer]"]=i["[object Boolean]"]=i["[object DataView]"]=i["[object Date]"]=i["[object Error]"]=i["[object Function]"]=i["[object Map]"]=i["[object Number]"]=i["[object Object]"]=i["[object RegExp]"]=i["[object Set]"]=i["[object String]"]=i["[object WeakMap]"]=!1,e.exports=function(e){return a(e)&&o(e.length)&&!!i[r(e)]}},function(e,t){e.exports=function(t){return function(e){return t(e)}}},function(e,i,s){(function(e){var t=s(18),n=i&&!i.nodeType&&i,r=n&&"object"==typeof e&&e&&!e.nodeType&&e,o=r&&r.exports===n&&t.process,a=function(){try{return r&&r.require&&r.require("util").types||o&&o.binding&&o.binding("util")}catch(e){}}();e.exports=a}).call(this,s(24)(e))},function(e,t,n){var r=n(92),o=n(93),a=Object.prototype.hasOwnProperty;e.exports=function(e){if(!r(e))return o(e);var t=[];for(var n in Object(e))a.call(e,n)&&"constructor"!=n&&t.push(n);return t}},function(e,t){var n=Object.prototype;e.exports=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||n)}},function(e,t,n){var r=n(94)(Object.keys,Object);e.exports=r},function(e,t){e.exports=function(t,n){return function(e){return t(n(e))}}},function(e,t,n){var r=n(17),o=n(26);e.exports=function(e){return null!=e&&o(e.length)&&!r(e)}},function(e,t,n){var r=n(97),o=n(11),a=n(98),i=n(99),s=n(100),u=n(7),c=n(20),l=c(r),f=c(o),d=c(a),p=c(i),h=c(s),v=u;(r&&"[object DataView]"!=v(new r(new ArrayBuffer(1)))||o&&"[object Map]"!=v(new o)||a&&"[object Promise]"!=v(a.resolve())||i&&"[object Set]"!=v(new i)||s&&"[object WeakMap]"!=v(new s))&&(v=function(e){var t=u(e),n="[object Object]"==t?e.constructor:void 0,r=n?c(n):"";if(r)switch(r){case l:return"[object DataView]";case f:return"[object Map]";case d:return"[object Promise]";case p:return"[object Set]";case h:return"[object WeakMap]"}return t}),e.exports=v},function(e,t,n){var r=n(2)(n(0),"DataView");e.exports=r},function(e,t,n){var r=n(2)(n(0),"Promise");e.exports=r},function(e,t,n){var r=n(2)(n(0),"Set");e.exports=r},function(e,t,n){var r=n(2)(n(0),"WeakMap");e.exports=r},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(n(14)),a=(i.prototype.connect=function(a){var s=this;s.connecting=!0,o.default.ajax("POST","https://"+a+"/socket.io/1","",function(e){var t=e.split(":"),n=t[0],r=parseInt(t[1])/2*1e3;s.socket=new WebSocket("wss://"+a+"/socket.io/1/websocket/"+n);var o=null;s.socket.onopen=function(){s.connected=!0,s.connecting=!1,s.onopen&&s.onopen(),o=setInterval(function(){s.socket.send("2:::")},r)},s.socket.onclose=function(){s.connected=!1,clearInterval(o),s.onclose&&s.onclose()},s.socket.onmessage=function(e){var t=e.data.split(":"),n=parseInt(t[0]);if(2===n)s.socket.send("2::");else if(5===n){var r=t[1],o=JSON.parse(t.slice(3).join(":")),a=o.name,i=o.args;r&&s.socket.send("6:::"+r),s.onmessage&&s.onmessage(a,i)}else 7===n&&console.log("Socket error: "+e.data)},s.socket.onerror=function(e){s.socket.close(),s.onerror&&s.onerror(e)}},null,!1,!0)},i.prototype.send=function(e,t){if(this.connected){var n=JSON.stringify({name:e,args:t});this.socket.send("5:::"+n)}else console.log("Leanplum: Socket is not connected.")},i);function i(){this.connected=!1,this.connecting=!1,this.connected=!1,this.connecting=!1}t.default=a},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,i,s,u){return new(s=s||Promise)(function(n,t){function r(e){try{a(u.next(e))}catch(e){t(e)}}function o(e){try{a(u.throw(e))}catch(e){t(e)}}function a(e){var t;e.done?n(e.value):((t=e.value)instanceof s?t:new s(function(e){e(t)})).then(r,o)}a((u=u.apply(e,i||[])).next())})},s=this&&this.__generator||function(n,r){var o,a,i,e,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,a&&(i=2&t[0]?a.return:t[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,t[1])).done)return i;switch(a=0,i&&(t=[2&t[0],i.value]),t[0]){case 0:case 1:i=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,a=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(i=0<(i=s.trys).length&&i[i.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!i||t[1]>i[0]&&t[1]<i[3])){s.label=t[1];break}if(6===t[0]&&s.label<i[1]){s.label=i[1],i=t;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(t);break}i[2]&&s.ops.pop(),s.trys.pop();continue}t=r.call(n,s)}catch(e){t=[6,e],a=0}finally{o=i=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var a=o(n(15)),i=o(n(3)),u=o(n(1)),c=o(n(4)),l=(Object.defineProperty(f.prototype,"serviceWorker",{get:function(){return window.navigator.serviceWorker},enumerable:!0,configurable:!0}),f.prototype.isWebPushSupported=function(){var e;return Boolean(void 0!==(null===(e=window)||void 0===e?void 0:e.navigator)&&"serviceWorker"in window.navigator&&"PushManager"in window)},f.prototype.isWebPushSubscribed=function(){return r(this,void 0,void 0,function(){var t,n,r;return s(this,function(e){switch(e.label){case 0:return this.isWebPushSupported()?[4,this.getServiceWorkerRegistration()]:[2,!1];case 1:return(t=e.sent())?[4,t.pushManager.getSubscription()]:[2,!1];case 2:return n=e.sent(),(r=null!==n)&&this.updateNewSubscriptionOnServer(n),[2,r]}})})},f.prototype.register=function(a,i){return r(this,void 0,void 0,function(){var t,n,r,o;return s(this,function(e){switch(e.label){case 0:if(!this.isWebPushSupported())return console.log("Leanplum: Push messaging is not supported."),[2,i(!1)];e.label=1;case 1:return e.trys.push([1,3,,4]),[4,(t=this).serviceWorker.register(a||"/sw.min.js",null)];case 2:return t.serviceWorkerRegistration=e.sent(),n=this.serviceWorkerRegistration.pushManager.getSubscription(),(r=null!==n)&&this.updateNewSubscriptionOnServer(n),[2,i(r)];case 3:return o=e.sent(),console.log("Leanplum: Service Worker Error: ",o),[2,i(!1)];case 4:return[2]}})})},f.prototype.subscribeUser=function(){return r(this,void 0,void 0,function(){var t,n,r;return s(this,function(e){switch(e.label){case 0:t=this.urlB64ToUint8Array("BInWPpWntfR39rgXSP04pqdmEdDGa50z6zqbMvxyxJCwzXIuSpSh8C888-CfJ82WELl7Xe8cjAnfCt-3vK0Ci68"),e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this.serviceWorkerRegistration.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:t})];case 2:if(!(n=e.sent()))throw new Error;return this.updateNewSubscriptionOnServer(n),[3,4];case 3:throw r=e.sent(),new Error("Leanplum: Failed to subscribe the user: "+r);case 4:return[2,!0]}})})},f.prototype.unsubscribeUser=function(){return r(this,void 0,void 0,function(){var t,n;return s(this,function(e){switch(e.label){case 0:return[4,this.isWebPushSubscribed()];case 1:if(!e.sent())return[3,6];e.label=2;case 2:return e.trys.push([2,5,,6]),[4,this.serviceWorkerRegistration.pushManager.getSubscription()];case 3:if(!(t=e.sent()))throw new Error;return[4,t.unsubscribe()];case 4:return e.sent(),[3,6];case 5:throw n=e.sent(),new Error("Leanplum: Error unsubscribing: "+n);case 6:return[2]}})})},f.prototype.getServiceWorkerRegistration=function(){return r(this,void 0,void 0,function(){var t;return s(this,function(e){switch(e.label){case 0:return this.serviceWorkerRegistration?[3,2]:[4,(t=this).serviceWorker.getRegistration()];case 1:t.serviceWorkerRegistration=e.sent(),e.label=2;case 2:return[2,this.serviceWorkerRegistration]}})})},f.prototype.urlB64ToUint8Array=function(e){for(var t=(e+"=".repeat((4-e.length%4)%4)).replace(/-/g,"+").replace(/_/g,"/"),n=this.decodeData(t),r=new Uint8Array(n.length),o=0;o<n.length;++o)r[o]=n.charCodeAt(o);return r},f.prototype.prepareSubscription=function(e){var t=Function.prototype.apply,n=e.getKey?e.getKey("p256dh"):"",r=e.getKey?e.getKey("auth"):"",o=this.encodeData(t.call(String.fromCharCode,null,new Uint8Array(n))),a=this.encodeData(t.call(String.fromCharCode,null,new Uint8Array(r)));return{endpoint:e.endpoint,key:o,auth:a}},f.prototype.updateNewSubscriptionOnServer=function(e){if(e){var t=this.prepareSubscription(e),n=JSON.stringify(t),r=c.default.getFromLocalStorage(u.default.DEFAULT_KEYS.PUSH_SUBSCRIPTION);a.default(r,n)||(c.default.saveToLocalStorage(u.default.DEFAULT_KEYS.PUSH_SUBSCRIPTION,n),this.setSubscription(n))}},f.prototype.setSubscription=function(e){if(e){var t=(new i.default).add(u.default.PARAMS.WEB_PUSH_SUBSCRIPTION,e);this.createRequest(u.default.METHODS.SET_DEVICE_ATTRIBUTES,t,{queued:!1,sendNow:!0})}},f.prototype.encodeData=function(e){return window.btoa(e)},f.prototype.decodeData=function(e){return window.atob(e)},f);function f(e){this.createRequest=e,this.serviceWorkerRegistration=null}t.default=l},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(n(3)),a=r(n(1)),i=r(n(4)),s=(u.prototype.applyDiffs=function(e,t,n){this.diffs=e,this.variants=t,this.actionMetadata=n,this.hasReceivedDiffs=!0,this.merged=function r(t,o){if("number"==typeof o||"boolean"==typeof o||"string"==typeof o)return o;if(null==o)return t;function e(r){return function(e){if(r instanceof Array)for(var t=0;t<r.length;t++)e(r[t]);else for(var n in r)!{}.hasOwnProperty.call(r,n)||e(n)}}var n=e(t),a=e(o),i=!1;if(null===t&&!(o instanceof Array))for(var s in i=null,o)if(o.hasOwnProperty(s)){if(null===i&&(i=!0),"string"!=typeof s){i=!1;break}if(s.length<3||"["!==s.charAt(0)||"]"!==s.charAt(s.length-1)){i=!1;break}}if(t instanceof Array||i){var u=[];return n(function(e){u.push(e)}),a(function(e){for(var t=parseInt(e.substring(1,e.length-1)),n=o[e];t>=u.length;)u.push(null);u[t]=r(u[t],n)}),u}var c={};return n(function(e){null!==o[e]&&void 0!==o[e]||(c[e]=t[e])}),a(function(e){c[e]=r(null===t?null:t[e]||{},o[e])}),c}(this.variables,e),this.saveDiffs(),this.onUpdate&&this.onUpdate()},u.prototype.loadDiffs=function(){try{this.applyDiffs(JSON.parse(this.loadLocal(a.default.DEFAULT_KEYS.VARIABLES)||null),JSON.parse(this.loadLocal(a.default.DEFAULT_KEYS.VARIANTS)||null),JSON.parse(this.loadLocal(a.default.DEFAULT_KEYS.ACTION_METADATA)||null)),this.token=this.loadLocal(a.default.DEFAULT_KEYS.TOKEN),this.variantDebugInfo=this.loadLocal(a.default.DEFAULT_KEYS.VARIANT_DEBUG_INFO)}catch(e){console.log("Leanplum: Invalid diffs: "+e)}},u.prototype.saveDiffs=function(){this.saveLocal(a.default.DEFAULT_KEYS.VARIABLES,JSON.stringify(this.diffs||{})),this.saveLocal(a.default.DEFAULT_KEYS.VARIANTS,JSON.stringify(this.variants||[])),this.saveLocal(a.default.DEFAULT_KEYS.ACTION_METADATA,JSON.stringify(this.actionMetadata||{})),this.saveLocal(a.default.DEFAULT_KEYS.VARIANT_DEBUG_INFO,JSON.stringify(this.variantDebugInfo||{})),this.saveLocal(a.default.DEFAULT_KEYS.TOKEN,this.token)},u.prototype.getVariables=function(){return void 0!==this.merged?this.merged:this.variables},u.prototype.setVariables=function(e){this.variables=e},u.prototype.addVariablesChangedHandler=function(e){this.variablesChangedHandlers.push(e),this.hasReceivedDiffs&&e()},u.prototype.removeVariablesChangedHandler=function(e){var t=this.variablesChangedHandlers.indexOf(e);0<=t&&this.variablesChangedHandlers.splice(t,1)},u.prototype.triggerVariablesChangedHandlers=function(){for(var e=0;e<this.variablesChangedHandlers.length;e++)this.variablesChangedHandlers[e]()},u.prototype.getVariantDebugInfo=function(){return this.variantDebugInfo},u.prototype.setVariantDebugInfo=function(e){this.variantDebugInfo=e},u.prototype.sendVariables=function(){var e,t=((e={})[a.default.PARAMS.VARIABLES]=this.variables,e),n=(new o.default).body(JSON.stringify(t));this.createRequest(a.default.METHODS.SET_VARS,n,{sendNow:!0})},u.prototype.clearUserContent=function(){this.diffs=void 0,this.variables=null,this.variants=[],this.variantDebugInfo={},this.merged=void 0},u.prototype.loadLocal=function(e){return i.default.getFromLocalStorage(e)},u.prototype.saveLocal=function(e,t){i.default.saveToLocalStorage(e,t)},u);function u(e){this.createRequest=e,this.actionMetadata={},this.hasReceivedDiffs=!1,this.merged=void 0,this.variables=null,this.variablesChangedHandlers=[],this.variantDebugInfo={},this.diffs=void 0,this.token="",this.variants=[]}t.default=s}],o.c=r,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)o.d(n,r,function(e){return t[e]}.bind(null,r));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=27);function o(e){if(r[e])return r[e].exports;var t=r[e]={i:e,l:!1,exports:{}};return n[e].call(t.exports,t,t.exports,o),t.l=!0,t.exports}var n,r});