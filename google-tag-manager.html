<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width">
        <title>Google Tag Manager integration</title>
    </head>
    <body>
        <!-- Add this snippet as a GTM Custom Code snippet -->
        <script>
            (function(w,d,s) {
                // 1. setup command queue
                var lp = {}
                var q = []
                "addStartResponseHandler addVariablesChangedHandler advanceTo clearUserContent forceContentUpdate getVariable getVariables getVariantDebugInfo getVariants isWebPushSubscribed isWebPushSupported pauseSession pauseState registerForWebPush removeStartResponseHandler removeVariablesChangedHandler resumeSession resumeState setApiPath setAppIdForDevelopmentMode setAppIdForProductionMode setAppVersion setDeviceId setDeviceModel setDeviceName setEmail setNetworkTimeout setRequestBatching setSocketHost setSystemName setSystemVersion setUserAttributes setUserId setVariables setVariantDebugInfoEnabled setWebPushOptions start startFromCache stop track trackPurchase unregisterFromWebPush useSessionLength".split(" ").forEach(function(name) {
                    lp[name] = function() {
                        q.push({
                            name: name,
                            args: Array.prototype.slice.call(arguments)
                        })
                    }
                })
                w.Leanplum = lp

                // 2. load script
                var e = d.createElement(s)
                e.async = 1

                // test
                e.src='/dist/leanplum.min.js'
                // prod
                //e.src='https://cdn.jsdelivr.net/npm/leanplum-sdk@1.5.0/dist/leanplum.min.js'

                e.onload=function() {
                    w.Leanplum.applyQueue(q)
                    lp=e=d=null
                }
                var x = d.getElementsByTagName(s)[0]
                x.parentNode.insertBefore(e, x)
            })(window,document,'script')

            // init
            Leanplum.setAppIdForProductionMode('YOUR_APP_KEY', 'YOUR_PROD_KEY');
            Leanplum.useSessionLength(2*60*60) // 2 hours
            Leanplum.start()
        </script>
    </body>
</html>
